import{_ as V,c,o as i,a as e,u as H,r as h,I as O,q as Z,l as C,y as J,i as f,j as Q,b as M,k as a,t as d,m as Y,A as I,H as G,h as w,v as E,d as u,F as K,x as X,J as R}from"./Z3C1zjOC.js";import{u as ee}from"./DPZQ8nY_.js";import{u as oe,s as te}from"./D6bpf8h9.js";import{u as se}from"./6yrW6Ic0.js";import{P as ae,W as re}from"./CFNf9je3.js";import{W as U}from"./0mYkeiB8.js";import{u as ne}from"./uy_vPcXx.js";import"./DTkYgPEM.js";const ie={},le={class:"w-6 h-6 text-white",fill:"currentColor",viewBox:"0 0 24 24"};function de(_,t){return i(),c("svg",le,t[0]||(t[0]=[e("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M13.5 3C13.2239 3 13 3.22386 13 3.5V12C13 12.5523 12.5523 13 12 13C11.4477 13 11 12.5523 11 12V5.5C11 5.22386 10.7761 5 10.5 5C10.2239 5 9.99999 5.22386 9.99999 5.5V13.9677C9.99999 15.0757 8.62655 15.5918 7.8969 14.7579L5.34951 11.8466C5.19167 11.6662 4.95459 11.576 4.71675 11.6057C4.15329 11.6761 3.88804 12.3395 4.24762 12.779L8.93807 18.5118C10.2266 20.0867 12.154 21 14.1888 21C17.3982 21 20 18.3982 20 15.1888V7.5C20 7.22386 19.7761 7 19.5 7C19.2239 7 19 7.22386 19 7.5V12C19 12.5523 18.5523 13 18 13C17.4477 13 17 12.5523 17 12V5.5C17 5.22386 16.7761 5 16.5 5C16.2239 5 16 5.22386 16 5.5V12C16 12.5523 15.5523 13 15 13C14.4477 13 14 12.5523 14 12V3.5C14 3.22386 13.7761 3 13.5 3ZM15.9611 3.05823C15.7525 1.88823 14.73 1 13.5 1C12.27 1 11.2475 1.88823 11.0389 3.05823C10.8653 3.0201 10.685 3 10.5 3C9.11928 3 7.99999 4.11929 7.99999 5.5V11.8386L6.85467 10.5296C6.2595 9.84942 5.36551 9.50903 4.46868 9.62113C2.34401 9.88672 1.34381 12.3883 2.6997 14.0455L7.39016 19.7783C9.05854 21.8174 11.5541 23 14.1888 23C18.5028 23 22 19.5028 22 15.1888V7.5C22 6.11929 20.8807 5 19.5 5C19.315 5 19.1347 5.0201 18.9611 5.05823C18.7525 3.88823 17.73 3 16.5 3C16.315 3 16.1347 3.0201 15.9611 3.05823Z"},null,-1)]))}const ce=V(ie,[["render",de]]),ue={},ge={class:"w-8 h-8 text-blue-400",fill:"currentColor",viewBox:"0 0 20 20"};function me(_,t){return i(),c("svg",ge,t[0]||(t[0]=[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"},null,-1)]))}const be=V(ue,[["render",me]]),fe={class:"space-y-8"},xe={class:"max-w-2xl mx-auto"},pe={class:"bg-gray-900/60 border border-gray-600/30 rounded-xl shadow-lg p-6 mb-8 hover:bg-gray-900/80 transition-colors"},ve={class:"flex items-center mb-4"},ye={class:"w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center mr-4 shadow-lg"},he={key:0,class:"bg-gray-900/60 border border-gray-600/30 rounded-xl shadow-lg p-6 hover:bg-gray-900/80 transition-colors mb-6"},Ce={class:"text-xl font-bold text-white mb-6"},Me={class:"text-center space-y-6"},we={class:"flex justify-center"},Ae={class:"bg-blue-900/30 border border-blue-500/30 rounded-lg p-4"},_e={class:"grid grid-cols-2 gap-4 text-sm"},Le={class:"font-bold text-white"},ke={class:"font-bold text-white"},Ne={class:"space-y-3"},Ie={key:1,class:"bg-gray-900/60 border border-gray-600/30 rounded-xl shadow-lg p-6 hover:bg-gray-900/80 transition-colors"},Ee={class:"grid grid-cols-2 gap-4"},Re=["disabled"],Ue=["disabled"],Ve={class:"text-sm text-gray-400 mt-2"},Se={class:"font-semibold text-white"},We={class:"grid grid-cols-2 md:grid-cols-4 gap-3"},Pe=["disabled","onClick"],$e={class:"bg-gray-800/60 border border-gray-600/30 rounded-lg p-4"},Be={class:"space-y-3"},De={class:"flex items-center"},ze=["disabled"],Te={class:"flex items-center"},je=["disabled"],qe={class:"bg-yellow-900/30 border border-yellow-500/30 rounded-lg p-4"},Fe={class:"text-sm text-yellow-300 space-y-1"},He={class:"flex space-x-4"},Oe=["disabled"],Ze=["disabled"],Je={key:2,class:"bg-orange-900/60 border border-orange-500/30 rounded-xl shadow-lg p-6"},Qe={class:"text-center"},Ye={class:"w-16 h-16 bg-orange-500 rounded-full flex items-center justify-center mx-auto mb-4"},Ge={class:"text-lg font-bold text-white mb-2"},Ke={class:"bg-orange-800/40 border border-orange-500/40 rounded-lg p-3 mb-4"},Xe={class:"text-sm text-orange-200"},eo={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},oo={class:"bg-gray-800 border border-gray-600/30 p-6 rounded-xl max-w-md w-full mx-4"},to={class:"text-center"},so={class:"w-16 h-16 bg-blue-900/60 border border-blue-500/30 rounded-full flex items-center justify-center mx-auto mb-4"},ao={class:"text-gray-300 mb-6"},ro={class:"flex space-x-4"},no={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},io={class:"bg-gray-800 border border-gray-600/30 p-6 rounded-xl max-w-md w-full mx-4"},lo={class:"text-center"},co={class:"w-16 h-16 bg-red-900/60 border border-red-500/30 rounded-full flex items-center justify-center mx-auto mb-4"},uo={class:"flex space-x-4"},Co={__name:"manual",setup(_){const t=oe();H(),se();const n=h({minutes:5,seconds:0}),g=h({notifyStart:!0,notifyEnd:!0}),x=h(!1),p=h(!1),S=[{label:"2 min",minutes:2,seconds:0},{label:"5 min",minutes:5,seconds:0},{label:"10 min",minutes:10,seconds:0},{label:"15 min",minutes:15,seconds:0}],{toast:L}=ee(),W=O(),v=s=>L.success(s),l=s=>L.error(s),A=()=>{const s=n.value.minutes||0,o=n.value.seconds||0;if(s===0&&o===0)return"No configurado";let r="";return s>0&&(r+=`${s} min`),o>0&&(r+=`${r?" ":""}${o} seg`),r},P=()=>(((n.value.minutes||0)+(n.value.seconds||0)/60)*2.5).toFixed(1),k=()=>n.value.minutes>0||n.value.seconds>0,$=s=>{n.value.minutes=s.minutes,n.value.seconds=s.seconds},B=()=>{if(!k()){l("Por favor, configura una duraci√≥n v√°lida para el riego");return}x.value=!0},D=async()=>{x.value=!1;try{const s={duration_minutes:n.value.minutes+n.value.seconds/60,begin_notification:g.value.notifyStart,final_notification:g.value.notifyEnd};console.log("üöÄ [MANUAL] Iniciando riego con configuraci√≥n:",s),await t.startManualIrrigation(s)?(console.log("‚úÖ [MANUAL] Riego iniciado exitosamente"),v(`üöø Riego manual iniciado por ${Math.floor(s.duration_minutes)} minutos`),await t.loadActiveConfiguration(),b(),console.log("‚úÖ Riego manual iniciado exitosamente"),console.log("üìä [MANUAL] Estado despu√©s de iniciar:",{hasActiveMode:t.hasActiveMode,isManualActive:t.isManualActive,isWatering:t.isWatering,activeMode:t.activeMode})):l("Error al iniciar el riego manual")}catch(s){console.error("‚ùå [MANUAL] Error en startManualWatering:",s),l("Error al iniciar el riego manual")}},z=()=>{t.isWatering?p.value=!0:j()},T=async()=>{p.value=!1;try{await t.cancelActiveMode()?(console.log("‚úÖ [MANUAL] Riego cancelado exitosamente"),v("üõë Riego cancelado exitosamente")):l("Error al cancelar el riego")}catch(s){console.error("‚ùå [MANUAL] Error cancelando riego:",s),l("Error al cancelar el riego")}},j=async()=>{try{await t.cancelActiveMode()?console.log("‚úÖ [MANUAL] Configuraci√≥n cancelada exitosamente"):l("Error al cancelar la configuraci√≥n")}catch(s){console.error("‚ùå [MANUAL] Error cancelando configuraci√≥n:",s),l("Error al cancelar la configuraci√≥n")}},q=async()=>{try{await t.pauseIrrigation()?(console.log("‚úÖ [MANUAL] Riego pausado exitosamente"),v("‚è∏Ô∏è Riego pausado exitosamente")):l("Error al pausar el riego")}catch(s){console.error("‚ùå [MANUAL] Error pausando riego:",s),l("Error al pausar el riego")}},F=async()=>{try{await t.resumeIrrigation()?(console.log("‚úÖ [MANUAL] Riego reanudado exitosamente"),v("‚ñ∂Ô∏è Riego reanudado exitosamente")):l("Error al reanudar el riego")}catch(s){console.error("‚ùå [MANUAL] Error reanudando riego:",s),l("Error al reanudar el riego")}},N=()=>{W.push("/modo")};let m=null;const b=()=>{m&&clearInterval(m);const s=async()=>{try{await t.loadActiveConfiguration()}catch(o){console.error("üîÑ [MANUAL] Error actualizando estado:",o)}};s(),m=te(async()=>{console.log("üîÑ [MANUAL] Actualizando estado peri√≥dico..."),await s()},3e3)},y=()=>{m&&(clearInterval(m),m=null)};return Z(async()=>{console.log("üéØ [MANUAL] Componente montado"),await t.loadActiveConfiguration(),(t.isManualActive||t.isWatering||t.activeMode==="manual")&&(console.log("üîÑ [MANUAL] Iniciando monitoreo por actividad detectada"),b()),await new Promise(s=>setTimeout(s,100))}),C(()=>t.hasActiveMode,s=>{console.log("üîÑ [MANUAL] hasActiveMode cambi√≥ a:",s)}),C(()=>t.isManualActive,s=>{console.log("üîÑ [MANUAL] isManualActive cambi√≥ a:",s),s||t.isWatering?b():s||y()},{immediate:!0}),C(()=>t.isWatering,s=>{console.log("üîÑ [MANUAL] isWatering cambi√≥ a:",s),s||t.isManualActive?b():s||y()},{immediate:!0}),C(()=>t.activeMode,s=>{console.log("üîÑ [MANUAL] activeMode cambi√≥ a:",s),s==="manual"?b():s!=="manual"&&y()},{immediate:!0}),J(()=>{console.log("üéØ [MANUAL] Componente desmontado - limpiando recursos"),y(),t.cleanup()}),ne({title:"Modo Manual - VIVANTIA",meta:[{name:"description",content:"Configuraci√≥n del modo manual de riego"}]}),(s,o)=>(i(),c("div",fe,[e("div",xe,[e("div",pe,[e("div",ve,[e("div",ye,[M(a(ce))]),o[6]||(o[6]=e("div",null,[e("h1",{class:"text-2xl font-bold text-white"},"Modo Manual"),e("p",{class:"text-gray-300"},"Control directo del sistema de riego")],-1))]),o[7]||(o[7]=Q('<div class="bg-blue-900/30 border border-blue-500/30 rounded-lg p-4"><h3 class="font-semibold text-blue-400 mb-2">¬øC√≥mo funciona el modo manual?</h3><ul class="text-sm text-blue-300 space-y-1"><li>‚Ä¢ Activa la bomba inmediatamente al confirmar</li><li>‚Ä¢ Configura la duraci√≥n exacta del riego</li><li>‚Ä¢ Ideal para riegos puntuales o de emergencia</li></ul></div><div class="bg-yellow-900/30 border border-yellow-500/30 rounded-lg p-4 mt-4"><h3 class="font-semibold text-yellow-400 mb-2">‚ö†Ô∏è Advertencia Importante</h3><p class="text-sm text-yellow-300"><strong>Tiempo de respuesta del sistema:</strong> La bomba puede tardar entre 2-15 segundos en activarse al iniciar el riego y entre 2-15 segundos en detenerse al cancelar o pausar. Este tiempo es normal debido a la comunicaci√≥n LoRaWAN con el dispositivo IoT. </p></div>',2))]),a(t).isManualActive&&(a(t).isWatering||a(t).isPaused)?(i(),c("div",he,[e("h2",Ce,"Riego Manual "+d(a(t).isPaused?"Pausado":"Activo"),1),e("div",Me,[e("div",we,[e("div",{class:Y(["w-24 h-24 rounded-full flex items-center justify-center shadow-lg",a(t).isPaused?"bg-yellow-500":"bg-blue-500 animate-pulse"])},[a(t).isPaused?(i(),I(a(ae),{key:0})):(i(),I(a(re),{key:1}))],2)]),e("div",Ae,[o[10]||(o[10]=e("h3",{class:"font-semibold text-blue-400 mb-3"},"Informaci√≥n del Riego",-1)),e("div",_e,[e("div",null,[o[8]||(o[8]=e("p",{class:"text-gray-400"},"Estado:",-1)),e("p",Le,d(a(t).isPaused?"Pausado":"Bomba Activa"),1)]),e("div",null,[o[9]||(o[9]=e("p",{class:"text-gray-400"},"Tiempo Restante:",-1)),e("p",ke,d(a(t).remainingTime||"Calculando..."),1)])])]),e("div",Ne,[a(t).isPaused?f("",!0):(i(),c("button",{key:0,onClick:q,class:"w-full px-6 py-4 bg-gradient-to-r from-yellow-500 to-yellow-600 text-white font-bold text-lg rounded-lg hover:from-yellow-600 hover:to-yellow-700 transform hover:scale-105 transition-all duration-200 shadow-lg"}," ‚è∏Ô∏è Parada de Emergencia ")),a(t).isPaused?(i(),c("button",{key:1,onClick:F,class:"w-full px-6 py-4 bg-gradient-to-r from-green-500 to-green-600 text-white font-bold text-lg rounded-lg hover:from-green-600 hover:to-green-700 transform hover:scale-105 transition-all duration-200 shadow-lg"}," ‚ñ∂Ô∏è Reanudar Riego ")):f("",!0),e("button",{onClick:z,class:"w-full px-6 py-4 bg-gradient-to-r from-red-500 to-red-600 text-white font-bold text-lg rounded-lg hover:from-red-600 hover:to-red-700 transform hover:scale-105 transition-all duration-200 shadow-lg"}," üõë Cancelar Riego Manual ")])])])):f("",!0),a(t).hasActiveMode?(i(),c("div",Je,[e("div",Qe,[e("div",Ye,[M(a(U))]),e("h3",Ge,"Modo "+d(a(t).activeMode)+" Activo",1),o[27]||(o[27]=e("p",{class:"text-orange-300 mb-4"}," Ya tienes un modo de riego activo. Debes cancelar la configuraci√≥n actual antes de poder configurar el modo manual. ",-1)),e("div",Ke,[e("p",Xe,[o[26]||(o[26]=e("strong",null,"√öltimo riego:",-1)),u(" "+d(a(t).lastIrrigation),1)])]),e("button",{onClick:N,class:"px-6 py-3 bg-orange-600 text-white font-medium rounded-lg hover:bg-orange-700 transition-colors"}," Volver a Modos de Riego ")])])):(i(),c("div",Ie,[o[24]||(o[24]=e("h2",{class:"text-xl font-bold text-white mb-6"},"Configurar Riego Manual",-1)),o[25]||(o[25]=e("div",{class:"bg-blue-900/30 border border-blue-500/30 rounded-lg p-4 mb-6"},[e("h3",{class:"font-semibold text-blue-400 mb-2"},"üí° Informaci√≥n Importante"),e("p",{class:"text-sm text-blue-300"}," Si ya has configurado un riego manual para este cultivo, la configuraci√≥n se actualizar√° con los nuevos valores. Esto te permite hacer m√∫ltiples riegos con diferentes duraciones sin crear configuraciones duplicadas. ")],-1)),e("form",{onSubmit:G(B,["prevent"]),class:"space-y-6"},[e("div",null,[o[14]||(o[14]=e("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," Duraci√≥n del Riego ",-1)),e("div",Ee,[e("div",null,[o[11]||(o[11]=e("label",{class:"block text-xs text-gray-400 mb-1"},"Minutos",-1)),w(e("input",{"onUpdate:modelValue":o[0]||(o[0]=r=>a(n).minutes=r),type:"number",min:"0",max:"59",disabled:a(t).isLoading,class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:opacity-50",placeholder:"0"},null,8,Re),[[E,a(n).minutes,void 0,{number:!0}]])]),e("div",null,[o[12]||(o[12]=e("label",{class:"block text-xs text-gray-400 mb-1"},"Segundos",-1)),w(e("input",{"onUpdate:modelValue":o[1]||(o[1]=r=>a(n).seconds=r),type:"number",min:"0",max:"59",disabled:a(t).isLoading,class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:opacity-50",placeholder:"0"},null,8,Ue),[[E,a(n).seconds,void 0,{number:!0}]])])]),e("p",Ve,[o[13]||(o[13]=u(" Duraci√≥n total: ")),e("span",Se,d(A()),1)])]),e("div",null,[o[15]||(o[15]=e("label",{class:"block text-sm font-medium text-gray-300 mb-3"}," Opciones R√°pidas ",-1)),e("div",We,[(i(),c(K,null,X(S,r=>e("button",{key:r.label,type:"button",disabled:a(t).isLoading,onClick:go=>$(r),class:"p-3 text-sm font-medium text-blue-300 bg-blue-900/30 border border-blue-500/30 rounded-lg hover:bg-blue-900/50 transition-colors disabled:opacity-50"},d(r.label),9,Pe)),64))])]),e("div",$e,[o[18]||(o[18]=e("h3",{class:"font-medium text-gray-300 mb-3"},"Configuraci√≥n Adicional",-1)),e("div",Be,[e("label",De,[w(e("input",{"onUpdate:modelValue":o[2]||(o[2]=r=>a(g).notifyStart=r),type:"checkbox",disabled:a(t).isLoading,class:"rounded border-gray-600 bg-gray-700 text-blue-600 focus:ring-blue-500 disabled:opacity-50"},null,8,ze),[[R,a(g).notifyStart]]),o[16]||(o[16]=e("span",{class:"ml-2 text-sm text-gray-300"},"Notificar al iniciar el riego",-1))]),e("label",Te,[w(e("input",{"onUpdate:modelValue":o[3]||(o[3]=r=>a(g).notifyEnd=r),type:"checkbox",disabled:a(t).isLoading,class:"rounded border-gray-600 bg-gray-700 text-blue-600 focus:ring-blue-500 disabled:opacity-50"},null,8,je),[[R,a(g).notifyEnd]]),o[17]||(o[17]=e("span",{class:"ml-2 text-sm text-gray-300"},"Notificar al finalizar el riego",-1))])])]),e("div",qe,[o[23]||(o[23]=e("h3",{class:"font-medium text-yellow-400 mb-2"},"Vista Previa",-1)),e("div",Fe,[e("p",null,[o[19]||(o[19]=e("strong",null,"Duraci√≥n:",-1)),u(" "+d(A()),1)]),o[21]||(o[21]=e("p",null,[e("strong",null,"Inicio:"),u(" Inmediato al confirmar")],-1)),o[22]||(o[22]=e("p",null,[e("strong",null,"Caudal estimado:"),u(" 2.5 L/min")],-1)),e("p",null,[o[20]||(o[20]=e("strong",null,"Volumen total:",-1)),u(" "+d(P())+" L",1)])])]),e("div",He,[e("button",{type:"submit",disabled:!k()||a(t).isLoading,class:"flex-1 px-6 py-4 bg-gradient-to-r from-[#4A5DB8] to-[#2A3B7A] text-white font-bold text-lg rounded-lg hover:from-[#5A6DC8] hover:to-[#3A4B8A] disabled:from-gray-400 disabled:to-gray-500 disabled:cursor-not-allowed transform hover:scale-105 transition-all duration-200 shadow-lg"},d(a(t).isLoading?"üîÑ Iniciando...":"üöÄ Iniciar Riego Manual"),9,Oe),e("button",{type:"button",onClick:N,disabled:a(t).isLoading,class:"px-6 py-3 bg-gray-600 text-gray-200 font-medium rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50"}," Cancelar ",8,Ze)])],32)]))]),a(x)?(i(),c("div",eo,[e("div",oo,[e("div",to,[e("div",so,[M(a(be))]),o[31]||(o[31]=e("h3",{class:"text-lg font-bold text-white mb-2"},"Confirmar Riego Manual",-1)),e("p",ao,[u(" ¬øEst√°s seguro de que quieres iniciar el riego manual por "+d(A())+"? ",1),o[28]||(o[28]=e("br",null,null,-1)),o[29]||(o[29]=e("br",null,null,-1)),o[30]||(o[30]=e("strong",null,"La bomba se activar√° inmediatamente.",-1))]),e("div",ro,[e("button",{onClick:D,class:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"}," Confirmar e Iniciar "),e("button",{onClick:o[4]||(o[4]=r=>x.value=!1),class:"flex-1 px-4 py-2 bg-gray-600 text-gray-200 rounded-lg hover:bg-gray-500 transition-colors"}," Cancelar ")])])])])):f("",!0),a(p)?(i(),c("div",no,[e("div",io,[e("div",lo,[e("div",co,[M(a(U))]),o[32]||(o[32]=e("h3",{class:"text-lg font-bold text-white mb-2"},"Cancelar Riego Manual",-1)),o[33]||(o[33]=e("p",{class:"text-gray-300 mb-6"},[u(" ¬øEst√°s seguro de que quieres cancelar el riego manual? "),e("br"),e("br"),e("strong",{class:"text-red-400"},"La bomba se detendr√° inmediatamente.")],-1)),e("div",uo,[e("button",{onClick:T,class:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"}," S√≠, Cancelar Riego "),e("button",{onClick:o[5]||(o[5]=r=>p.value=!1),class:"flex-1 px-4 py-2 bg-gray-600 text-gray-200 rounded-lg hover:bg-gray-500 transition-colors"}," No, Continuar ")])])])])):f("",!0)]))}};export{Co as default};
