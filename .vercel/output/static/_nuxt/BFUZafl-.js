import{r as m,q as M,c as n,o as d,j as w,k as t,a as r,t as c,h as i,s as h,F as j,x as q,v as l,i as k,J as S,d as P,H as A,f as C}from"./Z3C1zjOC.js";import{u as T}from"./ZEFxkT7r.js";import{u as B}from"./DPZQ8nY_.js";import{C as F}from"./DTkYgPEM.js";import{U as L}from"./DnZbvBXp.js";import"./Dxmh1sec.js";const D={class:"space-y-8"},H={key:0,class:"flex items-center justify-center py-12"},N={key:1,class:"bg-red-500/20 border border-red-500/30 rounded-lg p-6"},O={class:"flex items-center"},z={class:"text-red-300 mt-1"},$={key:2,class:"bg-gray-800/50 border border-gray-700 rounded-lg p-6"},R=["value"],J={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},W={class:"md:col-span-2"},G={class:"md:col-span-2"},K={class:"flex items-center space-x-4"},Q={key:0,class:"flex items-center space-x-2 flex-1"},X={class:"text-green-400 text-sm"},Y={class:"md:col-span-2"},Z={class:"flex items-center space-x-3"},ee={class:"flex items-center justify-end space-x-4 pt-6 border-t border-gray-700"},re=["disabled"],oe={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},ue={__name:"agregar",setup(te){T();const{toast:p}=B(),o=m({user_id:"",name:"",description:"",image:"",category:"",soil_humidity_min:"",soil_humidity_max:"",air_humidity_min:"",air_humidity_max:"",temperature_max:"",growth_days:"",session:"",selected:!1}),v=m([]),x=m(!1),g=m(!1),u=m(null),b=m(""),y=m(null);M(async()=>{await f()});const f=async()=>{try{x.value=!0,u.value=null;const s=await L.getAllUsers();v.value=s.data||[],console.log("✅ Usuarios cargados exitosamente")}catch(s){console.error("❌ Error cargando usuarios:",s),u.value="Error al cargar usuarios",p.error("Error al cargar usuarios")}finally{x.value=!1}},V=async()=>{try{if(g.value=!0,u.value=null,!o.value.user_id||!o.value.name||!o.value.description||!o.value.category||!o.value.soil_humidity_min||!o.value.soil_humidity_max||!o.value.air_humidity_min||!o.value.air_humidity_max||!o.value.temperature_max||!o.value.growth_days||!o.value.session)throw new Error("Todos los campos obligatorios deben estar completos");const s=[];if(parseFloat(o.value.soil_humidity_min)>=parseFloat(o.value.soil_humidity_max)&&s.push("La humedad del suelo mínima debe ser menor que la máxima"),parseFloat(o.value.air_humidity_min)>=parseFloat(o.value.air_humidity_max)&&s.push("La humedad del aire mínima debe ser menor que la máxima"),s.length>0)throw new Error(s.join(`
`));await F.create(o.value),p.success("Cultivo creado exitosamente"),await C("/admin/cultivos")}catch(s){console.error("❌ Error creando cultivo:",s),u.value=s.message||"Error al crear el cultivo",p.error(u.value)}finally{g.value=!1}},_=()=>{C("/admin/cultivos")},I=s=>{const e=s.target.files[0];if(e){if(!e.type.startsWith("image/")){p.error("Por favor selecciona un archivo de imagen válido");return}if(e.size>5*1024*1024){p.error("La imagen no puede superar los 5MB");return}y.value=e,b.value=e.name;const a=new FileReader;a.onload=E=>{o.value.image=E.target.result},a.readAsDataURL(e)}},U=()=>{y.value=null,b.value="",o.value.image="",$refs.imageInput&&($refs.imageInput.value="")};return(s,e)=>(d(),n("div",D,[e[35]||(e[35]=w('<div class="mb-8"><div class="flex items-center space-x-3 mb-2"><div class="w-10 h-10 bg-gradient-to-r from-green-500 to-green-600 rounded-lg flex items-center justify-center"><svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg></div><div><h1 class="text-3xl font-bold text-white">Panel de Administración</h1><p class="text-gray-400">Bienvenido al centro de control del sistema Vivantia</p></div></div><div class="mt-4"><h2 class="text-xl font-semibold text-white">Añadir Cultivo</h2><p class="text-gray-400 mt-1">Crear un nuevo cultivo para un usuario</p></div></div>',1)),t(x)?(d(),n("div",H,e[13]||(e[13]=[r("div",{class:"text-center"},[r("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-green-500 mb-4"}),r("p",{class:"text-gray-400"},"Cargando usuarios...")],-1)]))):t(u)?(d(),n("div",N,[r("div",O,[e[15]||(e[15]=r("svg",{class:"w-6 h-6 text-red-400 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),r("div",null,[e[14]||(e[14]=r("h3",{class:"text-lg font-medium text-red-400"},"Error",-1)),r("p",z,c(t(u)),1)])]),r("button",{onClick:f,class:"mt-4 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-md transition-colors"}," Reintentar ")])):(d(),n("div",$,[r("form",{onSubmit:A(V,["prevent"]),class:"space-y-6"},[r("div",null,[e[17]||(e[17]=r("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," Usuario Propietario * ",-1)),i(r("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>t(o).user_id=a),required:"",class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"},[e[16]||(e[16]=r("option",{value:""},"Seleccionar usuario...",-1)),(d(!0),n(j,null,q(t(v),a=>(d(),n("option",{key:a.id,value:a.id,class:"bg-gray-700 text-white"},c(a.name)+" ("+c(a.email)+") ",9,R))),128))],512),[[h,t(o).user_id]])]),r("div",J,[r("div",null,[e[18]||(e[18]=r("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," Nombre del Cultivo * ",-1)),i(r("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>t(o).name=a),type:"text",required:"",class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Ej: Tomates Cherry"},null,512),[[l,t(o).name]])]),r("div",null,[e[19]||(e[19]=r("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," Categoría * ",-1)),i(r("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>t(o).category=a),type:"text",required:"",class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Ej: Hortalizas"},null,512),[[l,t(o).category]])]),r("div",W,[e[20]||(e[20]=r("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," Descripción * ",-1)),i(r("textarea",{"onUpdate:modelValue":e[3]||(e[3]=a=>t(o).description=a),rows:"3",required:"",class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none",placeholder:"Descripción del cultivo, características especiales, cuidados necesarios..."},null,512),[[l,t(o).description]])]),r("div",G,[e[22]||(e[22]=r("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," Imagen del Cultivo ",-1)),r("div",K,[r("input",{ref:"imageInput",type:"file",accept:"image/*",onChange:I,class:"hidden"},null,544),r("button",{type:"button",onClick:e[4]||(e[4]=a=>s.$refs.imageInput.click()),class:"px-4 py-2 bg-gray-600 hover:bg-gray-500 text-white rounded-md transition-colors flex items-center space-x-2"},e[21]||(e[21]=[r("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})],-1),r("span",null,"Seleccionar Imagen",-1)])),t(b)?(d(),n("div",Q,[r("span",X,c(t(b)),1),r("button",{type:"button",onClick:U,class:"px-2 py-1 bg-red-600 hover:bg-red-700 text-white rounded text-xs transition-colors"}," Limpiar ")])):k("",!0)]),e[23]||(e[23]=r("p",{class:"text-xs text-gray-500 mt-1"},"Selecciona una imagen del cultivo (opcional, máximo 5MB)",-1))]),r("div",null,[e[24]||(e[24]=r("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," Humedad del Suelo Mínima (%) * ",-1)),i(r("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>t(o).soil_humidity_min=a),type:"number",min:"0",max:"100",step:"0.1",required:"",class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Ej: 60"},null,512),[[l,t(o).soil_humidity_min]])]),r("div",null,[e[25]||(e[25]=r("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," Humedad del Suelo Máxima (%) * ",-1)),i(r("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>t(o).soil_humidity_max=a),type:"number",min:"0",max:"100",step:"0.1",required:"",class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Ej: 80"},null,512),[[l,t(o).soil_humidity_max]])]),r("div",null,[e[26]||(e[26]=r("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," Humedad del Aire Mínima (%) * ",-1)),i(r("input",{"onUpdate:modelValue":e[7]||(e[7]=a=>t(o).air_humidity_min=a),type:"number",min:"0",max:"100",step:"0.1",required:"",class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Ej: 40"},null,512),[[l,t(o).air_humidity_min]])]),r("div",null,[e[27]||(e[27]=r("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," Humedad del Aire Máxima (%) * ",-1)),i(r("input",{"onUpdate:modelValue":e[8]||(e[8]=a=>t(o).air_humidity_max=a),type:"number",min:"0",max:"100",step:"0.1",required:"",class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Ej: 70"},null,512),[[l,t(o).air_humidity_max]])]),r("div",null,[e[28]||(e[28]=r("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," Temperatura Máxima (°C) * ",-1)),i(r("input",{"onUpdate:modelValue":e[9]||(e[9]=a=>t(o).temperature_max=a),type:"number",min:"0",max:"50",required:"",class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Ej: 30"},null,512),[[l,t(o).temperature_max]])]),r("div",null,[e[29]||(e[29]=r("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," Días de Crecimiento * ",-1)),i(r("input",{"onUpdate:modelValue":e[10]||(e[10]=a=>t(o).growth_days=a),type:"number",min:"1",required:"",class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Ej: 90"},null,512),[[l,t(o).growth_days]])]),r("div",null,[e[31]||(e[31]=r("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," Temporada de Cosecha * ",-1)),i(r("select",{"onUpdate:modelValue":e[11]||(e[11]=a=>t(o).session=a),required:"",class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"},e[30]||(e[30]=[w('<option value="">Seleccionar temporada...</option><option value="Primavera">Primavera</option><option value="Verano">Verano</option><option value="Otoño">Otoño</option><option value="Invierno">Invierno</option><option value="Primavera/Verano">Primavera/Verano</option><option value="Verano/Otoño">Verano/Otoño</option><option value="Otoño/Invierno">Otoño/Invierno</option><option value="Invierno/Primavera">Invierno/Primavera</option><option value="Todo el año">Todo el año</option>',10)]),512),[[h,t(o).session]])]),r("div",Y,[e[33]||(e[33]=r("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," Estado de Selección ",-1)),r("div",Z,[i(r("input",{"onUpdate:modelValue":e[12]||(e[12]=a=>t(o).selected=a),type:"checkbox",class:"w-4 h-4 text-green-600 bg-gray-700 border-gray-600 rounded focus:ring-green-500 focus:ring-2"},null,512),[[S,t(o).selected]]),e[32]||(e[32]=r("span",{class:"text-white"},"Marcar como seleccionado",-1))]),e[34]||(e[34]=r("p",{class:"text-xs text-gray-500 mt-1"},"Indica si este cultivo está seleccionado para el usuario",-1))])]),r("div",ee,[r("button",{type:"button",onClick:_,class:"px-6 py-2 bg-gray-600 hover:bg-gray-500 text-white rounded-md transition-colors"}," Cancelar "),r("button",{type:"submit",disabled:t(g),class:"px-6 py-2 bg-green-600 hover:bg-green-700 disabled:bg-green-800 disabled:cursor-not-allowed text-white rounded-md transition-colors flex items-center"},[t(g)?(d(),n("div",oe)):k("",!0),P(" "+c(t(g)?"Creando...":"Crear Cultivo"),1)],8,re)])],32)]))]))}};export{ue as default};
