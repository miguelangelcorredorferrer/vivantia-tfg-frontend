import{r as p,q as T,c as d,o as u,j as g,k as s,a as t,t as x,h as l,s as y,F as U,x as C,v as i,J as D,d as M,H as F,f as w}from"./Z3C1zjOC.js";import{u as N}from"./ZEFxkT7r.js";import{u as V}from"./DPZQ8nY_.js";import j from"./Dxmh1sec.js";import{U as I}from"./DnZbvBXp.js";import"./DTkYgPEM.js";const B={class:"space-y-8"},R={key:0,class:"flex items-center justify-center py-12"},S={key:1,class:"bg-red-500/20 border border-red-500/30 rounded-lg p-6"},_={class:"flex items-center"},q={class:"text-red-300 mt-1"},K={key:2,class:"bg-gray-800/50 border border-gray-700 rounded-lg p-6"},P=["value"],G={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},L={class:"flex space-x-2"},$={class:"flex space-x-2"},z={class:"flex items-center space-x-3"},H={class:"border-t border-gray-600 pt-6"},J={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},te={__name:"agregar",setup(O){N();const{toast:m}=V(),o=p({user_id:"",device_name:"",enddevice_id:"",app_eui:"",dev_eui:"",app_key:"",is_active_communication:!1,ttn_region:"",ttn_app_id:"",ttn_access_key:""}),b=p([]),c=p(!1),v=p(!1),n=p(null);T(async()=>{await f()});const f=async()=>{try{c.value=!0,n.value=null;const a=await I.getAllUsers();b.value=a.data||[],console.log("✅ Usuarios cargados exitosamente")}catch(a){console.error("❌ Error cargando usuarios:",a),n.value="Error al cargar usuarios",m.error("Error al cargar usuarios")}finally{c.value=!1}},k=()=>{const a="0123456789ABCDEF";let e="";for(let r=0;r<32;r++)e+=a.charAt(Math.floor(Math.random()*a.length));o.value.app_key=e},h=()=>{const a="0123456789ABCDEF";let e="";for(let r=0;r<16;r++)e+=a.charAt(Math.floor(Math.random()*a.length));o.value.dev_eui=e},A=async()=>{try{if(v.value=!0,n.value=null,!o.value.user_id||!o.value.device_name||!o.value.enddevice_id||!o.value.app_eui||!o.value.dev_eui||!o.value.app_key)throw new Error("Todos los campos obligatorios deben estar completos");if(!/^[A-Fa-f0-9]{16}$/.test(o.value.app_eui))throw new Error("AppEUI debe tener exactamente 16 caracteres hexadecimales (0-9, A-F)");if(!/^[A-Fa-f0-9]{16}$/.test(o.value.dev_eui))throw new Error("DevEUI debe tener exactamente 16 caracteres hexadecimales (0-9, A-F)");if(!/^[A-Fa-f0-9]{32}$/.test(o.value.app_key))throw new Error("AppKey debe tener exactamente 32 caracteres hexadecimales (0-9, A-F)");await j.create(o.value),m.success("Dispositivo creado exitosamente"),await w("/admin/dispositivos")}catch(a){console.error("❌ Error creando dispositivo:",a),n.value=a.message||"Error al crear el dispositivo",m.error(n.value)}finally{v.value=!1}},E=()=>{w("/admin/dispositivos")};return(a,e)=>(u(),d("div",B,[e[36]||(e[36]=g('<div class="mb-8"><div class="flex items-center space-x-3 mb-2"><div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg flex items-center justify-center"><svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg></div><div><h1 class="text-3xl font-bold text-white">Panel de Administración</h1><p class="text-gray-400">Bienvenido al centro de control del sistema Vivantia</p></div></div><div class="mt-4"><h2 class="text-xl font-semibold text-white">Añadir Dispositivo</h2><p class="text-gray-400 mt-1">Crear un nuevo dispositivo para un usuario</p></div></div>',1)),s(c)?(u(),d("div",R,e[10]||(e[10]=[t("div",{class:"text-center"},[t("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mb-4"}),t("p",{class:"text-gray-400"},"Cargando usuarios...")],-1)]))):s(n)?(u(),d("div",S,[t("div",_,[e[12]||(e[12]=t("svg",{class:"w-6 h-6 text-red-400 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),t("div",null,[e[11]||(e[11]=t("h3",{class:"text-lg font-medium text-red-400"},"Error",-1)),t("p",q,x(s(n)),1)])]),t("button",{onClick:f,class:"mt-4 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-md transition-colors"}," Reintentar ")])):(u(),d("div",K,[t("form",{onSubmit:F(A,["prevent"]),class:"space-y-6"},[t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," Usuario Propietario * ",-1)),l(t("select",{"onUpdate:modelValue":e[0]||(e[0]=r=>s(o).user_id=r),required:"",class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"},[e[13]||(e[13]=t("option",{value:""},"Seleccionar usuario...",-1)),(u(!0),d(U,null,C(s(b),r=>(u(),d("option",{key:r.id,value:r.id,class:"bg-gray-700 text-white"},x(r.name)+" ("+x(r.email)+") ",9,P))),128))],512),[[y,s(o).user_id]])]),t("div",G,[t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," Nombre del Dispositivo * ",-1)),l(t("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>s(o).device_name=r),type:"text",required:"",class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ej: Sensor Riego Principal"},null,512),[[i,s(o).device_name]])]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," EndDevice ID * ",-1)),l(t("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>s(o).enddevice_id=r),type:"text",required:"",class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ej: sensor-riego-01"},null,512),[[i,s(o).enddevice_id]])]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," AppEUI * ",-1)),l(t("input",{"onUpdate:modelValue":e[3]||(e[3]=r=>s(o).app_eui=r),type:"text",required:"",pattern:"[A-Fa-f0-9]{16}",maxlength:"16",class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent font-mono",placeholder:"Ej: 0000000000000000"},null,512),[[i,s(o).app_eui]]),e[18]||(e[18]=t("p",{class:"text-xs text-gray-500 mt-1"},"16 caracteres hexadecimales (0-9, A-F)",-1))]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," DevEUI * ",-1)),t("div",L,[l(t("input",{"onUpdate:modelValue":e[4]||(e[4]=r=>s(o).dev_eui=r),type:"text",required:"",pattern:"[A-Fa-f0-9]{16}",maxlength:"16",class:"flex-1 px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent font-mono",placeholder:"Ej: 0000000000000000"},null,512),[[i,s(o).dev_eui]]),t("button",{type:"button",onClick:h,class:"px-3 py-2 bg-gray-600 hover:bg-gray-500 text-white rounded-md transition-colors text-sm",title:"Generar DevEUI aleatorio"}," Generar ")]),e[20]||(e[20]=t("p",{class:"text-xs text-gray-500 mt-1"},"16 caracteres hexadecimales (0-9, A-F)",-1))]),t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," AppKey * ",-1)),t("div",$,[l(t("input",{"onUpdate:modelValue":e[5]||(e[5]=r=>s(o).app_key=r),type:"text",required:"",pattern:"[A-Fa-f0-9]{32}",maxlength:"32",class:"flex-1 px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent font-mono",placeholder:"Ej: 00000000000000000000000000000000"},null,512),[[i,s(o).app_key]]),t("button",{type:"button",onClick:k,class:"px-3 py-2 bg-gray-600 hover:bg-gray-500 text-white rounded-md transition-colors text-sm",title:"Generar AppKey aleatoria"}," Generar ")]),e[22]||(e[22]=t("p",{class:"text-xs text-gray-500 mt-1"},"32 caracteres hexadecimales (0-9, A-F)",-1))]),t("div",null,[e[24]||(e[24]=t("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," Estado de Comunicación ",-1)),t("div",z,[l(t("input",{"onUpdate:modelValue":e[6]||(e[6]=r=>s(o).is_active_communication=r),type:"checkbox",class:"w-4 h-4 text-blue-600 bg-gray-700 border-gray-600 rounded focus:ring-blue-500 focus:ring-2"},null,512),[[D,s(o).is_active_communication]]),e[23]||(e[23]=t("span",{class:"text-white"},"Activar comunicación",-1))]),e[25]||(e[25]=t("p",{class:"text-xs text-gray-500 mt-1"},"Controla si el dispositivo puede enviar datos",-1))])]),t("div",H,[e[33]||(e[33]=t("h3",{class:"text-lg font-medium text-white mb-4 flex items-center"},[t("svg",{class:"w-5 h-5 mr-2 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0"})]),M(" Configuración TTN (The Things Network) ")],-1)),t("div",J,[t("div",null,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," TTN Region ",-1)),l(t("select",{"onUpdate:modelValue":e[7]||(e[7]=r=>s(o).ttn_region=r),class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"},e[26]||(e[26]=[g('<option value="">Seleccionar región</option><option value="eu1">Europe 1 (eu1)</option><option value="nam1">North America 1 (nam1)</option><option value="au1">Australia 1 (au1)</option><option value="as1">Asia 1 (as1)</option>',5)]),512),[[y,s(o).ttn_region]]),e[28]||(e[28]=t("p",{class:"text-xs text-gray-500 mt-1"},"Región del servidor TTN",-1))]),t("div",null,[e[29]||(e[29]=t("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," TTN Application ID ",-1)),l(t("input",{"onUpdate:modelValue":e[8]||(e[8]=r=>s(o).ttn_app_id=r),type:"text",class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"my-ttn-application"},null,512),[[i,s(o).ttn_app_id]]),e[30]||(e[30]=t("p",{class:"text-xs text-gray-500 mt-1"},"ID de la aplicación en TTN",-1))]),t("div",null,[e[31]||(e[31]=t("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," TTN Access Key ",-1)),l(t("input",{"onUpdate:modelValue":e[9]||(e[9]=r=>s(o).ttn_access_key=r),type:"password",class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent font-mono",placeholder:"••••••••••••••••"},null,512),[[i,s(o).ttn_access_key]]),e[32]||(e[32]=t("p",{class:"text-xs text-gray-500 mt-1"},"Clave de acceso para la API TTN",-1))])]),e[34]||(e[34]=g('<div class="mt-4 p-3 bg-blue-900/20 border border-blue-500/30 rounded-lg"><div class="flex items-start"><svg class="w-5 h-5 text-blue-400 mt-0.5 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><div class="text-sm text-blue-300"><p class="font-medium mb-1">Configuración TTN (Opcional)</p><p>Los campos TTN son necesarios para el control remoto de la bomba de riego. Puedes configurarlos ahora o más tarde desde la edición del dispositivo.</p></div></div></div>',1))]),t("div",{class:"flex space-x-4"},[e[35]||(e[35]=t("button",{type:"submit",class:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md transition-colors"}," Guardar ",-1)),t("button",{onClick:E,class:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-md transition-colors"}," Cancelar ")])],32)]))]))}};export{te as default};
