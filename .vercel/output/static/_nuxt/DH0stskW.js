import{_}from"./YHwIe9Gn.js";import{G as j,u as z,r as p,c as u,o as c,a as o,j as b,h as y,i as w,v as h,m as k,t as C,b as V,w as M,d as m,H as B,f as A}from"./Z3C1zjOC.js";import{u as I}from"./DPZQ8nY_.js";const T={key:0,class:"text-red-500 text-sm mt-1"},R={key:0,class:"text-red-500 text-sm mt-1"},H={class:"text-right"},L=["disabled"],P={key:0},U={key:1,class:"flex items-center justify-center"},$={class:"mt-6 text-center"},O={class:"text-sm text-gray-600"},K={__name:"login",setup(q){const f=j(),t=z(),{toast:l}=I(),r=p({email:"",password:""}),s=p({}),v=p(!1),E=()=>(s.value={},r.value.email.trim()?/\S+@\S+\.\S+/.test(r.value.email)||(s.value.email="El email no es v√°lido"):s.value.email="El email es obligatorio",r.value.password||(s.value.password="La contrase√±a es obligatoria"),Object.keys(s.value).length===0),S=async()=>{var a,e,d,n;if(E())try{v.value=!0,console.log("üîÑ Intentando hacer login...");const i=await t.login(r.value);console.log("‚úÖ Login exitoso:",i),l.success(`¬°Bienvenido ${t.userName} a Vivantia!`),console.log("üîÑ Redirigiendo al dashboard..."),f.push("/dashboard")}catch(i){console.error("‚ùå Error en login:",i),console.error("‚ùå Error response:",i.response),console.error("‚ùå Error message:",i.message);const g=((e=(a=i.response)==null?void 0:a.data)==null?void 0:e.msg)||i.message||"";if(console.log("üîç Verificando mensaje de error:",g),g.includes("Tu cuenta no ha sido confirmada a√∫n")||g.includes("Cuenta no verificada")){console.log("‚ö†Ô∏è Cuenta no verificada, redirigiendo..."),l.warning("Cuenta no verificada. Por favor, verifica tu email antes de continuar."),f.push("/auth/verify-email");return}const N=((n=(d=i.response)==null?void 0:d.data)==null?void 0:n.msg)||"Credenciales incorrectas";l.error(N)}finally{v.value=!1}},x=a=>{s.value[a]&&delete s.value[a]},D=()=>{try{console.log("üé≠ Activando modo demo..."),console.log("üîç Estado antes:",{isDemoMode:t.isDemoMode,isAuthenticated:t.isAuthenticated,user:t.user}),t.enterDemoMode(),console.log("üîç Estado despu√©s:",{isDemoMode:t.isDemoMode,isAuthenticated:t.isAuthenticated,user:t.user}),l.info("Bienvenido al modo demo de Vivantia"),console.log("üîÑ Redirigiendo al dashboard..."),A("/dashboard")}catch(a){console.error("‚ùå Error activando modo demo:",a),l.error("Error al acceder al modo demo")}};return(a,e)=>{const d=_;return c(),u("div",null,[e[12]||(e[12]=o("div",{class:"text-center mb-6"},[o("h2",{class:"text-2xl font-bold text-gray-800 mb-2"},"Iniciar Sesi√≥n"),o("p",{class:"text-gray-600"},"Accede a tu cuenta de Vivantia IoT")],-1)),o("form",{onSubmit:B(S,["prevent"]),class:"space-y-4"},[o("div",null,[e[4]||(e[4]=o("label",{for:"email",class:"block text-sm font-medium text-gray-700 mb-1"}," Correo electr√≥nico ",-1)),y(o("input",{id:"email","onUpdate:modelValue":e[0]||(e[0]=n=>r.value.email=n),type:"email",placeholder:"tu@email.com",class:k(["w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",{"border-red-500":s.value.email}]),onInput:e[1]||(e[1]=n=>x("email"))},null,34),[[h,r.value.email]]),s.value.email?(c(),u("p",T,C(s.value.email),1)):w("",!0)]),o("div",null,[e[5]||(e[5]=o("label",{for:"password",class:"block text-sm font-medium text-gray-700 mb-1"}," Contrase√±a ",-1)),y(o("input",{id:"password","onUpdate:modelValue":e[2]||(e[2]=n=>r.value.password=n),type:"password",placeholder:"Tu contrase√±a",class:k(["w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",{"border-red-500":s.value.password}]),onInput:e[3]||(e[3]=n=>x("password"))},null,34),[[h,r.value.password]]),s.value.password?(c(),u("p",R,C(s.value.password),1)):w("",!0)]),o("div",H,[V(d,{to:"/auth/forgot-password",class:"text-sm text-green-600 hover:text-green-700 transition-colors duration-200"},{default:M(()=>e[6]||(e[6]=[m(" ¬øOlvidaste tu contrase√±a? ")])),_:1,__:[6]})]),o("button",{type:"submit",disabled:v.value,class:"w-full bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"},[v.value?(c(),u("span",U,e[7]||(e[7]=[o("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[o("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),o("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),m(" Iniciando sesi√≥n... ")]))):(c(),u("span",P,"Iniciar Sesi√≥n"))],8,L),e[9]||(e[9]=b('<div class="relative my-6"><div class="absolute inset-0 flex items-center"><div class="w-full border-t border-gray-300"></div></div><div class="relative flex justify-center text-sm"><span class="px-2 bg-white text-gray-500">o</span></div></div>',1)),o("button",{type:"button",onClick:D,class:"w-full bg-gray-100 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-colors duration-200 border border-gray-300"},e[8]||(e[8]=[o("span",{class:"flex items-center justify-center"},[o("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]),m(" Vista Previa ")],-1)]))],32),e[13]||(e[13]=b('<div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg"><div class="flex"><div class="flex-shrink-0"><svg class="h-5 w-5 text-blue-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg></div><div class="ml-3"><p class="text-sm text-blue-700"><strong>Vista Previa:</strong> Explora las funcionalidades de Vivantia con datos de demostraci√≥n antes de registrarte. </p></div></div></div>',1)),o("div",$,[o("p",O,[e[11]||(e[11]=m(" ¬øNo tienes cuenta? ")),V(d,{to:"/auth/register",class:"text-green-600 hover:text-green-700 font-medium transition-colors duration-200"},{default:M(()=>e[10]||(e[10]=[m(" Reg√≠strate aqu√≠ ")])),_:1,__:[10]})])])])}}};export{K as default};
