import{U as C,r as p,q as D,c,o as m,j as f,k as s,a as t,t as v,h as n,v as d,J as A,d as w,s as U,i as M,H as j,f as k}from"./Z3C1zjOC.js";import{u as V}from"./ZEFxkT7r.js";import{u as S}from"./DPZQ8nY_.js";import h from"./Dxmh1sec.js";import"./DnZbvBXp.js";import"./DTkYgPEM.js";const I={class:"space-y-8"},B={key:0,class:"flex items-center justify-center py-12"},z={key:1,class:"bg-red-500/20 border border-red-500/30 rounded-lg p-6"},P={class:"flex items-center"},q={class:"text-red-300 mt-1"},R={key:2,class:"bg-gray-800/50 border border-gray-700 rounded-lg p-6"},H={class:"bg-gray-700/30 rounded-lg p-4"},K={class:"flex items-center space-x-4"},L={class:"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center"},G={class:"text-white text-lg font-semibold"},J={class:"text-white font-medium"},O={class:"text-gray-400 text-sm"},W={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},F=["value"],Q={class:"flex items-center space-x-3"},X={class:"border-t border-gray-600 pt-6"},Y={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},Z={class:"flex items-center justify-end space-x-4 pt-6 border-t border-gray-700"},$=["disabled"],ee={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},de={__name:"[id]",setup(te){const y=C().params.id;V();const{toast:b}=S(),o=p({device_name:"",enddevice_id:"",app_eui:"",dev_eui:"",app_key:"",is_active_communication:!1,ttn_region:"",ttn_app_id:"",ttn_access_key:""}),g=p({name:"",email:""}),x=p(!1),u=p(!1),l=p(null);D(async()=>{await _()});const _=async()=>{var a,e;try{x.value=!0,l.value=null;const r=(await h.getAllWithUsers()).data.find(E=>E.id===parseInt(y));if(!r)throw new Error("Dispositivo no encontrado");o.value={device_name:r.device_name||"",enddevice_id:r.enddevice_id||"",app_eui:r.app_eui||"",dev_eui:r.dev_eui||"",app_key:r.app_key||"",is_active_communication:r.is_active_communication||!1,ttn_region:r.ttn_region||"",ttn_app_id:r.ttn_app_id||"",ttn_access_key:r.ttn_access_key||""},g.value={name:((a=r.user)==null?void 0:a.name)||"Usuario no encontrado",email:((e=r.user)==null?void 0:e.email)||"Sin email"},console.log("✅ Dispositivo cargado exitosamente")}catch(i){console.error("❌ Error cargando dispositivo:",i),l.value="Error al cargar el dispositivo",b.error("Error al cargar el dispositivo")}finally{x.value=!1}},T=async()=>{try{if(u.value=!0,l.value=null,!o.value.device_name||!o.value.enddevice_id||!o.value.app_eui||!o.value.dev_eui)throw new Error("Todos los campos obligatorios deben estar completos");const a={device_name:o.value.device_name,enddevice_id:o.value.enddevice_id,app_eui:o.value.app_eui,dev_eui:o.value.dev_eui,is_active_communication:o.value.is_active_communication,ttn_region:o.value.ttn_region,ttn_app_id:o.value.ttn_app_id,ttn_access_key:o.value.ttn_access_key};await h.update(y,a),b.success("Dispositivo actualizado exitosamente"),await k("/admin/dispositivos")}catch(a){console.error("❌ Error actualizando dispositivo:",a),l.value=a.message||"Error al actualizar el dispositivo",b.error(l.value)}finally{u.value=!1}},N=()=>{k("/admin/dispositivos")};return(a,e)=>(m(),c("div",I,[e[30]||(e[30]=f('<div class="mb-8"><div class="flex items-center space-x-3 mb-2"><div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg flex items-center justify-center"><svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg></div><div><h1 class="text-3xl font-bold text-white">Panel de Administración</h1><p class="text-gray-400">Bienvenido al centro de control del sistema Vivantia</p></div></div><div class="mt-4"><h2 class="text-xl font-semibold text-white">Editar Dispositivo</h2><p class="text-gray-400 mt-1">Modificar configuración del dispositivo</p></div></div>',1)),s(x)?(m(),c("div",B,e[8]||(e[8]=[t("div",{class:"text-center"},[t("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mb-4"}),t("p",{class:"text-gray-400"},"Cargando dispositivo...")],-1)]))):s(l)?(m(),c("div",z,[t("div",P,[e[10]||(e[10]=t("svg",{class:"w-6 h-6 text-red-400 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),t("div",null,[e[9]||(e[9]=t("h3",{class:"text-lg font-medium text-red-400"},"Error",-1)),t("p",q,v(s(l)),1)])]),t("button",{onClick:_,class:"mt-4 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-md transition-colors"}," Reintentar ")])):(m(),c("div",R,[t("form",{onSubmit:j(T,["prevent"]),class:"space-y-6"},[t("div",H,[e[11]||(e[11]=t("h3",{class:"text-lg font-medium text-white mb-4"},"Usuario Propietario",-1)),t("div",K,[t("div",L,[t("span",G,v(s(g).name.charAt(0).toUpperCase()),1)]),t("div",null,[t("p",J,v(s(g).name),1),t("p",O,v(s(g).email),1)])])]),t("div",W,[t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," Nombre del Dispositivo * ",-1)),n(t("input",{"onUpdate:modelValue":e[0]||(e[0]=i=>s(o).device_name=i),type:"text",required:"",class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ej: Sensor Riego Principal"},null,512),[[d,s(o).device_name]])]),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," EndDevice ID * ",-1)),n(t("input",{"onUpdate:modelValue":e[1]||(e[1]=i=>s(o).enddevice_id=i),type:"text",required:"",class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ej: sensor-riego-01"},null,512),[[d,s(o).enddevice_id]])]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," AppEUI * ",-1)),n(t("input",{"onUpdate:modelValue":e[2]||(e[2]=i=>s(o).app_eui=i),type:"text",required:"",class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ej: 0000000000000000"},null,512),[[d,s(o).app_eui]])]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," DevEUI * ",-1)),n(t("input",{"onUpdate:modelValue":e[3]||(e[3]=i=>s(o).dev_eui=i),type:"text",required:"",class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Ej: 0000000000000000"},null,512),[[d,s(o).dev_eui]])]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," AppKey (No editable) ",-1)),t("input",{value:s(o).app_key?s(o).app_key.substring(0,8)+"****"+s(o).app_key.substring(s(o).app_key.length-8):"N/A",type:"text",disabled:"",class:"w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-md text-gray-400 cursor-not-allowed"},null,8,F),e[17]||(e[17]=t("p",{class:"text-xs text-gray-500 mt-1"},"Por seguridad, la AppKey no puede ser modificada",-1))]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," Estado de Comunicación ",-1)),t("div",Q,[n(t("input",{"onUpdate:modelValue":e[4]||(e[4]=i=>s(o).is_active_communication=i),type:"checkbox",class:"w-4 h-4 text-blue-600 bg-gray-700 border-gray-600 rounded focus:ring-blue-500 focus:ring-2"},null,512),[[A,s(o).is_active_communication]]),e[18]||(e[18]=t("span",{class:"text-white"},"Activar comunicación",-1))]),e[20]||(e[20]=t("p",{class:"text-xs text-gray-500 mt-1"},"Controla si el dispositivo puede enviar datos",-1))])]),t("div",X,[e[28]||(e[28]=t("h3",{class:"text-lg font-medium text-white mb-4 flex items-center"},[t("svg",{class:"w-5 h-5 mr-2 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0"})]),w(" Configuración TTN (The Things Network) ")],-1)),t("div",Y,[t("div",null,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," TTN Region ",-1)),n(t("select",{"onUpdate:modelValue":e[5]||(e[5]=i=>s(o).ttn_region=i),class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"},e[21]||(e[21]=[f('<option value="">Seleccionar región</option><option value="eu1">Europe 1 (eu1)</option><option value="nam1">North America 1 (nam1)</option><option value="au1">Australia 1 (au1)</option><option value="as1">Asia 1 (as1)</option>',5)]),512),[[U,s(o).ttn_region]]),e[23]||(e[23]=t("p",{class:"text-xs text-gray-500 mt-1"},"Región del servidor TTN",-1))]),t("div",null,[e[24]||(e[24]=t("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," TTN Application ID ",-1)),n(t("input",{"onUpdate:modelValue":e[6]||(e[6]=i=>s(o).ttn_app_id=i),type:"text",class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"my-ttn-application"},null,512),[[d,s(o).ttn_app_id]]),e[25]||(e[25]=t("p",{class:"text-xs text-gray-500 mt-1"},"ID de la aplicación en TTN",-1))]),t("div",null,[e[26]||(e[26]=t("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," TTN Access Key ",-1)),n(t("input",{"onUpdate:modelValue":e[7]||(e[7]=i=>s(o).ttn_access_key=i),type:"password",class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent font-mono",placeholder:"••••••••••••••••"},null,512),[[d,s(o).ttn_access_key]]),e[27]||(e[27]=t("p",{class:"text-xs text-gray-500 mt-1"},"Clave de acceso para la API TTN",-1))])]),e[29]||(e[29]=f('<div class="mt-4 p-3 bg-blue-900/20 border border-blue-500/30 rounded-lg"><div class="flex items-start"><svg class="w-5 h-5 text-blue-400 mt-0.5 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><div class="text-sm text-blue-300"><p class="font-medium mb-1">Configuración TTN</p><p>Los campos TTN son necesarios para el control remoto de la bomba de riego a través de The Things Network.</p></div></div></div>',1))]),t("div",Z,[t("button",{type:"button",onClick:N,class:"px-6 py-2 bg-gray-600 hover:bg-gray-500 text-white rounded-md transition-colors"}," Cancelar "),t("button",{type:"submit",disabled:s(u),class:"px-6 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-800 disabled:cursor-not-allowed text-white rounded-md transition-colors flex items-center"},[s(u)?(m(),c("div",ee)):M("",!0),w(" "+v(s(u)?"Guardando...":"Guardar Cambios"),1)],8,$)])],32)]))]))}};export{de as default};
