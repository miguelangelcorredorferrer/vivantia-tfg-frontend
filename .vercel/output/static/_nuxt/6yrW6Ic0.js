import{L as k,r as v,p as i}from"./Z3C1zjOC.js";import{C as u}from"./DTkYgPEM.js";const K=k("crop",()=>{const s=v([]),l=v(null),p=v([]),a=v(!1),C=v(!1),c=v({search:"",category:"",session:"",selectedOnly:!1}),y=i(()=>{let e=s.value||[];if(c.value.search){const r=c.value.search.toLowerCase();e=e.filter(o=>{var t;return o.name.toLowerCase().includes(r)||((t=o.description)==null?void 0:t.toLowerCase().includes(r))})}return c.value.category&&(e=e.filter(r=>r.category===c.value.category)),c.value.session&&(e=e.filter(r=>r.session===c.value.session)),c.value.selectedOnly&&(e=e.filter(r=>r.selected)),e}),h=i(()=>s.value.length>0),S=i(()=>!!l.value),w=i(()=>s.value.length),m=i(()=>{var e;return((e=l.value)==null?void 0:e.name)||""}),b=i(()=>{var e;return((e=l.value)==null?void 0:e.selected)||!1}),E=i(()=>l.value),I=async()=>{try{a.value=!0,console.log("🔄 CropStore: Obteniendo todos los cultivos (solo para admin)...");const e=await u.getAll();return s.value=e.data||[],console.log("✅ CropStore: Todos los cultivos obtenidos:",s.value.length),{success:!0,data:s.value}}catch(e){throw console.error("❌ CropStore: Error obteniendo todos los cultivos:",e),e}finally{a.value=!1}},f=async()=>{try{console.log("🔄 CropStore: Obteniendo categorías...");const e=await u.getCategories();return p.value=e.data||[],console.log("✅ CropStore: Categorías obtenidas:",p.value.length),{success:!0,data:p.value}}catch(e){throw console.error("❌ CropStore: Error obteniendo categorías:",e),e}},O=async e=>{try{a.value=!0,console.log("🔄 CropStore: Obteniendo cultivo por ID:",e);const o=(await u.getById(e)).data,t=s.value.findIndex(n=>n.id===e);return t!==-1?s.value[t]=o:s.value.push(o),console.log("✅ CropStore: Cultivo obtenido:",o.name),{success:!0,data:o}}catch(r){throw console.error("❌ CropStore: Error obteniendo cultivo:",r),r}finally{a.value=!1}},x=async e=>{var r;try{console.log("🔄 CropStore: Obteniendo cultivo del usuario:",e);const t=(await u.getCropByUserId(e)).data;return l.value=t,console.log("✅ CropStore: Cultivo del usuario obtenido:",t.name),{success:!0,data:t}}catch(o){if(console.error("❌ CropStore: Error obteniendo cultivo del usuario:",o),l.value=null,((r=o.response)==null?void 0:r.status)===404)return console.log("✅ CropStore: Usuario sin cultivo registrado (normal)"),{success:!0,data:null};throw o}},z=async e=>{var r;try{console.log("🔄 CropStore: Obteniendo todos los cultivos del usuario:",e);const t=(await u.getAllCropsByUserId(e)).data||[];s.value=t;const n=t.find(d=>d.selected);return l.value=n||(t.length>0?t[0]:null),console.log("✅ CropStore: Todos los cultivos del usuario obtenidos:",t.length),{success:!0,data:t}}catch(o){if(console.error("❌ CropStore: Error obteniendo todos los cultivos del usuario:",o),s.value=[],l.value=null,((r=o.response)==null?void 0:r.status)===404)return console.log("✅ CropStore: Usuario sin cultivos registrados (normal)"),{success:!0,data:[]};throw o}},U=async e=>{try{console.log("🔄 CropStore: Obteniendo cultivo seleccionado del usuario:",e);const r=await u.getSelectedCropByUserId(e);return l.value=r.data,console.log("✅ CropStore: Cultivo seleccionado obtenido:",l.value.name),{success:!0,data:l.value}}catch(r){throw console.error("❌ CropStore: Error obteniendo cultivo seleccionado:",r),l.value=null,r}},A=async e=>{try{a.value=!0,console.log("🔄 CropStore: Creando cultivo:",e.name);const o=(await u.create(e)).data;return s.value.push(o),(!l.value||o.selected)&&(l.value=o),console.log("✅ CropStore: Cultivo creado:",o.name),{success:!0,data:o}}catch(r){throw console.error("❌ CropStore: Error creando cultivo:",r),r}finally{a.value=!1}},B=async(e,r)=>{var o;try{a.value=!0,console.log("🔄 CropStore: Actualizando cultivo:",e);const n=(await u.update(e,r)).data,d=s.value.findIndex(j=>j.id===e);return d!==-1&&(s.value[d]=n),((o=l.value)==null?void 0:o.id)===e&&(l.value=n),console.log("✅ CropStore: Cultivo actualizado:",n.name),{success:!0,data:n}}catch(t){throw console.error("❌ CropStore: Error actualizando cultivo:",t),t}finally{a.value=!1}},F=async e=>{try{a.value=!0,console.log("🔄 CropStore: Seleccionando cultivo:",e);const o=(await u.selectCrop(e)).data;return s.value.forEach(t=>{t.user_id===o.user_id&&(t.selected=t.id===e)}),l.value=o,s.value=[...s.value],console.log("✅ CropStore: Cultivo seleccionado:",o.name),{success:!0,data:o}}catch(r){throw console.error("❌ CropStore: Error seleccionando cultivo:",r),r}finally{a.value=!1}},L=async e=>{var r;try{a.value=!0,console.log("🔄 CropStore: Deseleccionando cultivo:",e);const t=(await u.deselectCrop(e)).data,n=s.value.findIndex(d=>d.id===e);return n!==-1&&(s.value[n]=t),((r=l.value)==null?void 0:r.id)===e&&(l.value={...l.value,selected:!1}),s.value=[...s.value],console.log("✅ CropStore: Cultivo deseleccionado:",t.name),{success:!0,data:t}}catch(o){throw console.error("❌ CropStore: Error deseleccionando cultivo:",o),o}finally{a.value=!1}},T=async e=>{var r;try{a.value=!0,console.log("🔄 CropStore: Eliminando cultivo:",e);const o=s.value.find(n=>n.id===e);await u.delete(e);const t=s.value.findIndex(n=>n.id===e);return t!==-1&&s.value.splice(t,1),((r=l.value)==null?void 0:r.id)===e&&(l.value=null),console.log("✅ CropStore: Cultivo eliminado:",o==null?void 0:o.name),{success:!0}}catch(o){throw console.error("❌ CropStore: Error eliminando cultivo:",o),o}finally{a.value=!1}},_=e=>{c.value.search=e},D=e=>{c.value.category=e},N=e=>{c.value.session=e},P=e=>{c.value.selectedOnly=e},g=()=>{c.value={search:"",category:"",session:"",selectedOnly:!1}};return{crops:s,currentCrop:l,categories:p,isLoading:a,isInitialized:C,filters:c,filteredCrops:y,hasCrops:h,hasCurrentCrop:S,cropsCount:w,currentCropName:m,isCurrentCropSelected:b,userCrop:E,fetchAllCrops:I,fetchCropCategories:f,fetchCropById:O,fetchUserCrop:x,fetchAllUserCrops:z,fetchSelectedCrop:U,createCrop:A,updateCrop:B,selectCrop:F,deselectCrop:L,deleteCrop:T,setSearchFilter:_,setCategoryFilter:D,setSessionFilter:N,setSelectedOnlyFilter:P,clearFilters:g,init:async()=>{try{console.log("🔄 CropStore: Inicializando..."),await f(),C.value=!0,console.log("✅ CropStore: Inicializado correctamente")}catch(e){console.error("❌ CropStore: Error inicializando:",e),C.value=!0}},reset:()=>{s.value=[],l.value=null,p.value=[],a.value=!1,C.value=!1,g()}}});export{K as u};
