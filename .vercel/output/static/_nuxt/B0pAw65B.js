import{_ as F,c as a,o as i,a as t,u as $e,r as p,I as We,p as U,q as Ne,l as C,y as je,M as Ve,i as g,k as s,b as x,t as d,j as He,H as z,F as E,x as T,m as M,h as I,s as le,d as m,v as ze,J as Y}from"./Z3C1zjOC.js";import{u as Fe}from"./DPZQ8nY_.js";import{u as Le,s as qe}from"./D6bpf8h9.js";import{u as Be}from"./6yrW6Ic0.js";import{W as Oe,P as Ue}from"./CFNf9je3.js";import{C as Ye}from"./RMTK5D86.js";import{W as G}from"./0mYkeiB8.js";import{u as Ge}from"./uy_vPcXx.js";import"./DTkYgPEM.js";const Je={},Ke={class:"w-12 h-12 text-white",fill:"currentColor",viewBox:"0 0 20 20"};function Qe(N,r){return i(),a("svg",Ke,r[0]||(r[0]=[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z","clip-rule":"evenodd"},null,-1)]))}const Xe=F(Je,[["render",Qe]]),Ze={},et={class:"w-6 h-6 text-white",fill:"currentColor",viewBox:"0 0 20 20"};function tt(N,r){return i(),a("svg",et,r[0]||(r[0]=[t("path",{"fill-rule":"evenodd",d:"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z","clip-rule":"evenodd"},null,-1)]))}const ot=F(Ze,[["render",tt]]),rt={},st={class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"};function nt(N,r){return i(),a("svg",st,r[0]||(r[0]=[t("path",{"fill-rule":"evenodd",d:"7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z","clip-rule":"evenodd"},null,-1)]))}const at=F(rt,[["render",nt]]),it={},lt={class:"w-8 h-8 text-green-400",fill:"currentColor",viewBox:"0 0 20 20"};function dt(N,r){return i(),a("svg",lt,r[0]||(r[0]=[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z","clip-rule":"evenodd"},null,-1)]))}const ct=F(it,[["render",dt]]),ut={class:"space-y-8"},gt={class:"max-w-2xl mx-auto"},mt={key:0,class:"bg-gray-800 rounded-xl shadow-lg p-6 mb-8 border border-gray-700"},ft={class:"text-center space-y-6"},bt={class:"flex justify-center"},vt={class:"w-24 h-24 bg-blue-500 rounded-full flex items-center justify-center shadow-lg animate-pulse"},pt={class:"bg-blue-900/30 border border-blue-700/50 rounded-lg p-4"},xt={class:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm"},yt={class:"font-bold text-white"},ht={class:"font-bold text-blue-400"},wt={class:"font-bold text-white"},Ct={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Mt={key:1,class:"bg-gray-800 rounded-xl shadow-lg p-6 mb-8 border border-gray-700"},Dt={class:"text-center space-y-6"},kt={class:"flex justify-center"},_t={class:"w-24 h-24 bg-green-500 rounded-full flex items-center justify-center shadow-lg"},Pt={class:"bg-green-900/30 border border-green-700/50 rounded-lg p-4"},St={class:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm"},At={class:"font-bold text-white"},Rt={class:"font-bold text-white"},Et={class:"font-bold text-white"},Tt={class:"font-bold text-green-400"},It={key:2,class:"bg-gray-800 rounded-xl shadow-lg p-6 mb-8 border border-gray-700"},$t={class:"text-center space-y-6"},Wt={class:"flex justify-center"},Nt={class:"w-24 h-24 bg-green-500 rounded-full flex items-center justify-center shadow-lg animate-pulse"},jt={class:"bg-green-900/30 border border-green-700/50 rounded-lg p-4"},Vt={class:"grid grid-cols-2 gap-4 text-sm"},Ht={class:"font-bold text-white"},zt={class:"space-y-3"},Ft={key:3,class:"bg-gray-800 rounded-xl shadow-lg p-6 mb-8 border border-gray-700"},Lt={class:"text-center space-y-6"},qt={class:"flex justify-center"},Bt={class:"w-24 h-24 bg-yellow-500 rounded-full flex items-center justify-center shadow-lg"},Ot={class:"bg-green-900/30 border border-green-700/50 rounded-lg p-4"},Ut={class:"grid grid-cols-2 gap-4 text-sm"},Yt={class:"font-bold text-white"},Gt={class:"space-y-3"},Jt={class:"bg-gray-800 rounded-xl shadow-lg p-6 mb-8 border border-gray-700"},Kt={class:"flex items-center mb-4"},Qt={class:"w-12 h-12 bg-gradient-to-br from-green-500 to-green-600 rounded-full flex items-center justify-center mr-4 shadow-lg"},Xt={key:4,class:"bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-700"},Zt={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},eo={class:"bg-gray-700 rounded-lg p-4 border border-gray-600"},to={class:"flex items-center justify-between mb-3"},oo={class:"text-white font-semibold"},ro={class:"grid grid-cols-7 gap-1 mb-2"},so={class:"grid grid-cols-7 gap-1"},no=["onClick"],ao={class:"bg-gray-700 rounded-lg p-4 border border-gray-600"},io={class:"grid grid-cols-2 gap-4"},lo=["value"],co=["value"],uo={class:"text-sm text-gray-300 mt-3"},go={class:"font-semibold text-green-400"},mo={key:0,class:"text-sm text-green-400 mt-1"},fo={class:"grid grid-cols-2 md:grid-cols-4 gap-3"},bo=["onClick"],vo={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},po={class:"text-center"},xo={key:0,class:"absolute top-2 right-2 w-6 h-6 bg-green-500 rounded-full flex items-center justify-center"},yo={class:"text-center"},ho={key:0,class:"absolute top-2 right-2 w-6 h-6 bg-green-500 rounded-full flex items-center justify-center"},wo={class:"text-center"},Co={key:0,class:"absolute top-2 right-2 w-6 h-6 bg-green-500 rounded-full flex items-center justify-center"},Mo={key:0,class:"mt-6"},Do={class:"grid grid-cols-7 gap-2"},ko=["onClick"],_o={class:"text-sm font-medium"},Po={key:0,class:"absolute -top-1 -right-1 w-5 h-5 bg-green-500 rounded-full flex items-center justify-center"},So={key:0,class:"mt-3 p-3 bg-green-900/20 border border-green-700/50 rounded-lg"},Ao={class:"text-sm text-green-300"},Ro={class:"bg-gray-700 rounded-lg p-4 border border-gray-600"},Eo={class:"space-y-3"},To={class:"flex items-center"},Io=["disabled"],$o={class:"ml-2 text-sm text-gray-300"},Wo={key:0,class:"text-gray-500 text-xs ml-1"},No={class:"flex items-center"},jo={class:"flex items-center"},Vo={class:"bg-blue-900/30 border border-blue-700/50 rounded-lg p-4"},Ho={class:"text-sm text-blue-200 space-y-1"},zo={class:"flex space-x-4"},Fo=["disabled"],Lo={key:5,class:"bg-orange-900/60 border border-orange-500/30 rounded-xl shadow-lg p-6"},qo={class:"text-center"},Bo={class:"w-16 h-16 bg-orange-500 rounded-full flex items-center justify-center mx-auto mb-4"},Oo={class:"text-lg font-bold text-white mb-2"},Uo={class:"bg-orange-800/40 border border-orange-500/40 rounded-lg p-3 mb-4"},Yo={class:"text-sm text-orange-200"},Go={key:0,class:"max-w-2xl mx-auto"},Jo={class:"bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-700"},Ko={class:"text-center space-y-4"},Qo={class:"text-gray-300"},Xo={class:"text-blue-400"},Zo={class:"text-center"},er={class:"w-16 h-16 bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-4 border border-green-700/50"},tr={class:"text-gray-300 mb-6"},or={class:"text-center"},rr={class:"w-16 h-16 bg-red-900/60 border border-red-500/30 rounded-full flex items-center justify-center mx-auto mb-4"},sr={class:"text-center"},nr={class:"w-16 h-16 bg-red-900/60 border border-red-500/30 rounded-full flex items-center justify-center mx-auto mb-4"},br={__name:"programado",setup(N){const r=Le(),D=$e(),k=Be(),J=p(new Date),c=p({hour:7,minute:0}),_=p({minutes:5}),u=p("once"),f=p([]),y=p({notifyBeforeStart:!0,notifyStart:!0,notifyEnd:!0}),j=p(!1),S=p(!1),V=p(!1),h=p(new Date),w=p(new Date),K=["Lun","Mar","Mié","Juv","Vie","Sáb","Dom"],de=[{label:"06:00",hour:6,minute:0},{label:"07:00",hour:7,minute:0},{label:"08:30",hour:8,minute:30},{label:"18:00",hour:18,minute:0}],{toast:Q}=Fe(),$=We(),P=o=>Q.success(o),b=o=>Q.error(o),ce=U(()=>h.value.toLocaleDateString("es-ES",{month:"long",year:"numeric"})),ue=U(()=>{const o=h.value.getFullYear(),e=h.value.getMonth(),l=new Date(o,e,1),n=new Date(l);n.setDate(n.getDate()-(l.getDay()||7)+1);const v=[],ie=new Date;for(let O=0;O<42;O++){const R=new Date(n);R.setDate(n.getDate()+O);const Ee=R.getMonth()===e,Te=R.toDateString()===ie.toDateString(),Ie=R.toDateString()===w.value.toDateString();v.push({date:R.toISOString(),dayNumber:R.getDate(),isCurrentMonth:Ee,isToday:Te,isSelected:Ie})}return v}),ge=o=>{o.isCurrentMonth&&(w.value=new Date(o.date),J.value=new Date(o.date))},me=()=>{h.value=new Date(h.value.getFullYear(),h.value.getMonth()-1,1)},fe=()=>{h.value=new Date(h.value.getFullYear(),h.value.getMonth()+1,1)},L=()=>{const o=w.value.toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"}),e=be();return`${o} a las ${e}`},be=()=>{const o=String(c.value.hour).padStart(2,"0"),e=String(c.value.minute).padStart(2,"0");return`${o}:${e}`},X=()=>{const o=_.value.minutes||0;return o===0?"No configurado":`${o} min`},ve=()=>((_.value.minutes||0)*2.5).toFixed(1),q=()=>{const o=new Date,e=new Date(w.value);e.setHours(c.value.hour,c.value.minute,0,0);const l=e-o;if(l<=0)return"La fecha/hora ya ha pasado";const n=Math.floor(l/(1e3*60));return n<60?`Faltan ${n} minutos`:`Faltan ${Math.floor(n/60)}h ${n%60}min`},Z=U(()=>{const o=new Date,e=new Date(w.value);e.setHours(c.value.hour,c.value.minute,0,0);const l=e-o;return Math.floor(l/(1e3*60))>=10}),ee=()=>{const o=new Date,e=new Date(w.value);e.setHours(c.value.hour,c.value.minute,0,0);const l=_.value.minutes>0,n=e>o;return u.value==="custom"&&f.value.length===0?!1:l&&n},pe=o=>{c.value.hour=o.hour,c.value.minute=o.minute},B=o=>{u.value=o,o!=="custom"&&(f.value=[])},xe=o=>{const e=f.value.indexOf(o);e>-1?f.value.splice(e,1):f.value.push(o),f.value.sort()},te=()=>{if(f.value.length===0)return"Ningún día seleccionado";const o=["Lunes","Martes","Miércoles","Jueves","Viernes","Sábado","Domingo"],e=f.value.map(l=>o[l]);if(e.length===1)return e[0];if(e.length===2)return`${e[0]} y ${e[1]}`;{const l=e.pop();return`${e.join(", ")} y ${l}`}},ye=()=>{switch(u.value){case"once":return"Solo una vez";case"daily":return"Diariamente a la misma hora";case"custom":return`Días específicos: ${te()}`;default:return"No configurado"}},he=()=>{if(!ee()){_.value.minutes===0?b("Por favor, configura una duración válida para el riego"):u.value==="custom"&&f.value.length===0?b("Por favor, selecciona al menos un día de la semana para el riego personalizado"):b("La fecha y hora programada debe ser futura");return}j.value=!0},we=async()=>{if(console.log("saveScheduledWatering llamado"),!D.user||!D.user.id){console.error("❌ Usuario no autenticado:",D.user),b("Error: Usuario no autenticado. Por favor, inicia sesión nuevamente.");return}if(!k.currentCrop||!k.currentCrop.id){console.error("❌ No hay cultivo seleccionado:",k.currentCrop),b("Error: No hay cultivo seleccionado. Por favor, selecciona un cultivo.");return}if(j.value=!1,!w.value){console.error("❌ selectedDate.value es undefined o null"),b("Error: Fecha no seleccionada");return}const o=new Date(w.value);if(c.value.hour===void 0||c.value.minute===void 0){console.error("❌ scheduledTime.value no tiene hour o minute definidos:",c.value),b("Error: Hora no configurada correctamente");return}o.setHours(c.value.hour,c.value.minute,0,0);const e=new Date(o.getTime()-o.getTimezoneOffset()*6e4).toISOString();console.log("🔍 Datos de configuración:",{user:D.user,crop:k.currentCrop,scheduledDateTime:e,originalDate:o,timezoneOffset:o.getTimezoneOffset()});const l={user_id:D.user.id,crop_id:k.currentCrop.id,start_datetime:e,end_date:null,duration_minutes:_.value.minutes||0,frequency_type:u.value,custom_days:u.value==="custom"?f.value:[],notify_before_minutes:y.value.notifyBeforeStart?5:0,notify_at_start:y.value.notifyStart,notify_at_end:y.value.notifyEnd};console.log("Configuración enviada:",l),await r.startProgrammedIrrigation(l)&&(P("Riego programado configurado exitosamente"),setTimeout(async()=>{await r.loadActiveConfiguration(),r.isProgrammedActive&&W()},500),setTimeout(()=>{$.push("/modo")},1500))},Ce=async()=>{await r.pauseIrrigation()&&P("Riego pausado")},Me=async()=>{await r.resumeIrrigation()&&P("Riego reanudado")},oe=()=>{$.push("/modo")},De=async()=>{console.log("🟡 cancelProgrammedMode llamado");try{S.value=!1,console.log("🔄 Llamando a irrigationStore.cancelActiveMode()...");const o=await r.cancelActiveMode();console.log("📊 Resultado cancelActiveMode:",o),o?(console.log("✅ Configuración cancelada exitosamente"),P("Configuración programada cancelada"),setTimeout(async()=>{console.log("🔄 Forzando recarga del estado después de cancelación"),await r.loadActiveConfiguration(),r.isProgrammedActive&&(console.warn("⚠️ El estado aún muestra configuración activa, forzando limpieza"),H(),await r.loadActiveConfiguration())},500)):(console.log("❌ cancelActiveMode retornó false"),b("No se pudo cancelar la configuración"))}catch(o){console.error("❌ Error al cancelar configuración:",o),b("Error al cancelar la configuración: "+o.message)}},re=()=>{console.log("closeCancelModal llamado");try{S.value=!1,console.log("Modal cerrado exitosamente")}catch(o){console.error("Error al cerrar modal:",o)}},se=()=>{console.log("closeConfirmModal llamado");try{j.value=!1,console.log("Modal de confirmación cerrado exitosamente")}catch(o){console.error("Error al cerrar modal de confirmación:",o)}},ke=async()=>{try{await r.pauseIrrigation(),P("Riego pausado correctamente")}catch(o){console.error("Error pausando riego programado:",o),b("Error al pausar el riego")}},_e=async()=>{try{await r.resumeIrrigation(),P("Riego reanudado correctamente")}catch(o){console.error("Error reanudando riego programado:",o),b("Error al reanudar el riego")}},Pe=async()=>{var o,e,l,n;try{V.value=!1,await r.cancelActiveMode(),P("Riego programado cancelado correctamente"),(((o=r.specificConfig)==null?void 0:o.frequency_type)==="daily"||((e=r.specificConfig)==null?void 0:e.frequency_type)==="custom"&&((n=(l=r.specificConfig)==null?void 0:l.custom_days)==null?void 0:n.length)>1)&&showInfo("El riego se reprogramará automáticamente para el próximo día configurado")}catch(v){console.error("Error cancelando riego programado activo:",v),b("Error al cancelar el riego")}},ne=()=>{V.value=!1},Se=()=>{var e;return(e=r.specificConfig)!=null&&e.start_datetime?new Date(r.specificConfig.start_datetime).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"}):"No configurado"},Ae=()=>{var e;return(e=r.specificConfig)!=null&&e.start_datetime?new Date(r.specificConfig.start_datetime).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}):"No configurado"},ae=()=>{var e;const o=((e=r.irrigationConfig)==null?void 0:e.duration_minutes)||0;return o===0?"No configurado":`${o} min`},Re=()=>{const o=r.activeMode;o==="manual"?$.push("/modo/manual"):o==="automatic"?$.push("/modo/automatico"):$.push("/modo")};Ne(async()=>{var o;console.log("🚀 onMounted - Cargando configuración...");try{const e=new Date,l=new Date(e.getTime()+600*1e3);J.value=new Date(l),w.value=new Date(l),c.value.hour=l.getHours(),c.value.minute=l.getMinutes()}catch(e){console.error("Error estableciendo fecha/hora inicial futura:",e)}try{console.log("📊 Estado de stores en onMounted:",{user:D.user,currentCrop:k.currentCrop,isAuthenticated:D.isAuthenticated,cropSelected:(o=k.currentCrop)==null?void 0:o.selected}),await r.loadActiveConfiguration(),console.log("✅ Configuración activa cargada"),await new Promise(e=>setTimeout(e,100)),(r.isProgrammedActive||r.isWatering||r.isPaused)&&(console.log("🚀 [ONMOUNTED] Detectada actividad programada, iniciando monitoreo inmediato"),W())}catch(e){console.error("❌ Error en onMounted:",e),b("Error al cargar la configuración: "+e.message)}}),C(()=>r.hasActiveMode,o=>{console.log("🔄 hasActiveMode cambió a:",o)}),C(()=>r.isProgrammedActive,o=>{console.log("🔄 isProgrammedActive cambió a:",o)}),C(()=>r.isProgrammedWaiting,o=>{console.log("🔄 isProgrammedWaiting cambió a:",o)}),C(()=>r.activeMode,o=>{console.log("🔄 activeMode cambió a:",o)}),C(()=>r.activePumpActivation,o=>{console.log("🔄 activePumpActivation cambió a:",o)}),C(()=>r.isWatering,o=>{console.log("🔄 isWatering cambió a:",o)});let A=null;const W=()=>{A&&clearInterval(A),r.loadActiveConfiguration(),A=qe(async()=>{var o,e,l;(o=r.irrigationConfig)!=null&&o.id&&(await r.loadActiveConfiguration(),console.log("🔍 [PROGRAMMED-MONITOR] Estado actual:",{activeMode:r.activeMode,isProgrammedActive:r.isProgrammedActive,isProgrammedWaiting:r.isProgrammedWaiting,isWatering:r.isWatering,isPaused:r.isPaused,pumpStatus:(e=r.activePumpActivation)==null?void 0:e.status,hasActiveMode:r.hasActiveMode,irrigationConfigId:(l=r.irrigationConfig)==null?void 0:l.id}))},3e3),console.log("✅ [PROGRAMMED] Monitoreo de estado iniciado")},H=()=>{A&&(clearInterval(A),A=null,console.log("🛑 [PROGRAMMED] Monitoreo de estado detenido"))};return C(()=>r.isProgrammedActive,(o,e)=>{console.log("🔄 isProgrammedActive cambió:",{oldValue:e,newValue:o,activeMode:r.activeMode}),o?(console.log("🚀 [WATCHER] Iniciando monitoreo por isProgrammedActive"),W()):(console.log("🛑 [WATCHER] Deteniendo monitoreo por isProgrammedActive"),H())},{immediate:!0}),C(()=>r.activeMode,(o,e)=>{console.log("🔄 activeMode cambió:",{oldMode:e,newMode:o}),o==="programmed"?(console.log("🚀 [WATCHER] Iniciando monitoreo por activeMode programmed"),W()):e==="programmed"&&o!=="programmed"&&(console.log("🛑 [WATCHER] Deteniendo monitoreo por activeMode ya no programmed"),H())},{immediate:!0}),C(()=>r.isWatering,o=>{console.log("🔄 isWatering cambió a:",o),(o||r.isPaused)&&W()},{immediate:!0}),je(()=>{H(),r.cleanup()}),Ge({title:"Modo Programado - VIVANTIA",meta:[{name:"description",content:"Configuración del modo programado de riego"}]}),(o,e)=>{const l=Ve("WateringIcon");return i(),a("div",ut,[t("div",gt,[s(r).isProgrammedWatering?(i(),a("div",mt,[e[21]||(e[21]=t("h2",{class:"text-xl font-bold text-white mb-6"},"Riego Programado Activo",-1)),t("div",ft,[t("div",bt,[t("div",vt,[x(l)])]),t("div",pt,[e[20]||(e[20]=t("h3",{class:"font-semibold text-blue-300 mb-3"},"Estado del Riego",-1)),t("div",xt,[t("div",null,[e[16]||(e[16]=t("p",{class:"text-gray-400"},"Estado:",-1)),t("p",yt,d(s(r).isPaused?"Pausado":"Regando"),1)]),t("div",null,[e[17]||(e[17]=t("p",{class:"text-gray-400"},"Tiempo Restante:",-1)),t("p",ht,d(s(r).remainingTime||"Calculando..."),1)]),t("div",null,[e[18]||(e[18]=t("p",{class:"text-gray-400"},"Duración Total:",-1)),t("p",wt,d(ae()),1)]),e[19]||(e[19]=t("div",null,[t("p",{class:"text-gray-400"},"Modo:"),t("p",{class:"font-bold text-white"},"Programado")],-1))])]),t("div",Ct,[s(r).isPaused?(i(),a("button",{key:1,onClick:_e,class:"px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white font-bold rounded-lg hover:from-green-600 hover:to-green-700 transform hover:scale-105 transition-all duration-200 shadow-lg"}," ▶️ Reanudar Riego ")):(i(),a("button",{key:0,onClick:ke,class:"px-6 py-3 bg-gradient-to-r from-yellow-500 to-yellow-600 text-white font-bold rounded-lg hover:from-yellow-600 hover:to-yellow-700 transform hover:scale-105 transition-all duration-200 shadow-lg"}," ⏸️ Pausar Riego ")),t("button",{onClick:e[0]||(e[0]=n=>V.value=!0),class:"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white font-bold rounded-lg hover:from-red-600 hover:to-red-700 transform hover:scale-105 transition-all duration-200 shadow-lg"}," 🛑 Cancelar Riego ")])])])):g("",!0),s(r).isProgrammedActive&&!s(r).isWatering&&!s(r).isPaused?(i(),a("div",Mt,[e[27]||(e[27]=t("h2",{class:"text-xl font-bold text-white mb-6"},"Riego Programado Configurado",-1)),t("div",Dt,[t("div",kt,[t("div",_t,[x(s(Xe))])]),t("div",Pt,[e[26]||(e[26]=t("h3",{class:"font-semibold text-green-300 mb-3"},"Información del Riego Programado",-1)),t("div",St,[t("div",null,[e[22]||(e[22]=t("p",{class:"text-gray-400"},"Fecha Programada:",-1)),t("p",At,d(Se()),1)]),t("div",null,[e[23]||(e[23]=t("p",{class:"text-gray-400"},"Hora Programada:",-1)),t("p",Rt,d(Ae()),1)]),t("div",null,[e[24]||(e[24]=t("p",{class:"text-gray-400"},"Duración:",-1)),t("p",Et,d(ae()),1)]),t("div",null,[e[25]||(e[25]=t("p",{class:"text-gray-400"},"Tiempo Restante:",-1)),t("p",Tt,d(s(r).remainingTime||"Calculando..."),1)])])]),t("button",{onClick:e[1]||(e[1]=n=>S.value=!0),class:"w-full px-6 py-4 bg-gradient-to-r from-red-500 to-red-600 text-white font-bold text-lg rounded-lg hover:from-red-600 hover:to-red-700 transform hover:scale-105 transition-all duration-200 shadow-lg"}," 🗑️ Deshacer Configuración ")])])):g("",!0),s(r).isProgrammedActive&&s(r).isWatering&&!s(r).isPaused?(i(),a("div",It,[e[31]||(e[31]=t("h2",{class:"text-xl font-bold text-white mb-6"},"Riego Programado Activo",-1)),t("div",$t,[t("div",Wt,[t("div",Nt,[x(s(Oe))])]),t("div",jt,[e[30]||(e[30]=t("h3",{class:"font-semibold text-green-300 mb-3"},"Información del Riego",-1)),t("div",Vt,[e[29]||(e[29]=t("div",null,[t("p",{class:"text-gray-400"},"Estado:"),t("p",{class:"font-bold text-white"},"Bomba Activa")],-1)),t("div",null,[e[28]||(e[28]=t("p",{class:"text-gray-400"},"Tiempo Restante:",-1)),t("p",Ht,d(s(r).remainingTime||"Calculando..."),1)])])]),t("div",zt,[t("button",{onClick:Ce,class:"w-full px-6 py-4 bg-gradient-to-r from-yellow-500 to-yellow-600 text-white font-bold text-lg rounded-lg hover:from-yellow-600 hover:to-yellow-700 transform hover:scale-105 transition-all duration-200 shadow-lg"}," ⏸️ Parada de Emergencia "),t("button",{onClick:e[2]||(e[2]=n=>S.value=!0),class:"w-full px-6 py-4 bg-gradient-to-r from-red-500 to-red-600 text-white font-bold text-lg rounded-lg hover:from-red-600 hover:to-red-700 transform hover:scale-105 transition-all duration-200 shadow-lg"}," 🛑 Cancelar Riego Programado ")])])])):g("",!0),s(r).isProgrammedActive&&s(r).isPaused?(i(),a("div",Ft,[e[35]||(e[35]=t("h2",{class:"text-xl font-bold text-white mb-6"},"Riego Programado Pausado",-1)),t("div",Lt,[t("div",qt,[t("div",Bt,[x(s(Ue))])]),t("div",Ot,[e[34]||(e[34]=t("h3",{class:"font-semibold text-green-300 mb-3"},"Información del Riego",-1)),t("div",Ut,[e[33]||(e[33]=t("div",null,[t("p",{class:"text-gray-400"},"Estado:"),t("p",{class:"font-bold text-white"},"Pausado")],-1)),t("div",null,[e[32]||(e[32]=t("p",{class:"text-gray-400"},"Tiempo Restante:",-1)),t("p",Yt,d(s(r).remainingTime||"Calculando..."),1)])])]),t("div",Gt,[t("button",{onClick:Me,class:"w-full px-6 py-4 bg-gradient-to-r from-green-500 to-green-600 text-white font-bold text-lg rounded-lg hover:from-green-600 hover:to-green-700 transform hover:scale-105 transition-all duration-200 shadow-lg"}," ▶️ Reanudar Riego "),t("button",{onClick:e[3]||(e[3]=n=>S.value=!0),class:"w-full px-6 py-4 bg-gradient-to-r from-red-500 to-red-600 text-white font-bold text-lg rounded-lg hover:from-red-600 hover:to-red-700 transform hover:scale-105 transition-all duration-200 shadow-lg"}," 🛑 Cancelar Riego Programado ")])])])):g("",!0),t("div",Jt,[t("div",Kt,[t("div",Qt,[x(s(ot))]),e[36]||(e[36]=t("div",null,[t("h1",{class:"text-2xl font-bold text-white"},"Modo Programado"),t("p",{class:"text-gray-300"},"Programa el riego para fechas y horas específicas")],-1))]),e[37]||(e[37]=He('<div class="bg-green-900/30 border border-green-700/50 rounded-lg p-4"><h3 class="font-semibold text-green-300 mb-2">¿Cómo funciona el modo programado?</h3><ul class="text-sm text-green-200 space-y-1"><li>• Selecciona la fecha y hora específica para activar el riego</li><li>• La bomba se activará automáticamente en el momento programado</li><li>• Configura la duración del riego</li><li>• Ideal para establecer rutinas de riego regulares</li></ul></div><div class="bg-yellow-900/30 border border-yellow-500/30 rounded-lg p-4 mt-4"><h3 class="font-semibold text-yellow-400 mb-2">⚠️ Advertencia Importante</h3><p class="text-sm text-yellow-300"><strong>Tiempo de respuesta del sistema:</strong> La bomba puede tardar entre 2-15 segundos en activarse al iniciar el riego y entre 2-15 segundos en detenerse al cancelar o pausar. Este tiempo es normal debido a la comunicación LoRaWAN con el dispositivo IoT. </p></div>',2))]),!s(r).isProgrammedWaiting&&!s(r).isWatering&&!s(r).isPaused?(i(),a("div",Xt,[e[72]||(e[72]=t("h2",{class:"text-xl font-bold text-white mb-6"},"Configurar Riego Programado",-1)),t("form",{onSubmit:z(he,["prevent"]),class:"space-y-6"},[t("div",Zt,[t("div",null,[e[38]||(e[38]=t("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," Fecha de Activación ",-1)),t("div",eo,[t("div",to,[t("button",{type:"button",onClick:me,class:"p-2 text-gray-400 hover:text-white transition-colors"},[x(s(Ye))]),t("h3",oo,d(s(ce)),1),t("button",{type:"button",onClick:fe,class:"p-2 text-gray-400 hover:text-white transition-colors"},[x(s(at))])]),t("div",ro,[(i(),a(E,null,T(K,n=>t("div",{key:n,class:"text-center text-xs text-gray-400 py-1"},d(n),1)),64))]),t("div",so,[(i(!0),a(E,null,T(s(ue),n=>(i(),a("div",{key:n.date,onClick:v=>ge(n),class:M(["text-center py-2 text-sm cursor-pointer rounded transition-colors",n.isCurrentMonth?n.isSelected?"bg-green-600 text-white":n.isToday?"bg-blue-600 text-white":"text-white hover:bg-gray-600":"text-gray-600 cursor-not-allowed"])},d(n.dayNumber),11,no))),128))])])]),t("div",null,[e[42]||(e[42]=t("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," Hora de Activación ",-1)),t("div",ao,[t("div",io,[t("div",null,[e[39]||(e[39]=t("label",{class:"block text-xs text-gray-400 mb-1"},"Hora",-1)),I(t("select",{"onUpdate:modelValue":e[4]||(e[4]=n=>s(c).hour=n),class:"w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white"},[(i(),a(E,null,T(24,n=>t("option",{key:n,value:n-1},d(String(n-1).padStart(2,"0")),9,lo)),64))],512),[[le,s(c).hour]])]),t("div",null,[e[40]||(e[40]=t("label",{class:"block text-xs text-gray-400 mb-1"},"Minutos",-1)),I(t("select",{"onUpdate:modelValue":e[5]||(e[5]=n=>s(c).minute=n),class:"w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white"},[(i(),a(E,null,T(60,n=>t("option",{key:n,value:n-1},d(String(n-1).padStart(2,"0")),9,co)),64))],512),[[le,s(c).minute]])])]),t("p",uo,[e[41]||(e[41]=m(" Hora programada: ")),t("span",go,d(L()),1)]),q()?(i(),a("p",mo,d(q()),1)):g("",!0)])])]),t("div",null,[e[44]||(e[44]=t("label",{class:"block text-sm font-medium text-gray-300 mb-2"}," Duración del Riego ",-1)),t("div",null,[e[43]||(e[43]=t("label",{class:"block text-xs text-gray-400 mb-1"},"Minutos",-1)),I(t("input",{"onUpdate:modelValue":e[6]||(e[6]=n=>s(_).minutes=n),type:"number",min:"1",max:"1440",class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-white",placeholder:"5"},null,512),[[ze,s(_).minutes,void 0,{number:!0}]])])]),t("div",null,[e[45]||(e[45]=t("label",{class:"block text-sm font-medium text-gray-300 mb-3"}," Horarios Sugeridos ",-1)),t("div",fo,[(i(),a(E,null,T(de,n=>t("button",{key:n.label,type:"button",onClick:v=>pe(n),class:"p-3 text-sm font-medium text-green-300 bg-green-900/30 border border-green-700/50 rounded-lg hover:bg-green-800/50 transition-colors"},d(n.label),9,bo)),64))])]),t("div",null,[e[61]||(e[61]=t("label",{class:"block text-sm font-medium text-gray-300 mb-4"}," Frecuencia de Riego ",-1)),t("div",vo,[t("div",{onClick:e[7]||(e[7]=n=>B("once")),class:"relative cursor-pointer group"},[t("div",{class:M(["p-4 rounded-xl border-2 transition-all duration-200",s(u)==="once"?"border-green-500 bg-green-900/20 shadow-lg shadow-green-500/20":"border-gray-600 bg-gray-700/50 hover:border-gray-500 hover:bg-gray-700"])},[t("div",po,[t("div",{class:M(["w-12 h-12 mx-auto mb-3 rounded-full flex items-center justify-center",s(u)==="once"?"bg-green-500":"bg-gray-600"])},e[46]||(e[46]=[t("span",{class:"text-xl"},"1️⃣",-1)]),2),e[47]||(e[47]=t("h3",{class:"font-semibold text-white mb-2"},"Solo una vez",-1)),e[48]||(e[48]=t("p",{class:"text-sm text-gray-400"},"Riego único en la fecha y hora seleccionada",-1))]),s(u)==="once"?(i(),a("div",xo,e[49]||(e[49]=[t("span",{class:"text-white text-sm"},"✓",-1)]))):g("",!0)],2)]),t("div",{onClick:e[8]||(e[8]=n=>B("daily")),class:"relative cursor-pointer group"},[t("div",{class:M(["p-4 rounded-xl border-2 transition-all duration-200",s(u)==="daily"?"border-green-500 bg-green-900/20 shadow-lg shadow-green-500/20":"border-gray-600 bg-gray-700/50 hover:border-gray-500 hover:bg-gray-700"])},[t("div",yo,[t("div",{class:M(["w-12 h-12 mx-auto mb-3 rounded-full flex items-center justify-center",s(u)==="daily"?"bg-green-500":"bg-gray-600"])},e[50]||(e[50]=[t("span",{class:"text-xl"},"🔄",-1)]),2),e[51]||(e[51]=t("h3",{class:"font-semibold text-white mb-2"},"Diariamente",-1)),e[52]||(e[52]=t("p",{class:"text-sm text-gray-400"},"Riego automático todos los días a la misma hora",-1))]),s(u)==="daily"?(i(),a("div",ho,e[53]||(e[53]=[t("span",{class:"text-white text-sm"},"✓",-1)]))):g("",!0)],2)]),t("div",{onClick:e[9]||(e[9]=n=>B("custom")),class:"relative cursor-pointer group"},[t("div",{class:M(["p-4 rounded-xl border-2 transition-all duration-200",s(u)==="custom"?"border-green-500 bg-green-900/20 shadow-lg shadow-green-500/20":"border-gray-600 bg-gray-700/50 hover:border-gray-500 hover:bg-gray-700"])},[t("div",wo,[t("div",{class:M(["w-12 h-12 mx-auto mb-3 rounded-full flex items-center justify-center",s(u)==="custom"?"bg-green-500":"bg-gray-600"])},e[54]||(e[54]=[t("span",{class:"text-xl"},"📅",-1)]),2),e[55]||(e[55]=t("h3",{class:"font-semibold text-white mb-2"},"Días específicos",-1)),e[56]||(e[56]=t("p",{class:"text-sm text-gray-400"},"Elegir los días de la semana para el riego",-1))]),s(u)==="custom"?(i(),a("div",Co,e[57]||(e[57]=[t("span",{class:"text-white text-sm"},"✓",-1)]))):g("",!0)],2)])]),s(u)==="custom"?(i(),a("div",Mo,[e[60]||(e[60]=t("label",{class:"block text-sm font-medium text-gray-300 mb-3"}," Seleccionar días de la semana ",-1)),t("div",Do,[(i(),a(E,null,T(K,(n,v)=>t("div",{key:v,onClick:ie=>xe(v),class:"relative cursor-pointer group"},[t("div",{class:M(["p-3 rounded-lg border-2 text-center transition-all duration-200",s(f).includes(v)?"border-green-500 bg-green-900/30 text-green-300":"border-gray-600 bg-gray-700/50 text-gray-400 hover:border-gray-500 hover:bg-gray-700"])},[t("div",_o,d(n),1),s(f).includes(v)?(i(),a("div",Po,e[58]||(e[58]=[t("span",{class:"text-white text-xs"},"✓",-1)]))):g("",!0)],2)],8,ko)),64))]),s(f).length>0?(i(),a("div",So,[t("p",Ao,[e[59]||(e[59]=t("strong",null,"Días seleccionados:",-1)),m(" "+d(te()),1)])])):g("",!0)])):g("",!0)]),t("div",Ro,[e[65]||(e[65]=t("h3",{class:"font-medium text-white mb-3"},"Configuración Adicional",-1)),t("div",Eo,[t("label",To,[I(t("input",{"onUpdate:modelValue":e[10]||(e[10]=n=>s(y).notifyBeforeStart=n),type:"checkbox",disabled:!s(Z),class:"rounded border-gray-600 text-green-600 focus:ring-green-500 bg-gray-700 disabled:opacity-50"},null,8,Io),[[Y,s(y).notifyBeforeStart]]),t("span",$o,[e[62]||(e[62]=m(" Notificar 5 minutos antes ")),s(Z)?g("",!0):(i(),a("span",Wo,"(requiere programación con al menos 10 min de anticipación)"))])]),t("label",No,[I(t("input",{"onUpdate:modelValue":e[11]||(e[11]=n=>s(y).notifyStart=n),type:"checkbox",class:"rounded border-gray-600 text-green-600 focus:ring-green-500 bg-gray-700"},null,512),[[Y,s(y).notifyStart]]),e[63]||(e[63]=t("span",{class:"ml-2 text-sm text-gray-300"},"Notificar al iniciar el riego",-1))]),t("label",jo,[I(t("input",{"onUpdate:modelValue":e[12]||(e[12]=n=>s(y).notifyEnd=n),type:"checkbox",class:"rounded border-gray-600 text-green-600 focus:ring-green-500 bg-gray-700"},null,512),[[Y,s(y).notifyEnd]]),e[64]||(e[64]=t("span",{class:"ml-2 text-sm text-gray-300"},"Notificar al finalizar el riego",-1))])])]),t("div",Vo,[e[71]||(e[71]=t("h3",{class:"font-medium text-blue-300 mb-2"},"Vista Previa",-1)),t("div",Ho,[t("p",null,[e[66]||(e[66]=t("strong",null,"Fecha y hora programada:",-1)),m(" "+d(L()),1)]),t("p",null,[e[67]||(e[67]=t("strong",null,"Duración:",-1)),m(" "+d(X()),1)]),t("p",null,[e[68]||(e[68]=t("strong",null,"Frecuencia:",-1)),m(" "+d(ye()),1)]),e[70]||(e[70]=t("p",null,[t("strong",null,"Caudal estimado:"),m(" 2.5 L/min")],-1)),t("p",null,[e[69]||(e[69]=t("strong",null,"Volumen total:",-1)),m(" "+d(ve())+" L",1)])])]),t("div",zo,[t("button",{type:"submit",disabled:!ee(),class:"flex-1 px-6 py-3 bg-gradient-to-r from-green-600 to-green-700 text-white font-medium rounded-lg hover:from-green-700 hover:to-green-800 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed transition-all duration-200 shadow-lg"}," Guardar Configuración ",8,Fo),t("button",{type:"button",onClick:oe,class:"px-6 py-3 bg-gray-600 text-gray-300 font-medium rounded-lg hover:bg-gray-700 transition-colors"}," Cancelar ")])],32)])):(i(),a("div",Lo,[t("div",qo,[t("div",Bo,[x(s(G))]),t("h3",Oo,"Modo "+d(s(r).activeMode)+" Activo",1),e[74]||(e[74]=t("p",{class:"text-orange-300 mb-4"}," Ya tienes un modo de riego activo. Debes cancelar la configuración actual antes de poder configurar el modo programado. ",-1)),t("div",Uo,[t("p",Yo,[e[73]||(e[73]=t("strong",null,"Último riego:",-1)),m(" "+d(s(r).lastIrrigation),1)])]),t("button",{onClick:oe,class:"px-6 py-3 bg-orange-600 text-white font-medium rounded-lg hover:bg-orange-700 transition-colors"}," Volver a Modos de Riego ")])]))]),s(r).hasActiveMode&&!s(r).isProgrammedActive?(i(),a("div",Go,[t("div",Jo,[t("div",Ko,[e[80]||(e[80]=t("div",{class:"text-4xl"},"⚠️",-1)),e[81]||(e[81]=t("h3",{class:"text-xl font-bold text-white"},"Otro Modo de Riego Activo",-1)),t("p",Qo,[e[75]||(e[75]=m(" Actualmente tienes el modo ")),t("strong",Xo,d(s(r).getModeDescription(s(r).activeMode)),1),e[76]||(e[76]=m(" activo. ")),e[77]||(e[77]=t("br",null,null,-1)),e[78]||(e[78]=t("br",null,null,-1)),e[79]||(e[79]=m(" Para configurar el modo programado, primero debes cancelar el modo activo desde su página correspondiente. "))]),t("button",{onClick:Re,class:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold"}," Ir al Modo Activo ")])])])):g("",!0),s(j)?(i(),a("div",{key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:se},[t("div",{class:"bg-gray-800 p-6 rounded-xl max-w-md w-full mx-4 border border-gray-700",onClick:e[13]||(e[13]=z(()=>{},["stop"]))},[t("div",Zo,[t("div",er,[x(s(ct))]),e[86]||(e[86]=t("h3",{class:"text-lg font-bold text-white mb-2"},"Confirmar Programación",-1)),t("p",tr,[m(" ¿Estás seguro de que quieres programar el riego para el "+d(L())+"? ",1),e[82]||(e[82]=t("br",null,null,-1)),e[83]||(e[83]=t("br",null,null,-1)),e[84]||(e[84]=t("strong",null,"Duración:",-1)),m(" "+d(X()),1),e[85]||(e[85]=t("br",null,null,-1)),t("strong",null,d(q()),1)]),t("div",{class:"flex space-x-4"},[t("button",{onClick:we,class:"flex-1 px-4 py-2 bg-gradient-to-r from-green-600 to-green-700 text-white rounded-lg hover:from-green-700 hover:to-green-800 transition-all duration-200"}," Confirmar Programación "),t("button",{onClick:se,class:"flex-1 px-4 py-2 bg-gray-600 text-gray-300 rounded-lg hover:bg-gray-700 transition-colors"}," Cancelar ")])])])])):g("",!0),s(S)?(i(),a("div",{key:2,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:re},[t("div",{class:"bg-gray-800 border border-gray-600/30 p-6 rounded-xl max-w-md w-full mx-4",onClick:e[14]||(e[14]=z(()=>{},["stop"]))},[t("div",or,[t("div",rr,[x(s(G))]),e[87]||(e[87]=t("h3",{class:"text-lg font-bold text-white mb-2"},"Cancelar Configuración Programada",-1)),e[88]||(e[88]=t("p",{class:"text-gray-300 mb-6"},[m(" ¿Estás seguro de que quieres cancelar la configuración programada? "),t("br"),t("br"),t("strong",{class:"text-red-400"},"El riego no se ejecutará en la fecha programada.")],-1)),t("div",{class:"flex space-x-4"},[t("button",{onClick:De,class:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"}," Sí, Cancelar Configuración "),t("button",{onClick:re,class:"flex-1 px-4 py-2 bg-gray-600 text-gray-200 rounded-lg hover:bg-gray-500 transition-colors"}," No, Mantener ")])])])])):g("",!0),s(V)?(i(),a("div",{key:3,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:ne},[t("div",{class:"bg-gray-800 border border-gray-600/30 p-6 rounded-xl max-w-md w-full mx-4",onClick:e[15]||(e[15]=z(()=>{},["stop"]))},[t("div",sr,[t("div",nr,[x(s(G))]),e[89]||(e[89]=t("h3",{class:"text-lg font-bold text-white mb-2"},"Cancelar Riego Activo",-1)),e[90]||(e[90]=t("p",{class:"text-gray-300 mb-6"},[m(" ¿Estás seguro de que quieres cancelar el riego que está en curso? "),t("br"),t("br"),t("strong",{class:"text-yellow-400"},"El riego se detendrá inmediatamente."),t("br"),t("span",{class:"text-blue-400"},"Si tienes configuración daily o días múltiples, se reprogramará automáticamente.")],-1)),t("div",{class:"flex space-x-4"},[t("button",{onClick:Pe,class:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"}," Sí, Cancelar Riego "),t("button",{onClick:ne,class:"flex-1 px-4 py-2 bg-gray-600 text-gray-200 rounded-lg hover:bg-gray-500 transition-colors"}," No, Continuar ")])])])])):g("",!0)])}}};export{br as default};
