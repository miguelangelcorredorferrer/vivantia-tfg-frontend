import{L as C,r as m,p as v}from"./Z3C1zjOC.js";import d from"./Dxmh1sec.js";const G=C("device",()=>{const t=m([]),o=m(null),l=m(!1),s=m(null),h=e=>e?{id:e.id,deviceName:e.device_name,enddeviceId:e.enddevice_id,appEui:e.app_eui,devEui:e.dev_eui,appKey:e.app_key,isActive:e.is_active_communication,userId:e.user_id,ttnRegion:e.ttn_region,ttnAppId:e.ttn_app_id,ttnAccessKey:e.ttn_access_key,createdAt:e.created_at}:null,u=v(()=>t.value.map(e=>h(e))),y=v(()=>t.value.length>0),_=v(()=>{var e;return((e=o.value)==null?void 0:e.is_active_communication)||!1}),D=v(()=>{var e;return((e=o.value)==null?void 0:e.device_name)||""}),w=v(()=>{var e;return((e=o.value)==null?void 0:e.enddevice_id)||""}),E=v(()=>t.value.length),f=v(()=>u.value.filter(e=>e.isActive)),I=v(()=>f.value.length),N=v(()=>u.value.map(e=>e.deviceName).filter(Boolean)),B=v(()=>u.value.map(e=>e.enddeviceId).filter(Boolean));return{devices:t,device:o,isLoading:l,error:s,hasDevice:y,isDeviceActive:_,deviceName:D,enddeviceId:w,deviceCount:E,activeDevices:f,activeDeviceCount:I,deviceNames:N,enddeviceIds:B,mappedDevices:u,fetchUserDevice:async e=>{var i;try{l.value=!0,s.value=null;const a=await d.getDevicesByUserId(e);return t.value=a.data||[],o.value=t.value.length>0?t.value[0]:null,console.log("📱 Dispositivos del usuario cargados:",t.value.length),console.log("📊 Dispositivo actual:",((i=o.value)==null?void 0:i.device_name)||"ninguno"),a}catch(a){throw s.value=a.message||"Error al cargar dispositivos del usuario",console.error("❌ Error cargando dispositivos del usuario:",a),a}finally{l.value=!1}},createDevice:async e=>{var i;try{l.value=!0,s.value=null;const a=await d.create(e);return a.data&&(t.value.push(a.data),t.value.length===1&&(o.value=a.data)),console.log("✅ Dispositivo creado:",(i=a.data)==null?void 0:i.device_name),a}catch(a){throw s.value=a.message||"Error al crear dispositivo",console.error("❌ Error creando dispositivo:",a),a}finally{l.value=!1}},updateDevice:async(e,i)=>{var a,c;try{l.value=!0,s.value=null;const r=t.value.findIndex(p=>p.id===e);if(r===-1)throw new Error("No tienes permisos para actualizar este dispositivo");const n=await d.update(e,i);return n.data&&(t.value[r]=n.data,((a=o.value)==null?void 0:a.id)===e&&(o.value=n.data)),console.log("✅ Dispositivo actualizado:",(c=n.data)==null?void 0:c.device_name),n}catch(r){throw s.value=r.message||"Error al actualizar dispositivo",console.error("❌ Error actualizando dispositivo:",r),r}finally{l.value=!1}},deleteDevice:async e=>{var i;try{l.value=!0,s.value=null;const a=t.value.findIndex(c=>c.id===e);if(a===-1)throw new Error("No tienes permisos para eliminar este dispositivo");return await d.delete(e),t.value.splice(a,1),((i=o.value)==null?void 0:i.id)===e&&(o.value=t.value.length>0?t.value[0]:null),console.log("✅ Dispositivo eliminado"),!0}catch(a){throw s.value=a.message||"Error al eliminar dispositivo",console.error("❌ Error eliminando dispositivo:",a),a}finally{l.value=!1}},toggleDeviceActive:async(e,i)=>{var a,c;try{l.value=!0,s.value=null;const r=t.value.findIndex(p=>p.id===e);if(r===-1)throw new Error("No tienes permisos para cambiar el estado de este dispositivo");let n;if(i)try{n=await d.activateDevice(e,!1)}catch(p){if(p.status===409)n=await d.activateDevice(e,!0);else throw p}else n=await d.deactivateDevice(e);return n.data&&(i?(t.value.forEach((p,g)=>{p.id===e?t.value[g].is_active_communication=!0:t.value[g].is_active_communication=!1}),((a=o.value)==null?void 0:a.id)===e&&(o.value.is_active_communication=!0)):(t.value[r].is_active_communication=!1,((c=o.value)==null?void 0:c.id)===e&&(o.value.is_active_communication=!1)),t.value=[...t.value]),console.log(`✅ Dispositivo ${i?"activado":"desactivado"}`),n}catch(r){throw s.value=r.message||"Error al cambiar estado del dispositivo",console.error("❌ Error cambiando estado del dispositivo:",r),r}finally{l.value=!1}},getDeviceById:async e=>{var i;try{const a=await d.getById(e);return a.data&&((i=o.value)==null?void 0:i.id)===e&&(o.value=a.data),a}catch(a){throw s.value=a.message||"Error al obtener dispositivo",console.error("❌ Error obteniendo dispositivo:",a),a}},getDeviceByEndDeviceId:async e=>{try{return await d.getDeviceByEndDeviceId(e)}catch(i){throw s.value=i.message||"Error al obtener dispositivo por EndDeviceId",console.error("❌ Error obteniendo dispositivo por EndDeviceId:",i),i}},filterDevicesSuggestions:(e,i)=>!e||u.value.length===0?[]:u.value.map(a=>i==="deviceName"?a.deviceName:a.enddeviceId).filter(a=>a&&a.toLowerCase().includes(e.toLowerCase())),filterDevices:e=>u.value.length===0?[]:!e.deviceName&&!e.enddeviceId?u.value:u.value.filter(i=>{var c,r;let a=!0;return e.deviceName&&(a=a&&((c=i.deviceName)==null?void 0:c.toLowerCase().includes(e.deviceName.toLowerCase()))),e.enddeviceId&&(a=a&&((r=i.enddeviceId)==null?void 0:r.toLowerCase().includes(e.enddeviceId.toLowerCase()))),a}),clearError:()=>{s.value=null},reset:()=>{t.value=[],o.value=null,s.value=null,l.value=!1}}});export{G as u};
