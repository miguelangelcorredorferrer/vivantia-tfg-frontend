import{af as s,u as c,ag as l,f as o}from"./Z3C1zjOC.js";const m=s(async(u,g)=>{var n,d;let r,a;const e=c();if(console.log("üîÑ Middleware auth: Verificando acceso a:",u.path),e.isDemoMode){console.log("üé≠ Middleware auth: Modo demo activo, permitiendo acceso");return}const t=localStorage.getItem("AUTH_TOKEN");if(localStorage.getItem("DEMO_MODE")==="true"){console.log("üé≠ Middleware auth: Activando modo demo desde localStorage"),e.enterDemoMode();return}if(console.log("üîç Middleware auth: localStorage token =",!!t),console.log("üîç Middleware auth: userStore.token =",!!e.token),console.log("üîç Middleware auth: userStore.user =",!!e.user),t&&!e.token){console.log("üîÑ Middleware auth: Inicializando store con token guardado..."),e.token=t;try{[r,a]=l(()=>e.getCurrentUser()),await r,a(),console.log("‚úÖ Middleware auth: Usuario inicializado:",(n=e.user)==null?void 0:n.name)}catch(i){return console.error("‚ùå Middleware auth: Error inicializando usuario:",i),e.logout(),o("/auth/login")}}if(e.token&&!e.user){console.log("üîÑ Middleware auth: Token en store pero sin usuario, obteniendo datos...");try{[r,a]=l(()=>e.getCurrentUser()),await r,a(),console.log("‚úÖ Middleware auth: Usuario obtenido:",(d=e.user)==null?void 0:d.name)}catch(i){return console.error("‚ùå Middleware auth: Error obteniendo usuario:",i),e.logout(),o("/auth/login")}}if(!e.token&&!t&&!e.isDemoMode)return console.log("‚ùå Middleware auth: No hay token, redirigiendo al login"),o("/auth/login");if(e.token&&!e.user){console.log("‚è≥ Middleware auth: Token existe, usuario inicializ√°ndose...");return}if(e.user&&!e.user.verified&&!e.isDemoMode)return console.log("‚ùå Middleware auth: Cuenta no verificada"),o("/auth/verify-email");if(!e.isAuthenticated&&!e.isDemoMode)return console.log("‚ùå Middleware auth: Usuario no autenticado"),o("/auth/login");console.log("‚úÖ Middleware auth: Acceso permitido")});export{m as default};
