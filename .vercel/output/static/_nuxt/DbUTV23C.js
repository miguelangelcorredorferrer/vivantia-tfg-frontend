import{r as n,p,q as j,c as S,o as A,a as t,b as E,A as F,k as q,t as d,j as h,h as c,s as f,v as z}from"./Z3C1zjOC.js";import{u as $}from"./DPZQ8nY_.js";import{a as G}from"./DYYJ9xn1.js";import{A as H,C as T,a as x}from"./DpyyorBj.js";import{u as W}from"./uy_vPcXx.js";import"./B0aUQyeA.js";import"./D1FtnuK-.js";import"./BEPLvfI3.js";const Y={class:"space-y-8"},J={class:"max-w-7xl mx-auto"},K={class:"bg-gradient-to-r from-red-800 to-red-900 rounded-xl shadow-lg p-6 mb-8 border border-red-700"},Q={class:"flex items-center justify-between"},X={class:"flex items-center space-x-4"},Z={class:"w-12 h-12 bg-gradient-to-br from-red-500 to-red-600 rounded-full flex items-center justify-center shadow-lg"},ee={class:"flex items-center space-x-6"},te={class:"text-center"},se={class:"text-2xl font-bold text-white"},ae={class:"text-center"},le={class:"text-2xl font-bold text-orange-400"},re={class:"text-center"},oe={class:"text-2xl font-bold text-red-300"},ie={class:"text-center"},ne={class:"text-2xl font-bold text-blue-300"},de={class:"bg-gray-800 rounded-xl shadow-lg p-6 mb-8 border border-gray-700"},ue={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4"},ce={class:"flex items-center justify-between mt-6"},ve={class:"text-sm text-gray-400"},me={key:0,class:"text-center py-12"},he={__name:"logs",setup(ge){W({title:"Logs del Sistema - Admin - VIVANTIA",meta:[{name:"description",content:"Panel de administraci√≥n para gestionar logs y alertas del sistema"}]});const{toast:i}=$(),a=n({category:"",severity:"",user:"",status:"",period:"all"}),b=n(!1),r=n([]),y=n(0),v=n(!1),m=n(!1),o=n(null),u=async()=>{try{b.value=!0;const s=await x.getAllAlertsWithUsers();r.value=s.data||[],y.value=r.value.length}catch(s){console.error("Error al cargar alertas del sistema:",s),i.error("Error al cargar las alertas del sistema"),r.value=[]}finally{b.value=!1}},D=p(()=>{let s=r.value;if(a.value.category&&(s=s.filter(e=>e.alert_type===a.value.category)),a.value.severity&&(s=s.filter(e=>e.severity===a.value.severity)),a.value.user&&(s=s.filter(e=>{var l,g;return((l=e.user_name)==null?void 0:l.toLowerCase().includes(a.value.user.toLowerCase()))||((g=e.user_email)==null?void 0:g.toLowerCase().includes(a.value.user.toLowerCase()))})),a.value.status)switch(a.value.status){case"unread":s=s.filter(e=>!e.is_resolved);break;case"read":s=s.filter(e=>e.is_resolved);break}if(a.value.period!=="all"){const e=new Date,l=new Date(e.getFullYear(),e.getMonth(),e.getDate()),g=new Date(l.getTime()-10080*60*1e3),B=new Date(l.getFullYear(),l.getMonth()-1,l.getDate());s=s.filter(P=>{const w=new Date(P.created_at);switch(a.value.period){case"today":return w>=l;case"week":return w>=g;case"month":return w>=B;default:return!0}})}return s.sort((e,l)=>new Date(l.created_at)-new Date(e.created_at))}),k=p(()=>r.value.filter(s=>!s.is_resolved).length),C=p(()=>r.value.filter(s=>s.severity==="error"||s.severity==="warning").length),_=p(()=>{const s=new Set;return r.value.forEach(e=>{e.user_email&&s.add(e.user_email)}),s.size}),M=()=>{a.value={category:"",severity:"",user:"",status:"",period:"all"}},R=()=>{m.value=!0},L=async()=>{try{const s=await x.deleteAllSystemAlerts();await u(),i.success(`${s.count||0} alertas eliminadas del sistema`)}catch(s){console.error("Error al eliminar todas las alertas:",s),i.error("Error al eliminar todas las alertas del sistema")}finally{m.value=!1}},I=()=>{m.value=!1},O=async s=>{try{await x.resolveAlert(s),await u(),i.success("Alerta marcada como resuelta")}catch(e){console.error("Error al marcar alerta como resuelta:",e),i.error("Error al marcar alerta como resuelta")}},U=s=>{const e=r.value.find(l=>l.id===s);o.value=e,v.value=!0},V=async()=>{try{o.value&&(await x.delete(o.value.id),await u(),i.success("Alerta eliminada exitosamente"))}catch(s){console.error("Error al eliminar alerta:",s),i.error("Error al eliminar alerta")}finally{v.value=!1,o.value=null}},N=()=>{v.value=!1,o.value=null};return j(()=>{u()}),(s,e)=>(A(),S("div",Y,[t("div",J,[t("div",K,[t("div",Q,[t("div",X,[t("div",Z,[E(q(G))]),e[5]||(e[5]=t("div",null,[t("h1",{class:"text-2xl font-bold text-white"},"Logs del Sistema"),t("p",{class:"text-red-100"},"Panel de administraci√≥n - Gesti√≥n completa de alertas del sistema")],-1))]),t("div",ee,[t("div",te,[t("div",se,d(y.value),1),e[6]||(e[6]=t("div",{class:"text-sm text-red-200"},"Total Sistema",-1))]),t("div",ae,[t("div",le,d(k.value),1),e[7]||(e[7]=t("div",{class:"text-sm text-red-200"},"Sin Resolver",-1))]),t("div",re,[t("div",oe,d(C.value),1),e[8]||(e[8]=t("div",{class:"text-sm text-red-200"},"Cr√≠ticas",-1))]),t("div",ie,[t("div",ne,d(_.value),1),e[9]||(e[9]=t("div",{class:"text-sm text-red-200"},"Usuarios",-1))])])])]),t("div",de,[e[19]||(e[19]=h('<div class="flex items-center justify-between mb-4"><h2 class="text-lg font-semibold text-white">Filtros Avanzados</h2><div class="flex items-center space-x-2"><div class="w-3 h-3 bg-red-500 rounded-full"></div><span class="text-sm text-gray-400">Panel de Administrador</span></div></div>',1)),t("div",ue,[t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Categor√≠a",-1)),c(t("select",{"onUpdate:modelValue":e[0]||(e[0]=l=>a.value.category=l),class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-white"},e[10]||(e[10]=[h('<option value="">Todas las categor√≠as</option><option value="user">Usuario</option><option value="environmental">Ambiental</option><option value="device">Dispositivo</option><option value="crop">Cultivo</option><option value="irrigation">Riego</option>',6)]),512),[[f,a.value.category]])]),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Severidad",-1)),c(t("select",{"onUpdate:modelValue":e[1]||(e[1]=l=>a.value.severity=l),class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-white"},e[12]||(e[12]=[h('<option value="">Todas las severidades</option><option value="info">Informaci√≥n</option><option value="success">√âxito</option><option value="warning">Advertencia</option><option value="error">Error</option>',5)]),512),[[f,a.value.severity]])]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Usuario",-1)),c(t("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.user=l),type:"text",placeholder:"Buscar por nombre o email...",class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-white placeholder-gray-400"},null,512),[[z,a.value.user]])]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Estado",-1)),c(t("select",{"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.status=l),class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-white"},e[15]||(e[15]=[t("option",{value:""},"Todos los estados",-1),t("option",{value:"unread"},"Sin Resolver",-1),t("option",{value:"read"},"Resueltas",-1)]),512),[[f,a.value.status]])]),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-gray-300 mb-2"},"Per√≠odo",-1)),c(t("select",{"onUpdate:modelValue":e[4]||(e[4]=l=>a.value.period=l),class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-white"},e[17]||(e[17]=[t("option",{value:"all"},"Todo el tiempo",-1),t("option",{value:"today"},"Hoy",-1),t("option",{value:"week"},"Esta semana",-1),t("option",{value:"month"},"Este mes",-1)]),512),[[f,a.value.period]])])]),t("div",ce,[t("div",{class:"flex items-center space-x-3"},[t("button",{onClick:M,class:"px-4 py-2 bg-gray-600 text-gray-300 rounded-lg hover:bg-gray-700 transition-colors"}," Limpiar Filtros "),t("button",{onClick:u,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"}," Actualizar "),t("button",{onClick:R,class:"px-4 py-2 bg-red-700 text-white rounded-lg hover:bg-red-800 transition-colors border-2 border-red-600",title:"‚ö†Ô∏è PELIGRO: Elimina TODAS las alertas del sistema"}," üóëÔ∏è Eliminar TODAS ")]),t("div",ve,d(D.value.length)+" de "+d(y.value)+" alertas mostradas ",1)])]),b.value?(A(),S("div",me,e[20]||(e[20]=[t("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-red-500"},null,-1),t("p",{class:"text-gray-400 mt-2"},"Cargando logs del sistema...",-1)]))):(A(),F(H,{key:1,alerts:D.value,showDeleteButton:!0,showUserInfo:!0,onAlertResolved:O,onAlertDeleted:U},null,8,["alerts"]))]),E(T,{isOpen:v.value,title:"Eliminar Alerta",message:o.value?`¬øEst√°s seguro de que deseas eliminar la alerta '${o.value.title}' del usuario ${o.value.user_name||"N/A"}?`:"",warningMessage:"Esta acci√≥n no se puede deshacer.",confirmText:"S√≠, eliminar",onConfirm:V,onCancel:N},null,8,["isOpen","message"]),E(T,{isOpen:m.value,title:"‚ö†Ô∏è ELIMINAR TODAS LAS ALERTAS",message:"Esto eliminar√° PERMANENTEMENTE todas las alertas del sistema de TODOS los usuarios.",warningMessage:"Esta es una acci√≥n IRREVERSIBLE que afectar√° a todo el sistema. Solo procede si est√°s completamente seguro.",confirmText:"S√≠, eliminar TODAS",onConfirm:L,onCancel:I},null,8,["isOpen"])]))}};export{he as default};
