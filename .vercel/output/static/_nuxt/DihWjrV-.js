import{_ as K}from"./YHwIe9Gn.js";import{N as Q,G as X,u as Y,r as y,p as k,g as Z,q as ee,c as n,o as l,a as t,i as L,t as g,T as te,b as I,w as D,H as V,h as d,v as m,F as A,x as B,s as re,m as M,A as j,B as T,k as q,d as h}from"./Z3C1zjOC.js";import{u as oe}from"./DPZQ8nY_.js";import{u as se}from"./6yrW6Ic0.js";import{g as P}from"./DYYJ9xn1.js";import{B as U}from"./B0aUQyeA.js";import"./DTkYgPEM.js";const ie={class:"space-y-8"},ae={class:"mb-8"},le={class:"text-3xl font-bold text-white"},ne={key:0,class:"bg-red-900/20 border border-red-500/30 rounded-lg p-6"},de={class:"flex items-center"},ue={class:"text-red-300 mt-1"},me={key:1,class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},ce={class:"lg:col-span-2"},ge={class:"space-y-4"},pe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ye={class:"space-y-4"},xe={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},fe={class:"space-y-4"},ve={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},be=["value"],he={class:"space-y-4"},_e={class:"mt-2"},we={key:0,class:"w-full h-full relative"},Ce=["src"],ke={key:0,class:"bg-red-900/20 border border-red-500/30 rounded-lg p-4"},Ie={class:"flex items-start"},De={class:"mt-1 text-sm text-red-300 list-disc list-inside"},Ve={class:"flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-3 sm:space-y-0 pt-6 border-t border-gray-600"},Me={class:"flex space-x-3"},Ee=["disabled"],He={key:0,class:"flex items-center"},Se={key:1,class:"flex items-center"},Le={class:"lg:col-span-1"},Ae={class:"space-y-4"},Be={class:"space-y-2"},je={class:"flex items-center justify-between"},Te={class:"flex items-center justify-between"},qe={class:"border-t border-gray-600 pt-4"},Pe={class:"space-y-2"},Ue={class:"flex items-center justify-between"},ze={class:"text-sm text-white"},Ne={class:"flex items-center justify-between"},Fe={class:"text-sm text-white"},Xe={__name:"[id]",setup(Ge){const z=Q(),E=X(),{toast:x}=oe(),u=se(),_=Y(),w=y(!0),v=y(!1),s=y(null),H=y(!1),p=y(""),C=y(null),f=y(null);k(()=>u.categories.length>0?u.categories:["Hortalizas","Frutas","Hierbas","Cereales","Legumbres"]);const N=k(()=>s.value&&_.user&&s.value.user_id===_.user.id),F=["Primavera","Verano","Oto√±o","Invierno","Primavera/Verano","Verano/Oto√±o","Oto√±o/Invierno","Invierno/Primavera","Todo el a√±o"],r=Z({name:"",description:"",category:"",soil_humidity_min:0,soil_humidity_max:0,air_humidity_min:0,air_humidity_max:0,temperature_max:0,growth_days:0,session:"",image:null}),b=k(()=>{const o=[];return r.soil_humidity_min>=r.soil_humidity_max&&o.push("La humedad del suelo m√≠nima debe ser menor que la m√°xima"),(r.soil_humidity_min<0||r.soil_humidity_min>100)&&o.push("La humedad del suelo m√≠nima debe estar entre 0 y 100%"),(r.soil_humidity_max<0||r.soil_humidity_max>100)&&o.push("La humedad del suelo m√°xima debe estar entre 0 y 100%"),r.air_humidity_min>=r.air_humidity_max&&o.push("La humedad del aire m√≠nima debe ser menor que la m√°xima"),(r.air_humidity_min<0||r.air_humidity_min>100)&&o.push("La humedad del aire m√≠nima debe estar entre 0 y 100%"),(r.air_humidity_max<0||r.air_humidity_max>100)&&o.push("La humedad del aire m√°xima debe estar entre 0 y 100%"),(r.temperature_max<0||r.temperature_max>50)&&o.push("La temperatura m√°xima debe estar entre 0 y 50¬∞C"),r.growth_days&&(r.growth_days<1||r.growth_days>365)&&o.push("Los d√≠as de crecimiento deben estar entre 1 y 365"),o}),G=async()=>{var o;w.value=!0;try{const e=parseInt(z.params.id);console.log("üîÑ Editar Cultivo: Cargando cultivo ID:",e);let i=u.crops.find(c=>c.id===e);if(i||(i=(await u.fetchCropById(e)).data),!i){console.error("‚ùå Editar Cultivo: Cultivo no encontrado"),s.value=null;return}if(i.user_id!==((o=_.user)==null?void 0:o.id)){x.error("No tienes permisos para editar este cultivo"),E.push("/cultivos");return}s.value=i,Object.assign(r,{name:i.name,description:i.description,category:i.category,soil_humidity_min:i.soil_humidity_min,soil_humidity_max:i.soil_humidity_max,air_humidity_min:i.air_humidity_min,air_humidity_max:i.air_humidity_max,temperature_max:i.temperature_max,growth_days:i.growth_days,session:i.session||"",image:i.image}),i.image&&(p.value=i.image),console.log("‚úÖ Editar Cultivo: Cultivo cargado:",i.name)}catch(e){console.error("‚ùå Editar Cultivo: Error cargando cultivo:",e),x.error("Error al cargar el cultivo"),s.value=null}finally{w.value=!1}},O=()=>{s.value&&(Object.assign(r,{name:s.value.name,description:s.value.description,category:s.value.category,soil_humidity_min:s.value.soil_humidity_min,soil_humidity_max:s.value.soil_humidity_max,air_humidity_min:s.value.air_humidity_min,air_humidity_max:s.value.air_humidity_max,temperature_max:s.value.temperature_max,growth_days:s.value.growth_days,session:s.value.session||"",image:s.value.image}),s.value.image?p.value=s.value.image:p.value="",C.value=null,f.value&&(f.value.value=""))},R=o=>{const e=o.target.files[0];e&&S(e)},$=o=>{o.preventDefault(),H.value=!1;const e=o.dataTransfer.files[0];e&&e.type.startsWith("image/")&&S(e)},S=o=>{if(o.size>10*1024*1024){alert("La imagen es demasiado grande. M√°ximo 10MB.");return}C.value=o,r.image=o;const e=new FileReader;e.onload=i=>{p.value=i.target.result},e.readAsDataURL(o)},J=()=>{p.value="",C.value=null,r.image=null,f.value&&(f.value.value="")},W=async()=>{var o,e;if(b.value.length>0){x.error("Por favor corrige los errores en el formulario");return}if(!N.value){x.error("No tienes permisos para editar este cultivo");return}v.value=!0;try{console.log("üîÑ Editar Cultivo: Guardando cambios...");const i={name:r.name,description:r.description,category:r.category,soil_humidity_min:r.soil_humidity_min,soil_humidity_max:r.soil_humidity_max,air_humidity_min:r.air_humidity_min,air_humidity_max:r.air_humidity_max,temperature_max:r.temperature_max,growth_days:r.growth_days,session:r.session,image:r.image||null},c=await u.updateCrop(s.value.id,i);s.value=c.data,x.success(`¬°Cultivo "${c.data.name}" actualizado exitosamente!`),u.categories.includes(r.category)||await u.fetchCropCategories(),setTimeout(()=>{E.push("/cultivos")},1500)}catch(i){console.error("‚ùå Editar Cultivo: Error al guardar:",i),x.error(((e=(o=i.response)==null?void 0:o.data)==null?void 0:e.message)||"Error al actualizar el cultivo")}finally{v.value=!1}};return ee(async()=>{try{u.isInitialized||await u.fetchCropCategories(),await G()}catch(o){console.error("Error en onMounted:",o)}}),(o,e)=>{var c;const i=K;return l(),n("div",ie,[t("div",ae,[t("h1",le," Editar Cultivo: "+g(((c=s.value)==null?void 0:c.name)||"Cargando..."),1),e[13]||(e[13]=t("p",{class:"text-gray-400 text-lg"}," Modifica la configuraci√≥n del cultivo seleccionado ",-1))]),!s.value&&!w.value?(l(),n("div",ne,[t("div",de,[e[15]||(e[15]=t("svg",{class:"w-6 h-6 text-red-400 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})],-1)),t("div",null,[e[14]||(e[14]=t("h3",{class:"text-lg font-medium text-red-400"},"Cultivo no encontrado",-1)),t("p",ue,"El cultivo con ID "+g((o._.provides[te]||o.$route).params.id)+" no existe.",1)])])])):s.value?(l(),n("div",me,[t("div",ce,[I(U,{title:"Informaci√≥n del Cultivo"},{default:D(()=>[t("form",{onSubmit:V(W,["prevent"]),class:"space-y-6"},[t("div",ge,[e[19]||(e[19]=t("h3",{class:"text-lg font-medium text-white border-b border-gray-600 pb-2"}," Informaci√≥n B√°sica ",-1)),t("div",pe,[t("div",null,[e[16]||(e[16]=t("label",{for:"name",class:"block text-sm font-medium text-white mb-2"}," Nombre del Cultivo ",-1)),d(t("input",{id:"name","onUpdate:modelValue":e[0]||(e[0]=a=>r.name=a),type:"text",required:"",class:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors",placeholder:"Ej: Tomate Cherry"},null,512),[[m,r.name]])]),t("div",null,[e[17]||(e[17]=t("label",{for:"category",class:"block text-sm font-medium text-white mb-2"}," Categor√≠a ",-1)),d(t("input",{id:"category","onUpdate:modelValue":e[1]||(e[1]=a=>r.category=a),type:"text",required:"",class:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors",placeholder:"Ej: Hortalizas, Frutas, Hierbas..."},null,512),[[m,r.category]])])]),t("div",null,[e[18]||(e[18]=t("label",{for:"description",class:"block text-sm font-medium text-white mb-2"}," Descripci√≥n ",-1)),d(t("textarea",{id:"description","onUpdate:modelValue":e[2]||(e[2]=a=>r.description=a),rows:"3",class:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors resize-none",placeholder:"Descripci√≥n del cultivo..."},null,512),[[m,r.description]])])]),t("div",ye,[e[28]||(e[28]=t("h3",{class:"text-lg font-medium text-white border-b border-gray-600 pb-2"}," Par√°metros de Cultivo ",-1)),t("div",xe,[t("div",null,[e[20]||(e[20]=t("label",{for:"minHumidity",class:"block text-sm font-medium text-white mb-2"}," Humedad M√≠nima (%) ",-1)),d(t("input",{id:"minHumidity","onUpdate:modelValue":e[3]||(e[3]=a=>r.soil_humidity_min=a),type:"number",min:"0",max:"100",required:"",class:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors",placeholder:"50"},null,512),[[m,r.soil_humidity_min,void 0,{number:!0}]]),e[21]||(e[21]=t("p",{class:"mt-1 text-xs text-gray-400"},"Valor m√≠nimo recomendado",-1))]),t("div",null,[e[22]||(e[22]=t("label",{for:"maxHumidity",class:"block text-sm font-medium text-white mb-2"}," Humedad M√°xima (%) ",-1)),d(t("input",{id:"maxHumidity","onUpdate:modelValue":e[4]||(e[4]=a=>r.soil_humidity_max=a),type:"number",min:"0",max:"100",required:"",class:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors",placeholder:"80"},null,512),[[m,r.soil_humidity_max,void 0,{number:!0}]]),e[23]||(e[23]=t("p",{class:"mt-1 text-xs text-gray-400"},"Valor m√°ximo recomendado",-1))]),t("div",null,[e[24]||(e[24]=t("label",{for:"minAirHum",class:"block text-sm font-medium text-white mb-2"}," Humedad Aire Min (%) ",-1)),d(t("input",{id:"minAirHum","onUpdate:modelValue":e[5]||(e[5]=a=>r.air_humidity_min=a),type:"number",min:"0",max:"100",required:"",class:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors",placeholder:"50"},null,512),[[m,r.air_humidity_min,void 0,{number:!0}]])]),t("div",null,[e[25]||(e[25]=t("label",{for:"maxAirHum",class:"block text-sm font-medium text-white mb-2"}," Humedad Aire M√°x (%) ",-1)),d(t("input",{id:"maxAirHum","onUpdate:modelValue":e[6]||(e[6]=a=>r.air_humidity_max=a),type:"number",min:"0",max:"100",required:"",class:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors",placeholder:"85"},null,512),[[m,r.air_humidity_max,void 0,{number:!0}]])]),t("div",null,[e[26]||(e[26]=t("label",{for:"maxTemperature",class:"block text-sm font-medium text-white mb-2"}," Temperatura M√°xima (¬∞C) ",-1)),d(t("input",{id:"maxTemperature","onUpdate:modelValue":e[7]||(e[7]=a=>r.temperature_max=a),type:"number",min:"0",max:"50",required:"",class:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors",placeholder:"30"},null,512),[[m,r.temperature_max,void 0,{number:!0}]]),e[27]||(e[27]=t("p",{class:"mt-1 text-xs text-gray-400"},"Temperatura m√°xima tolerable",-1))])])]),t("div",fe,[e[33]||(e[33]=t("h3",{class:"text-lg font-medium text-white border-b border-gray-600 pb-2"}," Informaci√≥n Adicional ",-1)),t("div",ve,[t("div",null,[e[29]||(e[29]=t("label",{for:"growthDays",class:"block text-sm font-medium text-white mb-2"}," D√≠as de Crecimiento ",-1)),d(t("input",{id:"growthDays","onUpdate:modelValue":e[8]||(e[8]=a=>r.growth_days=a),type:"number",min:"1",max:"365",required:"",class:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors",placeholder:"90"},null,512),[[m,r.growth_days,void 0,{number:!0}]]),e[30]||(e[30]=t("p",{class:"mt-1 text-xs text-gray-400"},"D√≠as desde siembra hasta cosecha",-1))]),t("div",null,[e[32]||(e[32]=t("label",{for:"session",class:"block text-sm font-medium text-white mb-2"}," Temporada de Cosecha ",-1)),d(t("select",{id:"session","onUpdate:modelValue":e[9]||(e[9]=a=>r.session=a),required:"",class:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors"},[e[31]||(e[31]=t("option",{value:""},"Selecciona una temporada",-1)),(l(),n(A,null,B(F,a=>t("option",{key:a,value:a},g(a),9,be)),64))],512),[[re,r.session]])])])]),t("div",he,[e[37]||(e[37]=t("h3",{class:"text-lg font-medium text-white border-b border-gray-600 pb-2"}," Imagen del Cultivo ",-1)),t("div",null,[e[35]||(e[35]=t("label",{for:"image",class:"block text-sm font-medium text-white mb-2"}," Foto del Cultivo ",-1)),t("div",_e,[t("div",{onDrop:$,onDragover:e[11]||(e[11]=V(()=>{},["prevent"])),onDragenter:e[12]||(e[12]=V(()=>{},["prevent"])),class:M(["w-full h-40 border-2 border-dashed border-gray-600 rounded-lg bg-gray-700 hover:bg-gray-600 transition-colors cursor-pointer group",{"border-green-500 bg-green-900/20":H.value}])},[t("input",{ref_key:"imageInput",ref:f,type:"file",accept:"image/*",onChange:R,class:"hidden"},null,544),p.value?(l(),n("div",we,[t("img",{src:p.value,alt:"Preview",class:"w-full h-full object-cover rounded-lg"},null,8,Ce),t("button",{type:"button",onClick:J,class:"absolute top-2 right-2 bg-red-600 hover:bg-red-700 text-white rounded-full p-1 transition-colors"},[(l(),j(T(q(P)("close")),{class:"w-4 h-4"}))])])):(l(),n("div",{key:1,onClick:e[10]||(e[10]=a=>o.$refs.imageInput.click()),class:"flex flex-col items-center justify-center h-full"},e[34]||(e[34]=[t("svg",{class:"w-12 h-12 text-gray-400 group-hover:text-gray-300 transition-colors",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})],-1),t("p",{class:"mt-2 text-sm text-gray-400 group-hover:text-gray-300 transition-colors"},[t("span",{class:"font-medium"},"Haz clic para cambiar"),h(" o arrastra y suelta ")],-1),t("p",{class:"text-xs text-gray-500"},"PNG, JPG, GIF hasta 10MB",-1)])))],34)]),e[36]||(e[36]=t("p",{class:"mt-2 text-xs text-gray-400"}," Imagen actual del cultivo. Puedes cambiarla seleccionando una nueva. ",-1))])]),b.value.length>0?(l(),n("div",ke,[t("div",Ie,[(l(),j(T(q(P)("warning")),{class:"w-5 h-5 text-red-400 mt-0.5 mr-2 flex-shrink-0"})),t("div",null,[e[38]||(e[38]=t("p",{class:"text-sm font-medium text-red-400"},"Errores de validaci√≥n:",-1)),t("ul",De,[(l(!0),n(A,null,B(b.value,a=>(l(),n("li",{key:a},g(a),1))),128))])])])])):L("",!0),t("div",Ve,[I(i,{to:"/cultivos",class:"px-6 py-3 text-gray-400 hover:text-white border border-gray-600 hover:border-gray-500 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-gray-500"},{default:D(()=>e[39]||(e[39]=[t("div",{class:"flex items-center space-x-2"},[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})]),t("span",null,"Volver")],-1)])),_:1,__:[39]}),t("div",Me,[t("button",{type:"button",onClick:O,class:"px-6 py-3 text-yellow-400 hover:text-yellow-300 border border-yellow-500/30 hover:border-yellow-400/50 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-yellow-500"}," Restablecer "),t("button",{type:"submit",disabled:v.value||b.value.length>0,class:"px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-semibold rounded-lg shadow-lg hover:from-green-600 hover:to-emerald-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 focus:ring-offset-gray-800 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 transform hover:scale-105"},[v.value?(l(),n("span",He,e[40]||(e[40]=[t("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),h(" Guardando... ")]))):(l(),n("span",Se,e[41]||(e[41]=[t("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),h(" Guardar Cambios ")])))],8,Ee)])])],32)]),_:1})]),t("div",Le,[I(U,{title:"Informaci√≥n del Sistema"},{default:D(()=>[t("div",Ae,[t("div",null,[e[44]||(e[44]=t("h4",{class:"text-sm font-medium text-white mb-3"},"Estado Actual",-1)),t("div",Be,[t("div",je,[e[42]||(e[42]=t("span",{class:"text-sm text-gray-400"},"Seleccionado:",-1)),t("span",{class:M(s.value.isSelected?"text-green-400":"text-gray-400")},g(s.value.isSelected?"S√≠":"No"),3)]),t("div",Te,[e[43]||(e[43]=t("span",{class:"text-sm text-gray-400"},"Bomba de agua:",-1)),t("span",{class:M(s.value.waterPumpActive?"text-blue-400":"text-gray-400")},g(s.value.waterPumpActive?"Activa":"Inactiva"),3)])])]),t("div",qe,[e[47]||(e[47]=t("h4",{class:"text-sm font-medium text-white mb-3"},"Detalles",-1)),t("div",Pe,[t("div",Ue,[e[45]||(e[45]=t("span",{class:"text-sm text-gray-400"},"D√≠as de crecimiento:",-1)),t("span",ze,g(s.value.growthDays)+" d√≠as",1)]),t("div",Ne,[e[46]||(e[46]=t("span",{class:"text-sm text-gray-400"},"Temporada:",-1)),t("span",Fe,g(s.value.harvestSeason),1)])])]),e[48]||(e[48]=t("div",{class:"border-t border-gray-600 pt-4"},[t("h4",{class:"text-sm font-medium text-white mb-3"},"Ayuda"),t("div",{class:"bg-blue-900/20 border border-blue-500/30 rounded-lg p-3"},[t("p",{class:"text-xs text-blue-300"},[t("strong",null,"Tip:"),h(" La humedad m√≠nima debe ser menor que la m√°xima. Ajusta estos valores seg√∫n las necesidades espec√≠ficas de tu cultivo. ")])])],-1))])]),_:1})])])):L("",!0)])}}};export{Xe as default};
