import{u as P}from"./DPZQ8nY_.js";import{a as w}from"./DYYJ9xn1.js";import{B as O}from"./B0aUQyeA.js";import{_ as y,c as l,o as n,a as e,p as q,A as k,w as $,b as h,k as v,i as d,F,x as G,m,B as W,t as a,d as K,r as J,E as Q}from"./Z3C1zjOC.js";import{C as X,T as Y}from"./D1FtnuK-.js";import{P as Z}from"./BEPLvfI3.js";const ee={},te={fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24",class:"w-4 h-4"};function se(r,i){return n(),l("svg",te,i[0]||(i[0]=[e("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"},null,-1),e("circle",{cx:"12",cy:"7",r:"4"},null,-1)]))}const C=y(ee,[["render",se]]),re={},oe={fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24",class:"w-4 h-4"};function ne(r,i){return n(),l("svg",oe,i[0]||(i[0]=[e("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"},null,-1),e("line",{x1:"8",y1:"21",x2:"16",y2:"21"},null,-1),e("line",{x1:"12",y1:"17",x2:"12",y2:"21"},null,-1)]))}const le=y(re,[["render",ne]]),ae={},ie={fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24",class:"w-4 h-4"};function de(r,i){return n(),l("svg",ie,i[0]||(i[0]=[e("path",{d:"M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"},null,-1),e("path",{d:"M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"},null,-1),e("path",{d:"M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"},null,-1)]))}const ce=y(ae,[["render",de]]),ue={class:"flex items-center space-x-4"},ge={class:"flex items-center space-x-2"},me={class:"text-sm text-gray-300 font-bold"},xe={key:0,class:"text-xs text-orange-500 bg-orange-900/30 px-2 py-1 rounded-full"},ye={class:"overflow-x-auto"},be={key:0,class:"text-center py-12"},pe={key:1,class:"w-full text-sm text-left"},fe={class:"text-xs text-gray-300 uppercase bg-gray-800/50 border-b border-gray-600"},he={key:0,scope:"col",class:"px-6 py-4 font-medium"},ve={class:"divide-y divide-gray-600"},_e={class:"px-6 py-4"},we={class:"flex items-start"},ke={key:0,class:"absolute -top-1 -left-1 w-3 h-3 bg-orange-400 rounded-full animate-pulse"},$e={class:"flex-1"},Ce={class:"font-medium text-white mb-1"},Ae={class:"text-sm text-gray-400"},Ee={key:0,class:"text-xs text-gray-500 mt-1"},Ue={key:0,class:"px-6 py-4"},Se={class:"flex items-center"},Te={class:"text-sm font-medium text-white"},Be={class:"text-xs text-gray-400"},Le={key:0,class:"text-xs text-blue-400"},De={class:"px-6 py-4"},Ie={class:"px-6 py-4"},Me={class:"px-6 py-4 text-center"},Re={class:"flex items-center justify-center"},je={class:"px-6 py-4 text-center"},Ne={class:"flex flex-col items-center space-y-1"},Ve={key:0,class:"text-xs text-orange-400 font-medium"},ze={class:"px-6 py-4 text-center"},He={class:"text-gray-300"},Pe={class:"text-sm font-medium"},Oe={class:"text-xs text-gray-500"},qe={class:"px-6 py-4 text-center"},Fe={class:"flex items-center justify-center space-x-2"},Ge=["onClick"],We={key:1,class:"text-xs text-gray-500 mr-2"},Ke=["onClick"],Je={__name:"AlertsTable",props:{alerts:{type:Array,default:()=>[]},showDeleteButton:{type:Boolean,default:!1},showUserInfo:{type:Boolean,default:!1}},emits:["alert-resolved","alert-deleted"],setup(r,{emit:i}){const b=r,c=i,{toast:f}=P(),x=q(()=>b.alerts.filter(t=>!t.is_resolved).length),_=t=>({info:"bg-blue-500",success:"bg-green-500",warning:"bg-yellow-500",error:"bg-red-500"})[t]||"bg-gray-500",p=t=>({info:"bg-blue-900/30 text-blue-400 border border-blue-500/30",success:"bg-green-900/30 text-green-400 border border-green-500/30",warning:"bg-yellow-900/30 text-yellow-400 border border-yellow-500/30",error:"bg-red-900/30 text-red-400 border border-red-500/30"})[t]||"bg-gray-700 text-gray-400 border border-gray-600",A=t=>({info:"bg-blue-400",success:"bg-green-400",warning:"bg-yellow-400",error:"bg-red-400"})[t]||"bg-gray-500",E=t=>({info:"Info",success:"Éxito",warning:"Advertencia",error:"Error"})[t]||"Desconocido",U=t=>({user:"bg-purple-900/30 text-purple-300 border border-purple-500/30",environmental:"bg-orange-900/30 text-orange-300 border border-orange-500/30",device:"bg-blue-900/30 text-blue-300 border border-blue-500/30",crop:"bg-green-900/30 text-green-300 border border-green-500/30",irrigation:"bg-cyan-900/30 text-cyan-300 border border-cyan-500/30"})[t]||"bg-gray-700 text-gray-300 border border-gray-600",S=t=>({user:"Usuario",environmental:"Ambiental",device:"Dispositivo",crop:"Cultivo",irrigation:"Riego"})[t]||"Desconocido",T=t=>({temperature:"bg-red-900/30 text-red-300 border border-red-500/30",humidity:"bg-blue-900/30 text-blue-300 border border-blue-500/30",moisture:"bg-green-900/30 text-green-300 border border-green-500/30",water_level:"bg-purple-900/30 text-purple-300 border border-purple-500/30",pressure:"bg-orange-900/30 text-orange-300 border border-orange-500/30"})[t]||"bg-gray-700 text-gray-300 border border-gray-600",B=t=>({user:C,environmental:Y,device:le,crop:Z,irrigation:ce})[t]||w,L=t=>t.is_resolved?"bg-gray-700 text-gray-300 border border-gray-600":"bg-orange-900/30 text-orange-400 border border-orange-500/30",D=t=>t.is_resolved?"bg-gray-400":"bg-orange-400",I=t=>t.is_resolved?"Resuelta":"Nueva",M=t=>t.crop_name?`Cultivo: ${t.crop_name}`:t.device_name?`Dispositivo: ${t.device_name}`:t.temperature?`Temp: ${t.temperature}°C`:t.humidity?`Humedad: ${t.humidity}%`:t.scheduled_time?`Programado: ${t.scheduled_time}`:"",R=t=>new Date(t).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"}),j=t=>new Date(t).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}),N=t=>({admin:"Administrador",usuario:"Usuario",visitante:"Visitante"})[t]||t,V=async t=>{try{c("alert-resolved",t.id)}catch(s){console.error("Error al marcar alerta como resuelta:",s),f.error("Error al marcar alerta como resuelta")}},z=async t=>{c("alert-deleted",t.id)};return(t,s)=>(n(),k(O,{title:"Alertas del Sistema"},{"header-actions":$(()=>[e("div",ue,[e("div",ge,[e("span",me,"Total: "+a(r.alerts.length),1),x.value>0?(n(),l("span",xe,a(x.value)+" nuevas ",1)):d("",!0)])])]),default:$(()=>[e("div",ye,[r.alerts.length===0?(n(),l("div",be,[h(v(w),{class:"mx-auto mb-4 opacity-50"}),s[0]||(s[0]=e("h3",{class:"text-lg font-medium text-white mb-2"},"No se encontraron alertas",-1)),s[1]||(s[1]=e("p",{class:"text-gray-400"},"Intenta ajustar los filtros para encontrar alertas",-1))])):(n(),l("table",pe,[e("thead",fe,[e("tr",null,[s[2]||(s[2]=e("th",{scope:"col",class:"px-6 py-4 font-medium"},"Alerta",-1)),r.showUserInfo?(n(),l("th",he,"Usuario")):d("",!0),s[3]||(s[3]=e("th",{scope:"col",class:"px-6 py-4 font-medium"},"Categoría",-1)),s[4]||(s[4]=e("th",{scope:"col",class:"px-6 py-4 font-medium"},"Subcategoría",-1)),s[5]||(s[5]=e("th",{scope:"col",class:"px-6 py-4 font-medium text-center"},"Severidad",-1)),s[6]||(s[6]=e("th",{scope:"col",class:"px-6 py-4 font-medium text-center"},"Estado",-1)),s[7]||(s[7]=e("th",{scope:"col",class:"px-6 py-4 font-medium text-center"},"Fecha",-1)),s[8]||(s[8]=e("th",{scope:"col",class:"px-6 py-4 font-medium text-center"},"Acciones",-1))])]),e("tbody",ve,[(n(!0),l(F,null,G(r.alerts,o=>(n(),l("tr",{key:o.id,class:"hover:bg-gray-800/30 transition-colors duration-150"},[e("td",_e,[e("div",we,[e("div",{class:m(["flex-shrink-0 w-10 h-10 rounded-lg flex items-center justify-center mr-4 relative",_(o.severity)])},[(n(),k(W(B(o.alert_type)),{class:"w-5 h-5 text-white"})),o.is_resolved?d("",!0):(n(),l("div",ke))],2),e("div",$e,[e("div",Ce,a(o.title),1),e("div",Ae,a(o.message),1),o.metadata?(n(),l("div",Ee,a(M(o.metadata)),1)):d("",!0)])])]),r.showUserInfo?(n(),l("td",Ue,[e("div",Se,[h(v(C),{class:"w-4 h-4 text-gray-400 mr-2"}),e("div",null,[e("div",Te,a(o.user_name||"Usuario eliminado"),1),e("div",Be,a(o.user_email||"N/A"),1),o.user_role?(n(),l("div",Le,a(N(o.user_role)),1)):d("",!0)])])])):d("",!0),e("td",De,[e("span",{class:m(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",U(o.alert_type)])},a(S(o.alert_type)),3)]),e("td",Ie,[o.formatted_subtype?(n(),l("span",{key:0,class:m(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",T(o.alert_subtype)])},a(o.formatted_subtype),3)):d("",!0)]),e("td",Me,[e("div",Re,[e("div",{class:m(["flex items-center space-x-2 px-3 py-1 rounded-full text-xs font-medium",p(o.severity)])},[e("div",{class:m(["w-2 h-2 rounded-full",A(o.severity)])},null,2),e("span",null,a(E(o.severity)),1)],2)])]),e("td",je,[e("div",Ne,[e("div",{class:m(["flex items-center space-x-2 px-3 py-1 rounded-full text-xs font-medium",L(o)])},[e("div",{class:m(["w-2 h-2 rounded-full",D(o)])},null,2),e("span",null,a(I(o)),1)],2),o.is_resolved?d("",!0):(n(),l("span",Ve," Nueva "))])]),e("td",ze,[e("div",He,[e("div",Pe,a(R(o.created_at)),1),e("div",Oe,a(j(o.created_at)),1)])]),e("td",qe,[e("div",Fe,[o.is_resolved?(n(),l("span",We," Resuelta ")):(n(),l("button",{key:0,onClick:H=>V(o),class:"inline-flex items-center px-3 py-1 rounded-md text-xs font-medium bg-green-600 text-white hover:bg-green-700 transition-colors",title:"Marcar como resuelta"},[h(v(X),{class:"w-3 h-3 mr-1"}),s[9]||(s[9]=K(" Resolver "))],8,Ge)),r.showDeleteButton?(n(),l("button",{key:2,onClick:H=>z(o),class:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-red-600 text-white hover:bg-red-700 transition-colors",title:"Eliminar alerta"},s[10]||(s[10]=[e("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)]),8,Ke)):d("",!0)])])]))),128))])]))])]),_:1}))}},yt=y(Je,[["__scopeId","data-v-a19bb525"]]),Qe={key:0,class:"fixed inset-0 z-50 overflow-y-auto"},Xe={class:"flex min-h-screen items-center justify-center p-4"},Ye={class:"relative bg-gray-800 rounded-xl shadow-2xl border border-gray-700 max-w-md w-full mx-auto transform transition-all"},Ze={class:"px-6 py-4 border-b border-gray-700"},et={class:"flex items-center space-x-3"},tt={class:"text-lg font-semibold text-white"},st={class:"px-6 py-4"},rt={class:"text-gray-300"},ot={key:0,class:"mt-3 p-3 bg-yellow-900/30 border border-yellow-600 rounded-lg"},nt={class:"text-yellow-300 text-sm"},lt={class:"px-6 py-4 border-t border-gray-700 flex justify-end space-x-3"},at=["disabled"],it={__name:"ConfirmDeleteModal",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Confirmar eliminación"},message:{type:String,default:"¿Estás seguro de que deseas eliminar este elemento?"},warningMessage:{type:String,default:""},confirmText:{type:String,default:"Sí, eliminar"}},emits:["confirm","cancel"],setup(r,{emit:i}){const b=i,c=J(!1),f=async()=>{c.value=!0;try{await b("confirm")}finally{c.value=!1}},x=()=>{c.value||b("cancel")};return(_,p)=>r.isOpen?(n(),l("div",Qe,[e("div",{class:"fixed inset-0 bg-black bg-opacity-75 transition-opacity",onClick:x}),e("div",Xe,[e("div",Ye,[e("div",Ze,[e("div",et,[p[0]||(p[0]=e("div",{class:"w-10 h-10 bg-red-600 rounded-full flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})])],-1)),e("h3",tt,a(r.title),1)])]),e("div",st,[e("p",rt,a(r.message),1),r.warningMessage?(n(),l("div",ot,[e("p",nt,a(r.warningMessage),1)])):d("",!0)]),e("div",lt,[e("button",{onClick:x,class:"px-4 py-2 bg-gray-600 text-gray-300 rounded-lg hover:bg-gray-700 transition-colors"}," Cancelar "),e("button",{onClick:f,class:m(["px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",{"animate-pulse":c.value}]),disabled:c.value},a(c.value?"Eliminando...":r.confirmText),11,at)])])])])):d("",!0)}},bt=y(it,[["__scopeId","data-v-84d6748b"]]),u=()=>Q().public.apiUrl||"http://localhost:3001/api",g=()=>{const r=localStorage.getItem("AUTH_TOKEN");return r?{Authorization:`Bearer ${r}`}:{}},pt={getById(r){return $fetch(`/alerts/${r}`,{method:"GET",baseURL:u(),headers:g()})},delete(r){return $fetch(`/alerts/${r}`,{method:"DELETE",baseURL:u(),headers:g()})},getMyAlerts(r={}){return $fetch("/alerts",{method:"GET",query:r,baseURL:u(),headers:g()})},resolveAllAlertsByUserId(){return $fetch("/alerts/resolve-all",{method:"PUT",baseURL:u(),headers:g()})},deleteMyOldAlerts(){return $fetch("/alerts/old",{method:"DELETE",baseURL:u(),headers:g()})},getAllAlertsWithUsers(r={}){return $fetch("/alerts/admin/all",{method:"GET",query:r,baseURL:u(),headers:g()})},deleteAllSystemAlerts(){return $fetch("/alerts/admin/all",{method:"DELETE",baseURL:u(),headers:g()})},resolveAlert(r){return $fetch(`/alerts/${r}/resolve`,{method:"PUT",baseURL:u(),headers:g()})}};export{yt as A,bt as C,pt as a};
