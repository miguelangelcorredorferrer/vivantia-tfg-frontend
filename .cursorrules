Voy a darte contexto de que trata este proyecto para que optimices lo m√°ximo posibles las respuestas de las consultas sin desviarte.

Con este proyecto estoy tratando de implementar una soluci√≥n IoT utilizando The Things Network (TTN) en su versi√≥n sandbox gratuita. Utilizando el protocolo de comunicaci√≥n LoRaWan
He configurado un dispositivo IoT (Arduino WAN) que debe gestionar la comunicaci√≥n bidireccional entre sensores f√≠sicos y una aplicaci√≥n web (el proyecto que estamos tratando).
El sistema IoT en s√≠ tiene por objetivo la automatizaci√≥n de riegos de cultivos. Por ello se ha creado un SPA que permita a los usuarios registrados gestionar el riego de sus cultivos. En funci√≥n de los valores de humedad y temperatura. Adem√°s desde la aplicaci√≥n se podr√° tener un control sobre la bomba por lo que la aplicaci√≥n web tambi√©n va a enviar informaci√≥n a la red IoT con el objetivo de que el dispostivo IoT controle el actuador de la bomba.

Esta aplicaci√≥n web se va a encargar de gestionar los dispostivos registrados por el usuario, a√±adir y seleccionar cultivos a regar (1 cultivo por usuario, es decir se selecciona un cultivo y ya no se pueden seleccionar m√°s) etc...

El proyecto esta debidido en 3 partes, una es edge computing, fog computing y cloud computing. Edge computing se refiere directamente al procesamiento que se desarrolla en el microcontrolador al que est√°n conectado los sensores en este caso el microcontrolador con el sensor dht11 y capacitive soil moisture v1.2. Fog computing act√∫a como una capa intermedia entre cloud y edge. Permite procesar y filtrar datos. En relaci√≥n a nuestro proyecto el actor principal en la capa de Fog computing ser√≠a el gateway, que se encarga de filtrar los datos proveniente del microcontrolador hacia el servidor de red de TTN. Por √∫ltimo tenemos cloud computing cuyos actores principales ser√≠a el servidor de red de ttn y la base de datos de nuestra aplicaci√≥n.

Otro factor importante es la manera en la que se va  dar la comunicaci√≥n entre el dispositivo microcontrolador y la red TTN, la comunicaci√≥n se dar√° en 2 direcciones: uplink y downlink. Vamos a enfocarnos en describir el uplink.

1. Se captan datos de los sensores y se procesan en el microcontrolador
2. El microcontrolador env√≠a los datos de temperatura y humedad al servidor de red a trav√©s del gateway que act√∫a como puente entre microcontrolador y servidor de red TTN
3. Desde el servidor de mi aplicaci√≥n hago una consulta al endpoint HTTP que he definido en el webhook de TTN. El webhook va a enviar los datos recibidos por TTN al endpoint HTTP ya configurado por m√≠ previamente. Cuando un dispositivo LoRaWAN transmite un mensaje (por ejemplo, temperatura, humedad, estado de la bomba...), TTN lo recibe y reenv√≠a autom√°ticamente ese mensaje a tu servidor web o API (por ejemplo, tu index.ts en Node.js).
4. Despu√©s de hacer la consulta la api devuelve una respuesta json con los datos de humedad y temperatura y tambi√©n las credenciales del dispositivo que las esta enviando, para luego almacenarlo en la base de datos. De esta manera los datos enviandos por el microcontrolador de los sensores quedar√°n registrados en la base de datos y disponibles en la aplicaci√≥n web.

Ahora vamos a describir como funciona el downlink


1. Petici√≥n de acci√≥n desde la interfaz web
El usuario interact√∫a con la aplicaci√≥n web (por ejemplo, presionando un bot√≥n "ON" o "OFF" en el dashboard).
üîÅ Esta acci√≥n desencadena una llamada HTTP (POST) al backend que est√°s ejecutando con Express.

2. El backend llama a la API de TTN para encolar un downlink
El servidor Node.js toma esta solicitud y prepara un paquete JSON con:

frm_payload: el comando codificado en base64 (por ejemplo, AQ== para 0x01)

f_port: el puerto l√≥gico (normalmente 1)

priority: la prioridad del downlink (NORMAL o HIGH)

confirmed: si se espera confirmaci√≥n del nodo

üì§ Esta estructura se env√≠a mediante POST a la URL:

https://<region>.cloud.thethings.network/api/v3/as/applications/<app_id>/devices/<dev_eui>/down/push
üü¢ Si la petici√≥n tiene √©xito, TTN a√±ade el paquete a una cola de downlinks espec√≠fica del dispositivo.

3. TTN espera el pr√≥ximo uplink para entregar el downlink
Aqu√≠ ocurre lo interesante:

Los dispositivos LoRaWAN clase A, como el Arduino MKR WAN 1310, solo pueden recibir downlinks justo despu√©s de enviar un uplink.

Entonces TTN guarda el downlink en cola hasta que el nodo env√≠e un uplink (por ejemplo, datos de sensores o un paquete vac√≠o).

4. El nodo env√≠a un uplink (sensor, dummy, heartbeat, etc.)
Cuando el nodo transmite un uplink (autom√°tico o provocado), se abren dos ventanas de recepci√≥n:

RX1 (~1 segundo despu√©s del uplink)

RX2 (~2 segundos despu√©s, con par√°metros predefinidos)

Es durante esas ventanas cuando TTN entrega el downlink que estaba encolado.

5. El microcontrolador recibe el downlink y act√∫a
Dentro del c√≥digo del microcontrolador:

Se detecta que hay un downlink (modem.available())

Se lee el byte recibido (por ejemplo, 0x01 para "ON")

El sistema act√∫a en consecuencia: encender la bomba, cambiar un LED, etc.

Opcionalmente, el micro puede responder con un uplink de confirmaci√≥n.



El objetivo de este proyecto es automatizar el riego con el fin de ahorrar la m√°xima cantidad de agua posible y mantener un control exhaustivo del riego. De ah√≠ que existan 3 modos de operaci√≥n manual, programado y autom√°tico

Ten en cuenta que la programaci√≥n del microcontrolador est√° hecha, pero no es visible en este proyecto. La programaci√≥n del microcontrolador para la emisi√≥n de datos de lo sensores y la recepci√≥n de informaci√≥n de los downlink se ha hecho en el editor de texto Visual Studio Code con el plugin de platform.io

A continuaci√≥n te voy a pasar el codigo del downlink y uplink El downlink se hace asi  #include <MKRWAN.h>
#include <credenciales.h>
#include <arduino.h>

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Par√°metros de la demo ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
#define REGION        EU868       // Regi√≥n LoRa
#define LED_PIN       4           // LED (puede ser control bomba tambi√©n)
#define CTRL_FPORT    3           // Puerto para downlink/up
#define HEARTBEAT_MS  10000UL     // Env√≠o peri√≥dico cada minuto

LoRaModem modem(Serial1);
unsigned long lastTx = 0;

void sendUplinkStatus() {
  modem.setPort(3);                // Puerto 3 reservado para control
  modem.beginPacket();
  modem.write(0x01);               // 1 solo byte
  modem.endPacket(false);
  modem.setPort(CTRL_FPORT);      // Restaurar puerto normal
  Serial.println("üì§ Uplink de control reducido");
}


void setup() {
  Serial.begin(115200);
  while (!Serial);

  pinMode(LED_PIN, OUTPUT);

  if (!modem.begin(REGION)) {
    Serial.println("‚ùå  No se pudo iniciar el m√≥dulo LoRa");
    while (1);
  }

  Serial.print("DevEUI: ");
  Serial.println(modem.deviceEUI());

  // Join OTAA
  if (!modem.joinOTAA(appEui, appKey)) {
    Serial.println("‚ùå  Fall√≥ el join OTAA");
    while (1);
  }
  Serial.println("‚úÖ ¬°Unido a la red!");

  modem.setPort(CTRL_FPORT);
  modem.setADR(true);
  modem.dataRate(5); // SF7 EU868
}

void loop() {
  modem.poll(); // Fundamental

  // Env√≠o peri√≥dico
  if (millis() - lastTx > HEARTBEAT_MS) {
    lastTx = millis();
    modem.beginPacket();
    modem.write(0x00); // Payload dummy para mantener viva la sesi√≥n
    modem.endPacket(false);
    Serial.println("‚è± Uplink peri√≥dico");
  }

  // Downlink recibido
  if (modem.available()) {
    uint8_t b = modem.read();
    Serial.print("‚¨á Downlink recibido: 0x");
    Serial.println(b, HEX);

    digitalWrite(LED_PIN, b == 0x01 ? HIGH : LOW);
    Serial.println(b == 0x01 ? "üí° Bomba ENCENDIDA" : "üí° Bomba APAGADA");

    delay(500); // (evita conflicto con RX1/RX2)
    sendUplinkStatus(); // ‚Üê Respuesta autom√°tica al downlink
  }

  
}
. El uplink se hace as√≠ #include <MKRWAN.h>
#include <credenciales.h>
#include <Adafruit_Sensor.h>
#include <DHT.h>

// Selecciona tu regi√≥n: AS923, AU915, EU868, KR920, IN865, US915, US915_HYBRID
_lora_band region = EU868;

// Inicializa el m√≥dem LoRa (usando Serial1, que es el puerto del m√≥dulo LoRa en las placas MKR WAN)
LoRaModem modem(Serial1);

// Configuraci√≥n del sensor DHT11:
#define DHTPIN 2         // Ajusta el pin seg√∫n tu conexi√≥n
#define DHTTYPE DHT11    // Usamos DHT11
DHT dht(DHTPIN, DHTTYPE);

// Configuraci√≥n del sensor de humedad del suelo capacitivo:
#define SOIL_MOISTURE_PIN A0  // Pin anal√≥gico para el sensor de humedad del suelo

// Valores de calibraci√≥n del sensor de humedad del suelo (seg√∫n tus mediciones)
#define SOIL_MOISTURE_DRY 300   // Valor en suelo seco
#define SOIL_MOISTURE_WET 700   // Valor en suelo h√∫medo

void setup() {
  Serial.begin(115200);
  while (!Serial);
  
  // Inicializa el sensor DHT
  dht.begin();
  
  // Configura el pin del sensor de humedad del suelo como entrada
  pinMode(SOIL_MOISTURE_PIN, INPUT);
  
  // Inicializa el m√≥dem LoRa
  if (!modem.begin(region)) {
    Serial.println("Error: No se pudo iniciar el m√≥dulo LoRa");
    while (1) {}
  }
  
  Serial.print("Device EUI: ");
  Serial.println(modem.deviceEUI());

  // Realiza el join OTAA utilizando las credenciales definidas en leer_temperatura.h
  int connected = modem.joinOTAA(appEui, appKey);
  if (!connected) {
    Serial.println("Error en el join OTAA; revisa tus credenciales y ubicaci√≥n");
    while (1) {}
  }
  Serial.println("¬°Conectado a la red!");

  // Configura par√°metros adicionales: activa ADR y establece data rate bajo
  modem.setADR(true);
  modem.dataRate(5);
}

void loop() {
  // Lee la temperatura del sensor DHT11
  float temperature = dht.readTemperature();
  
  // Lee el valor anal√≥gico del sensor de humedad del suelo
  int rawSoilMoisture = analogRead(SOIL_MOISTURE_PIN);
  
  // Convierte el valor bruto a porcentaje (0-100%)
  // Nota: Como los valores est√°n invertidos (mayor = m√°s seco),
  // invertimos los par√°metros en el mapeo
  float soilMoisturePercent = map(rawSoilMoisture, SOIL_MOISTURE_DRY, SOIL_MOISTURE_WET, 0, 1000) / 10.0;
  
  // Aseg√∫rate de que los valores est√°n dentro del rango 0-100%
  soilMoisturePercent = constrain(soilMoisturePercent, 0, 100);
  
  // Verifica errores de lectura
  if (isnan(temperature)) {
    Serial.println("Error al leer la temperatura del sensor DHT11");
    delay(2000);
    return;
  }
  
  // Convierte los valores a enteros multiplicando por 10 (por ejemplo, 25.3 ¬∞C ‚Üí 253)
  int16_t temp_int = (int16_t)(temperature * 10);
  int16_t soil_int = (int16_t)(soilMoisturePercent * 10);
  
  // Imprime los valores en el monitor serie
  Serial.print("Temperatura: ");
  Serial.print(temperature);
  Serial.println(" ¬∞C");
  
  Serial.print("Humedad del suelo (raw): ");
  Serial.println(rawSoilMoisture);
  
  Serial.print("Humedad del suelo: ");
  Serial.print(soilMoisturePercent);
  Serial.println(" %");
  
  // Crea un buffer de 4 bytes:
  // - Bytes 0 y 1: temperatura (alto y bajo)
  // - Bytes 2 y 3: humedad del suelo (alto y bajo)
  uint8_t payload[4];
  payload[0] = (uint8_t)(temp_int >> 8);
  payload[1] = (uint8_t)(temp_int & 0xFF);
  payload[2] = (uint8_t)(soil_int >> 8);
  payload[3] = (uint8_t)(soil_int & 0xFF);

  // Imprime en el monitor serie el payload en formato hexadecimal para depuraci√≥n
  Serial.print("Payload (hex): ");
  for (int i = 0; i < 4; i++) {
    if (payload[i] < 16) Serial.print("0");
    Serial.print(payload[i], HEX);
    Serial.print(" ");
  }
  Serial.println();

  // Env√≠a el payload en formato binario a la red LoRaWAN
  modem.beginPacket();
  for (int i = 0; i < 4; i++) {
    modem.write(payload[i]);
  }
  int err = modem.endPacket(false);
  
  if (err > 0) {
    Serial.println("Paquete enviado correctamente.");
  } else {
    Serial.println("Error al enviar el paquete.");
  }
  
  // Espera 1 minuto antes de enviar la siguiente lectura
  delay(60000);

  A continuaci√≥n te voy a dar informaci√≥n sobre los requisitos extraidos


\hline
\rowcolor[HTML]{FFFFFF}
\textbf{ID} & \multicolumn{1}{c|}{\cellcolor[HTML]{FFFFFF} \textbf{Descripci√≥n (cont.)}} \\ \hline
\endhead

RF1 & El sistema deber√° permitir a los visitantes registrarse proporcionando email, contrase√±a y nombre completo. \\ \hline
RF3 & El sistema deber√° enviar un email de verificaci√≥n autom√°tico al completar el registro. \\ \hline
RF4 & El sistema deber√° permitir a los usuarios confirmar su cuenta mediante un enlace en el email de verificaci√≥n. \\ \hline
RF5 & El sistema deber√° permitir a los usuarios verificados iniciar sesi√≥n con email y contrase√±a. \\ \hline
RF6 & El sistema deber√° generar y gestionar tokens JWT para mantener sesiones activas. \\ \hline
RF7 & El sistema deber√° permitir a los usuarios solicitar recuperaci√≥n de contrase√±a mediante email. \\ \hline
RF8 & El sistema deber√° permitir a los usuarios restablecer su contrase√±a. \\ \hline
RF9 & El sistema deber√° permitir a los usuarios editar su perfil (nombre y contrase√±a). \\ \hline
RF10 & El sistema deber√° permitir a los usuarios eliminar su propia cuenta. \\ \hline
RF11 & El sistema deber√° proporcionar un modo demo para visitantes sin registro. \\ \hline
RF12 & El sistema deber√° permitir a los usuarios activar/desactivar la comunicaci√≥n del dispositivo IoT con la base de datos. \\ \hline
RF13 & El sistema deber√° permitir activar √∫nicamente un dispositivo por usuario simult√°neamente. \\ \hline
RF14 & El sistema deber√° permitir a los usuarios agregar dispositivos IoT con credenciales TTN, adem√°s de editarlos y eliminarlos. \\ \hline
RF16 & El sistema deber√° permitir a los usuarios crear cultivos especificando nombre, descripci√≥n, categor√≠a, d√≠as de crecimiento, temporada de cosecha, foto de cultivo y configurando los par√°metros de cultivo como humedad m√≠nima del suelo, humedad m√°xima del suelo, humedad m√≠nima del ambiente, humedad m√°xima del ambiente y temperatura m√°xima. \\ \hline
RF17 & El sistema deber√° permitir a los usuarios seleccionar √∫nicamente un cultivo activo a la vez. \\ \hline
RF18 & El sistema deber√° permitir a los usuarios visualizar y editar la informaci√≥n de sus cultivos, y adem√°s poder eliminarlos. \\ \hline
RF19 & El sistema deber√° verificar autom√°ticamente si las condiciones ambientales est√°n en rango √≥ptimo para el cultivo. \\ \hline
RF20 & El sistema deber√° permitir activar √∫nicamente un modo de riego a la vez. \\ \hline
RF21 & El sistema deber√° permitir seleccionar entre los 3 modos de riego: Manual, Programado y Autom√°tico. \\ \hline
RF22 & El sistema deber√° permitir configurar la duraci√≥n del riego en todos los modos. \\ \hline
RF23 & El sistema deber√° permitir pausar y reanudar el riego. \\ \hline
RF24 & El sistema deber√° permitir cancelar el riego en cualquier momento. \\ \hline
RF25 & El sistema deber√° permitir cancelar la configuraci√≥n para modo autom√°tico y programado en cualquier momento. \\ \hline
RF26 & El sistema deber√° permitir configurar umbrales para activaci√≥n autom√°tica. \\ \hline
RF27 & El sistema deber√° activar el riego autom√°ticamente cuando las condiciones excedan los umbrales. \\ \hline
RF28 & El sistema deber√° permitir programar riegos con fecha, hora espec√≠ficas y definir frecuencia de riego. \\ \hline
RF29 & El sistema deber√° generar alertas al iniciar y finalizar riegos programados. \\ \hline
RF30 & El sistema deber√° recibir datos de sensores de temperatura y humedad cada aproximadamente 2 minutos v√≠a webhook TTN. \\ \hline
RF31 & El sistema deber√° validar que los datos provienen de dispositivos autorizados. \\ \hline
RF32 & El sistema deber√° permitir al usuario acceder a los √∫ltimos 20 datos de sensores en tiempo real en el dashboard. \\ \hline
RF33 & El sistema deber√° simular datos de sensores en modo demo. \\ \hline
RF34 & El sistema deber√° permitir a los usuarios enviar comandos de activaci√≥n/desactivaci√≥n a la v√°lvula v√≠a downlink TTN. \\ \hline
RF35 & El sistema deber√° generar alertas por acciones de usuario o cambios de estado en la aplicaci√≥n. \\ \hline
RF36 & El sistema deber√° permitir marcar alertas como resueltas. \\ \hline
RF37 & El sistema deber√° mostrar historial completo de alertas por usuario. \\ \hline
RF38 & El sistema deber√° permitir al administrador crear, editar y eliminar usuarios. \\ \hline
RF39 & El sistema deber√° permitir al administrador crear, editar y eliminar cultivos. \\ \hline
RF40 & El sistema deber√° permitir al administrador crear, editar y eliminar dispositivos. \\ \hline
RF41 & El sistema deber√° permitir la captaci√≥n de datos de temperatura y humedad relativa y del suelo a trav√©s de los sensores  \\ \hline
RF42 & El sistema deber√° transmitir los datos capturados a TTN \\ \hline
RF43 & El sistema debe almacenar los datos recibidos despu√©s de verificar
su validez y formato. \\ \hline
RF44 & El sistema deber√° permitir al usuario verificado y administrador cerrar sesi√≥n \\ \hline
RF45 & El sistema deber√° permitir al usuario verificado y administrador cerrar sesi√≥n \\ \hline
RF46 & El sistema deber√° permitir recibir los downlinks y procesarlos para activar el riego \\ \hline
RF47 & El sistema deber√° permitir al usuario verificado listar los cultivos y dispositivos disponibles \\ \hline
RF48 & El sistema deber√° permitir al administrador listar los usuarios, cultivos y dispositivos disponibles \\ \hline
\caption{Requisitos Funcionales}
\label{tab:requisitos-funcionales}
\end{longtable}

Por otro lado te voy a pasar los caoss de uso disponibles


\paragraph{Especificaci√≥n de los casos de uso} \mbox{}\\[0.5em]

\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-01 \\ \hline
\textbf{Nombre} & Recepci√≥n de datos \\ \hline
\textbf{Descripci√≥n} & El microcontrolador obtiene datos de temperatura del sensor DHT11 y de humedad del suelo del sensor capacitivo, aplicando conversi√≥n y validaci√≥n para garantizar que los valores sean coherentes y utilizables. \\ \hline
\textbf{Actor principal} & Microcontrolador Arduino MKR WAN 1310 \\ \hline
\textbf{Actor secundario} & ‚Äì \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Los sensores deben estar conectados f√≠sicamente al microcontrolador.
  \item El microcontrolador debe estar alimentado.
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El microcontrolador solicita la lectura de temperatura y humedad relativa al sensor DHT11.
  \item Obtiene el valor de humedad del suelo desde el sensor capacitivo.
  \item Convierte la lectura de humedad a un porcentaje, ajust√°ndola al rango establecido.
  \item Limita los valores de humedad al rango permitido (0‚Äì100\%).
  \item Verifica que la temperatura y humedad relativa sea un valor v√°lido y no un error de lectura.
  \item Prepara los valores para su transmisi√≥n, adapt√°ndolos al formato definido.
\end{enumerate} \\ \hline
\textbf{Postcondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Los valores de temperatura y humedad est√°n listos para su transmisi√≥n.
  \item Los datos han sido validados y cumplen con el formato esperado.
  \item Los valores quedan disponibles para revisi√≥n o depuraci√≥n local.
\end{enumerate} \\ \hline
\textbf{Flujo alternativo} &
\begin{itemize}[leftmargin=*]
  \item Si el sensor DHT11 devuelve un error, el sistema lo registra y omite la transmisi√≥n.
  \item Si el valor de humedad est√° fuera del rango de calibraci√≥n, el sistema lo corrige autom√°ticamente.
  \item Si ambos sensores fallan, el sistema reinicia el ciclo de lectura.
\end{itemize} \\ \hline
\end{tabularx}%
}% <-- ESTA LLAVE FALTABA
\caption{Especificaci√≥n del Caso de Uso: Recepci√≥n de datos}
\label{tab:cu_recepcion_datos}
\end{table}


% ---------------------------------------------------------
% SEPARACION
% ---------------------------------------------------------

\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-02 \\ \hline
\textbf{Nombre} & Enviar datos (uplink) \\ \hline
\textbf{Descripci√≥n} & El microcontrolador env√≠a los datos de temperatura y humedad al gateway LoRaWAN, encapsulados en un formato predefinido, a intervalos regulares. \\ \hline
\textbf{Actor principal} & Microcontrolador Arduino MKR WAN 1310 \\ \hline
\textbf{Actor secundario} & ‚Äì \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El dispositivo debe estar registrado y conectado a la red TTN mediante OTAA.
  \item Los datos deben haber sido le√≠dos y validados previamente.
  \item La configuraci√≥n de comunicaci√≥n debe corresponder a la regi√≥n y par√°metros establecidos.
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Include(\textit{Recepci√≥n de datos~\ref{tab:cu_recepcion_datos}})
  \item Los datos se empaquetan siguiendo el formato de transmisi√≥n definido.
  \item El microcontrolador env√≠a el paquete al gateway mediante la conexi√≥n LoRaWAN.
  \item Se registra el intento de env√≠o para control y depuraci√≥n.
  \item El sistema espera un tiempo predefinido antes de la pr√≥xima transmisi√≥n.
\end{enumerate} \\ \hline
\textbf{Postcondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Los datos se han transmitido al gateway.
  \item Se registra si el env√≠o ha sido exitoso o ha fallado.
  \item El microcontrolador queda en espera del pr√≥ximo ciclo de transmisi√≥n.
\end{enumerate} \\ \hline
\textbf{Flujo alternativo} &
\begin{itemize}[leftmargin=*]
  \item Si ocurre un error en el env√≠o, se registra y se intentar√° en el siguiente ciclo.
  \item Si la conexi√≥n OTAA se pierde, el sistema requerir√° reinicio manual para reconexi√≥n.
\end{itemize} \\ \hline
\end{tabularx}%
}% <-- ESTA LLAVE FALTABA
\caption{Especificaci√≥n del Caso de Uso: Enviar datos (uplink)}
\label{tab:cu_enviar_datos}
\end{table}


% ---------------------------------------------------------
% SEPARACION
% ---------------------------------------------------------

\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-03 \\ \hline
\textbf{Nombre} & Recibir datos (downlink) \\ \hline
\textbf{Descripci√≥n} & El microcontrolador recibe instrucciones desde TTN en las ventanas de recepci√≥n posteriores a un env√≠o (uplink), interpretando el comando y prepar√°ndolo para ejecuci√≥n. \\ \hline
\textbf{Actor principal} & Microcontrolador Arduino MKR WAN 1310 \\ \hline
\textbf{Actor secundario} & ‚Äì \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Debe haberse enviado un mensaje uplink para abrir las ventanas de recepci√≥n.
  \item Debe existir un mensaje downlink en la cola de TTN para este dispositivo.
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El microcontrolador verifica peri√≥dicamente si hay datos entrantes.
  \item El microcontrolador env√≠a un uplink vac√≠o peri√≥dico.
  \item Si existe un mensaje, lo lee y obtiene el valor del comando.
  \item El sistema interpreta el comando seg√∫n la codificaci√≥n establecida (por ejemplo, encender o apagar un actuador).
  \item Include(Recibir datos)
\end{enumerate} \\ \hline
\textbf{Postcondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El comando ha sido interpretado y queda listo para ejecuci√≥n.
  \item Se registra el estado resultante para control y depuraci√≥n.
\end{enumerate} \\ \hline
\textbf{Flujo alternativo} &
\begin{itemize}[leftmargin=*]
  \item Si no hay comando disponible, el sistema contin√∫a su operaci√≥n normal.
  \item Si hay error en la lectura, se ignora el comando y se mantiene el estado actual.
\end{itemize} \\ \hline
\end{tabularx}%
}% <-- ESTA LLAVE FALTABA
\caption{Especificaci√≥n del Caso de Uso: Recibir datos (downlink)}
\label{tab:cu_recibir_datos}
\end{table}


% ---------------------------------------------------------
% SEPARACION
% ---------------------------------------------------------

\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-04 \\ \hline
\textbf{Nombre} & Ejecutar riego \\ \hline
\textbf{Descripci√≥n} & El microcontrolador activa o desactiva la bomba de agua en funci√≥n del comando recibido por downlink y env√≠a una confirmaci√≥n al servidor. \\ \hline
\textbf{Actor principal} & Microcontrolador Arduino MKR WAN 1310 \\ \hline
\textbf{Actor secundario} & ‚Äì \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Debe haberse recibido un comando v√°lido para control de la bomba.
  \item El actuador debe estar conectado y operativo.
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Include(\textit{Recibir datos \ref{tab:cu_recibir_datos}})
  \item El microcontrolador cambia el estado del actuador a encendido o apagado.
\end{enumerate} \\ \hline
\textbf{Postcondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El actuador adopta el estado solicitado.
\end{enumerate} \\ \hline
\end{tabularx}%
}% <-- ESTA LLAVE FALTABA
\caption{Especificaci√≥n del Caso de Uso: Recibir datos (downlink)}
\label{tab:cu_recibir_datos}
\end{table}






% ---------------------------------------------------------
% SEPARACION
% ---------------------------------------------------------

\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-05  \\ \hline
\textbf{Nombre} & Recolectar uplink \\ \hline
\textbf{Descripci√≥n} & El servidor TTN recibe y procesa los datos uplink enviados desde el dispositivo LoRaWAN a trav√©s del gateway. \\ \hline
\textbf{Actor principal} & TTN \\ \hline
\textbf{Actor secundario} & ‚Äì \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Debe haberse recibido un comando v√°lido para control de la bomba.
  \item El actuador debe estar conectado y operativo.
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Include(Enviar datos)
  \item TTN recibe la se√±al LoRaWAN del gateway. 
  \item Se verifica la autenticidad del dispositivo mediante autenticaci√≥n OTAA
  \item Se valida la integridad del mensaje
  \item Include(Preprocesar decode/encode).
  \item Se extrae metadata de transmisi√≥n (RSSI, SNR, timestamp)
  \item Se prepara el mensaje para webhook
\end{enumerate} \\ \hline
\textbf{Postcondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El mensaje est√° verificado y decodificado
  \item Los datos est√°n listos para ser reenviados al endpoint HTTP configurado en el webhook HTTP
  \item Se registra la recepci√≥n en logs de TTN
\end{enumerate} \\ \hline
\end{tabularx}%
}% <-- ESTA LLAVE FALTABA
\caption{Especificaci√≥n del Caso de Uso: Recolectar Uplink}
\label{tab:cu_recibir_datos}
\end{table}



% ---------------------------------------------------------
% SEPARACION
% ---------------------------------------------------------

\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-06  \\ \hline
\textbf{Nombre} & Preprocesar (decode/encode) \\ \hline
\textbf{Descripci√≥n} & TTN decodifica payloads uplink y codifica payloads downlink seg√∫n los formatos definidos para la aplicaci√≥n. \\ \hline
\textbf{Actor principal} & TTN \\ \hline
\textbf{Actor secundario} & ‚Äì \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Debe existir un payload formatter v√°lido configurado en TTN para preprocesar
  \item  El formato de datos debe ser coherente
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item TTN identifica el tipo de mensaje (uplink/downlink)
  \item Para uplink: decodifica datos de sensores desde en formato JSON desde base hexadecimal
  \item Para downlink: codifica comandos a formato hexadecimal
  \item Include(Preprocesar decode/encode).
  \item  Se valida la estructura resultante
  \item Se prepara el mensaje para webhook
\end{enumerate} \\ \hline
\textbf{Postcondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El mensaje est√° verificado y decodificado
  \item Los datos est√°n listos para ser reenviados al endpoint HTTP configurado en el webhook HTTP
  \item Se registra la recepci√≥n en logs de TTN
\end{enumerate} \\ \hline
\end{tabularx}%
}% <-- ESTA LLAVE FALTABA
\caption{Especificaci√≥n del Caso de Uso: Preprocesar (decode/encode)}
\label{tab:cu_recibir_datos}
\end{table}


% ---------------------------------------------------------
% SEPARACION
% ---------------------------------------------------------

\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-07  \\ \hline
\textbf{Nombre} & Reenviar a Backend \\ \hline
\textbf{Descripci√≥n} & TTN env√≠a los datos procesados al backend de la aplicaci√≥n mediante webhook HTTP configurado. \\ \hline
\textbf{Actor principal} & TTN \\ \hline
\textbf{Actor secundario} & ‚Äì \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El backend debe estar disponible y un dominio dns asignado.
  \item El webhook debe estar configurado correctamente
  \item Los datos deben estar decodificados y validados
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Incluir(Preprocesar (decode/encode))
  \item Se incluyen datos en el payload JSON en base a los filtros configurados en el webhook TTN
  \item Se realiza petici√≥n HTTP POST al endpoint configurado en el webhook desde el backend.
  \item Se espera confirmaci√≥n del backend
  \item Se registra el env√≠o exitoso
\end{enumerate} \\ \hline
\textbf{Postcondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Los datos han llegado al backend correctamente
  \item Se confirma la recepci√≥n por parte del servidor
\end{enumerate} \\ \hline
\end{tabularx}%
}% <-- ESTA LLAVE FALTABA
\caption{Especificaci√≥n del Caso de Uso: Reenviar a Backend}
\label{tab:cu_recibir_datos}
\end{table}



% ---------------------------------------------------------
% SEPARACION
% ---------------------------------------------------------

\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-08  \\ \hline
\textbf{Nombre} & Recepci√≥n downlink \\ \hline
\textbf{Descripci√≥n} & 	TTN recibe comandos downlink desde el backend y los encola para env√≠o al dispositivo en la pr√≥xima ventana de transmisi√≥n. \\ \hline
\textbf{Actor principal} & TTN \\ \hline
\textbf{Actor secundario} & ‚Äì \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El backend debe de hacer la consulta a la API TTN con las credenciales correctas.
  \item El dispositivo IoT objetivo debe estar registrado
  \item Los datos deben estar decodificados y validados
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item TTN recibe petici√≥n POST con comando downlink desde API TTN consultada desde el backend
  \item Se verifica que el dispositivo est√© activo
  \item Incluir(Preprocesar (decode/encode))
  \item Se encola el mensaje hasta que se abran las pr√≥ximas ventanas de recibo RX1 y RX2
\end{enumerate} \\ \hline
\textbf{Postcondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item TTN espera pr√≥ximo uplink
  \item El comando est√° encolado para env√≠o
\end{enumerate} \\ \hline
\textbf{Flujo alternativo} &
\begin{itemize}[leftmargin=*]
  \item Si la autenticaci√≥n falla, se rechaza la petici√≥n
  \item Si el dispositivo est√° inactivo, se notifica error
\end{itemize} \\ \hline
\end{tabularx}%
}% <-- ESTA LLAVE FALTABA
\caption{Especificaci√≥n del Caso de Uso: Recepci√≥n downlink}
\label{tab:cu_recibir_datos}
\end{table}




% ---------------------------------------------------------
% SEPARACION
% ---------------------------------------------------------

\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-09  \\ \hline
\textbf{Nombre} & Recepci√≥n y postproceso \\ \hline
\textbf{Descripci√≥n} & 	El sistema consulta el endpoint HTTP definido en el webhook de TTN con datos de sensores y los procesa para almacenamiento y an√°lisis autom√°tico. \\ \hline
\textbf{Actor principal} & Usuario Verificado \\ \hline
\textbf{Actor secundario} & ‚Äì \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El endpoint webhook debe estar disponible
  \item TTN debe tener configurado el webhook correctamente
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Include(Reenviar Backend)
  \item  Se valida la estructura del payload JSON
  \item  Se comprueba que el uplink recibido proviene del puerto 2
  \item  Se extrae informaci√≥n del payload, sobre datos del dispositivo y de los sensores 
  \item El sistema comprueba que el dispositivo desde provienen los datos de los sensores est√° registrado en la base de datos y est√° activo
  \item Include(Almacenar datos)
\end{enumerate} \\ \hline
\textbf{Postcondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item  Los datos est√°n en almacenamiento
\end{enumerate} \\ \hline
\textbf{Flujo alternativo} &
\begin{itemize}[leftmargin=*]
  \item Si el dispositivo no tiene activa la comunicaci√≥n, no guarda la informaci√≥n en la base de datos
\end{itemize} \\ \hline
\end{tabularx}%
}% <-- ESTA LLAVE FALTABA
\caption{Especificaci√≥n del Caso de Uso: Recepci√≥n downlink}
\label{tab:cu_recibir_datos}
\end{table}


% ---------------------------------------------------------
% SEPARACION
% ---------------------------------------------------------

\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-10  \\ \hline
\textbf{Nombre} & Emitir downlink TTN \\ \hline
\textbf{Descripci√≥n} & 	El sistema env√≠a comandos de control al dispositivo IoT a trav√©s de la API de TTN para activar/desactivar el sistema de riego. \\ \hline
\textbf{Actor principal} & Usuario Verificado \\ \hline
\textbf{Actor secundario} & ‚Äì \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El usuario debe estar autenticado
  \item Debe existir un dispositivo activo asociado
  \item En almacenamiento deben existir las credenciales v√°lidas de TTN para ese dispositivo.
  \item Debe de crearse una API KEY en TTN.
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item  El backend recibe comando desde la interfaz web
  \item  Se valida la autenticaci√≥n del usuario
  \item  Se verifica que el dispositivo est√© activo
  \item  Se prepara payload con comando (ON/OFF)
  \item  Se codifica comando en base6
  \item  Se realiza petici√≥n POST a API TTN
  \item  Include(Recepci√≥n downlink)
\end{enumerate} \\ \hline
\textbf{Postcondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item  Los datos est√°n en almacenamiento
\end{enumerate} \\ \hline
\textbf{Flujo alternativo} &
\begin{itemize}[leftmargin=*]
  \item Si falla autenticaci√≥n, se rechaza comando
\end{itemize} \\ \hline
\end{tabularx}%
}% <-- ESTA LLAVE FALTABA
\caption{Especificaci√≥n del Caso de Uso: Recepci√≥n downlink}
\label{tab:cu_recibir_datos}
\end{table}


% ---------------------------------------------------------
% SEPARACION
% ---------------------------------------------------------

\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-11  \\ \hline
\textbf{Nombre} & Autenticar \\ \hline
\textbf{Descripci√≥n} & 	El sistema valida credenciales de usuarios y gestiona tokens JWT para mantener sesiones seguras en el sistema. \\ \hline
\textbf{Actor principal} & Todos los usuarios \\ \hline
\textbf{Actor secundario} & ‚Äì \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El usuario debe existir en la base de datos
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item  El backend recibe credenciales (email/password).
  \item  Se consulta usuario en la base de datos.
  \item  Se verifica hash de contrase√±a con bcrypt.
  \item  Se valida que la cuenta est√© verificada.
  \item  Se genera token JWT con expiraci√≥n.
  \item  Se retorna token al cliente.
\end{enumerate} \\ \hline
\textbf{Postcondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item  Se ha generado token JWT v√°lido.
  \item  La sesi√≥n est√° activa.
\end{enumerate} \\ \hline
\textbf{Flujo alternativo} &
\begin{itemize}[leftmargin=*]
  \item Si las credenciales son incorrectas, se retorna error 401.
\end{itemize} \\ \hline
\end{tabularx}%
}% <-- ESTA LLAVE FALTABA
\caption{Especificaci√≥n del Caso de Uso: Recepci√≥n downlink}
\label{tab:cu_recibir_datos}
\end{table}

\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-12 \\ \hline
\textbf{Nombre} & Almacenar datos \\ \hline
\textbf{Descripci√≥n} & El sistema persiste en PostgreSQL todos los datos de sensores, configuraciones y eventos del sistema IoT. \\ \hline
\textbf{Actor principal} & Usuario Verificado \\ \hline
\textbf{Actor secundario} & - \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Debe existir conectividad con PostgreSQL
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Se inicia transacci√≥n en base de datos
  \item Se inserta lectura en tabla SensorReading
  \item Se verifica integridad referencial
  \item Se confirma transacci√≥n
  \item Se indexan datos para consultas futuras
\end{enumerate} \\ \hline
\textbf{Postcondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Los datos est√°n disponibles para consultas
\end{enumerate} \\ \hline
\textbf{Flujo alternativo} &
- \\ \hline
\end{tabularx}%
}
\caption{Especificaci√≥n del Caso de Uso: Almacenar datos}
\label{tab:cu_almacenar_datos}
\end{table}

\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-13 \\ \hline
\textbf{Nombre} & Login \\ \hline
\textbf{Descripci√≥n} & El usuario inicia sesi√≥n en el sistema proporcionando sus credenciales para acceder a las funcionalidades de la aplicaci√≥n. \\ \hline
\textbf{Actor principal} & Todos los usuarios \\ \hline
\textbf{Actor secundario} & ‚Äì \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El usuario debe tener una cuenta registrada y verificada
  \item Las credenciales deben ser v√°lidas
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El usuario accede a la p√°gina de login
  \item Introduce email y contrase√±a
  \item Se env√≠an credenciales al backend
  \item Include(Autenticar)
\end{enumerate}
\textbf{Extension Point: Restablecer contrase√±a}

\\ \hline
\textbf{Postcondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El usuario est√° autenticado en el sistema
  \item Se establece sesi√≥n activa con expiraci√≥n de token
\end{enumerate} \\ \hline
\textbf{Flujo alternativo} &
\begin{itemize}[leftmargin=*]
  \item Si las credenciales son incorrectas, se muestra error
\end{itemize} \\ \hline
\end{tabularx}%
}
\caption{Especificaci√≥n del Caso de Uso: Login}
\label{tab:cu_login}
\end{table}


\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-14 \\ \hline
\textbf{Nombre} & Registro \\ \hline
\textbf{Descripci√≥n} & Un visitante se registra en el sistema proporcionando sus datos personales para crear una nueva cuenta de usuario. \\ \hline
\textbf{Actor principal} & Visitante \\ \hline
\textbf{Actor secundario} & - \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El visitante no debe tener cuenta existente con ese email
  \item Los datos proporcionados deben ser v√°lidos
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El visitante accede al formulario de registro
  \item El visitante completa campos: nombre, email, contrase√±a
  \item El sistema verifica que el email no est√© registrado
  \item El sistema hashea la contrase√±a con bcrypt
  \item El sistema crea usuario con estado ''no verificado''
  \item El sistema env√≠a email de verificaci√≥n autom√°tico
\end{enumerate} \\ \hline
\textbf{Postcondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El usuario est√° registrado pero no verificado
  \item Se ha enviado email de verificaci√≥n
  \item El usuario debe verificar para activar cuenta
\end{enumerate} \\ \hline
\textbf{Flujo alternativo} &
\begin{itemize}[leftmargin=*]
  \item Si el email ya existe, se notifica error
  \item Si falla env√≠o de email, se reintenta
  \item Si hay campos inv√°lidos, se solicita correcci√≥n
\end{itemize} \\ \hline
\end{tabularx}%
}
\caption{Especificaci√≥n del Caso de Uso: Registro}
\label{tab:cu_registro}
\end{table}

\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-15 \\ \hline
\textbf{Nombre} & Acceder Dashboard RT \\ \hline
\textbf{Descripci√≥n} & El usuario autenticado accede al dashboard principal que muestra informaci√≥n en tiempo real de sus dispositivos y cultivos. \\ \hline
\textbf{Actor principal} & Usuario Verificado \\ \hline
\textbf{Actor secundario} & ‚Äì \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item √önicamente puede acceder el Usuario Verificado.
  \item Debe de haber un dispositivo seleccionado.
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Se obtienen lecturas recientes de sensores.
  \item Se carga informaci√≥n del cultivo y dispositivo seleccionado si existe.
  \item Se inicializa actualizaci√≥n autom√°tica cada aproximadamente 2 minutos.
  \item Se muestran gr√°ficas interactivas con tendencias.
\end{enumerate} \\ \hline
\textbf{Postcondiciones} &
- \\ \hline
\textbf{Flujo alternativo} &
- \\ \hline
\end{tabularx}%
}
\caption{Especificaci√≥n del Caso de Uso: Acceder Dashboard RT}
\label{tab:cu_dashboard_rt}
\end{table}

\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-16 \\ \hline
\textbf{Nombre} & Iniciar riego \\ \hline
\textbf{Descripci√≥n} & El usuario inicia el proceso de riego seg√∫n el modo configurado (manual, programado o autom√°tico). \\ \hline
\textbf{Actor principal} & Usuario Verificado \\ \hline
\textbf{Actor secundario} & ‚Äì \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El usuario debe estar autenticado
  \item Debe tener dispositivo activo configurado
  \item Debe haber seleccionado un modo de riego
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El usuario configura par√°metros del riego seleccionado
  \item Confirma inicio del riego
  \item El sistema comprueba que no exista un riego ya activo para el usuario activo
  \item El sistema env√≠a comando de inicio ON mediante un downlink al dispositivo IoT a trav√©s de API TTN
  \item Se registra inicio de riego en base de datos
\end{enumerate}
\textbf{Extension point: Cancelar Riego}\par
  \textbf{Extension point: Pausar/Reanudar Riego}
 \\ \hline
\textbf{Postcondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El riego est√° activo seg√∫n modo configurado
\end{enumerate} \\ \hline
\textbf{Flujo alternativo} &
\begin{itemize}[leftmargin=*]
  \item Si ya hay riego activo, se notifica conflicto
\end{itemize} \\ \hline
\end{tabularx}%
}
\caption{Especificaci√≥n del Caso de Uso: Iniciar riego}
\label{tab:cu_iniciar_riego}
\end{table}

\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-17 \\ \hline
\textbf{Nombre} & Cancelar riego \\ \hline
\textbf{Descripci√≥n} & El usuario cancela el proceso de riego activo en cualquier momento, independientemente del modo utilizado. \\ \hline
\textbf{Actor principal} & Usuario Verificado \\ \hline
\textbf{Actor secundario} & ‚Äì \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El usuario debe estar autenticado
  \item Debe haber un riego activo en progreso
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Se solicita confirmaci√≥n de cancelaci√≥n
  \item El sistema env√≠a comando de parada OFF mediante un downlink al dispositivo IoT a trav√©s de API TTN
  \item Se actualiza estado a ''cancelado'' en base de datos
\end{enumerate} \\ \hline
\textbf{Postcondiciones} &
- \\ \hline
\textbf{Flujo alternativo} &
\begin{itemize}[leftmargin=*]
  \item Si no hay riego activo, se notifica al usuario
\end{itemize} \\ \hline
\end{tabularx}%
}
\caption{Especificaci√≥n del Caso de Uso: Cancelar riego}
\label{tab:cu_cancelar_riego}
\end{table}


\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-18 \\ \hline
\textbf{Nombre} & Confirmar cuenta \\ \hline
\textbf{Descripci√≥n} & El usuario confirma su cuenta mediante un enlace √∫nico enviado por email para activar su acceso al sistema. \\ \hline
\textbf{Actor principal} & Visitante \\ \hline
\textbf{Actor secundario} & ‚Äì \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El usuario debe haber completado el registro.
  \item Debe existir un token de verificaci√≥n v√°lido.
  \item El enlace no debe haber expirado.
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El usuario recibe email con enlace de verificaci√≥n.
  \item El usuario hace clic en el enlace de confirmaci√≥n.
  \item El sistema valida el token de verificaci√≥n.
  \item El sistema verifica que el token no haya expirado.
  \item El sistema actualiza estado del usuario a 'verificado'.
  \item El sistema elimina el token de verificaci√≥n en la base de datos.
  \item El sistema redirige a p√°gina de login con mensaje de √©xito.
\end{enumerate} \\ \hline
\textbf{Postcondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item La cuenta est√° verificada y activa
  \item El usuario puede iniciar sesi√≥n normalmente
\end{enumerate} \\ \hline
\textbf{Flujo alternativo} &
\begin{itemize}[leftmargin=*]
  \item Si la cuenta ya est√° verificada, se redirige a login
\end{itemize} \\ \hline
\end{tabularx}%
}
\caption{Especificaci√≥n del Caso de Uso: Confirmar cuenta}
\label{tab:cu_confirmar_cuenta}
\end{table}

\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-19 \\ \hline
\textbf{Nombre} & Restablecer contrase√±a \\ \hline
\textbf{Descripci√≥n} & El usuario solicita y completa el proceso de restablecimiento de contrase√±a cuando la ha olvidado. \\ \hline
\textbf{Actor principal} & Visitante, Usuario Verificado \\ \hline
\textbf{Actor secundario} & - \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item La cuenta debe estar verificada
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El usuario solicita restablecimiento desde p√°gina de login.
  \item Introduce su email registrado.
  \item El sistema verifica que el email existe.
  \item El sistema genera token √∫nico de restablecimiento.
  \item El sistema env√≠a email con enlace temporal.
  \item El usuario accede al enlace.
  \item El usuario Introduce nueva contrase√±a.
  \item El sistema hashea y actualiza la contrase√±a.
\end{enumerate} \\ \hline
\textbf{Postcondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El token de restablecimiento se invalida.
  \item El usuario puede acceder con nueva contrase√±a.
\end{enumerate} \\ \hline
\textbf{Flujo alternativo} &
\begin{itemize}[leftmargin=*]
  \item Si el email no existe, se muestra mensaje gen√©rico.
\end{itemize} \\ \hline
\end{tabularx}%
}
\caption{Especificaci√≥n del Caso de Uso: Restablecer contrase√±a}
\label{tab:cu_restablecer_contrasena}
\end{table}

\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-20 \\ \hline
\textbf{Nombre} & Entrar en modo demo \\ \hline
\textbf{Descripci√≥n} & Un visitante accede al modo demo del sistema para explorar funcionalidades sin necesidad de registro. \\ \hline
\textbf{Actor principal} & Visitante \\ \hline
\textbf{Actor secundario} & ‚Äì \\ \hline
\textbf{Precondiciones} &
- \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El visitante selecciona la opci√≥n "Modo Demo".
  \item El sistema inicializa datos simulados.
  \item El sistema carga interfaz con datos ficticios.
\end{enumerate} \\ \hline
\textbf{Postcondiciones} &
- \\ \hline
\textbf{Flujo alternativo} &
- \\ \hline
\end{tabularx}%
}
\caption{Especificaci√≥n del Caso de Uso: Entrar en modo demo}
\label{tab:cu_modo_demo}
\end{table}


\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-21 \\ \hline
\textbf{Nombre} & Crear usuario \\ \hline
\textbf{Descripci√≥n} & El administrador crea nuevas cuentas de usuario directamente desde el panel administrativo sin verificaci√≥n por email requerida. \\ \hline
\textbf{Actor principal} & Administrador \\ \hline
\textbf{Actor secundario} &  \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El usuario debe tener rol de administrador.
  \item El email no debe estar registrado previamente.
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El administrador accede al panel de usuarios.
  \item El administrador selecciona ''Crear nuevo usuario''.
  \item El administrador completa formulario con datos requeridos.
\end{enumerate} \\ \hline
\textbf{Postcondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El nuevo usuario est√° creado en el sistema.
\end{enumerate} \\ \hline
\textbf{Flujo alternativo} &
\begin{itemize}[leftmargin=*]
  \item Si el email ya existe, se notifica error.
  \item Si faltan campos obligatorios, se solicita completar.
\end{itemize} \\ \hline
\end{tabularx}%
}
\caption{Especificaci√≥n del Caso de Uso: Crear usuario}
\label{tab:cu_crear_usuario}
\end{table}

\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-22 \\ \hline
\textbf{Nombre} & Listar usuarios \\ \hline
\textbf{Descripci√≥n} & El administrador visualiza todos los usuarios registrados en el sistema con opciones de filtrado y b√∫squeda. \\ \hline
\textbf{Actor principal} & Administrador \\ \hline
\textbf{Actor secundario} & ‚Äì \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El usuario debe tener rol de administrador.
  \item Debe haber usuarios registrados en el sistema.
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El administrador accede a gesti√≥n de usuarios.
  \item El sistema carga listado completo de usuarios.
  \item El sistema muestra datos b√°sicos de cada usuario.
\end{enumerate} \\ \hline
\textbf{Postcondiciones} &
- \\ \hline
\textbf{Flujo alternativo} &
\begin{itemize}[leftmargin=*]
  \item Si no hay usuarios, se muestra mensaje informativo.
\end{itemize} \\ \hline
\end{tabularx}%
}
\caption{Especificaci√≥n del Caso de Uso: Listar usuarios}
\label{tab:cu_listar_usuarios}
\end{table}

\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-23 \\ \hline
\textbf{Nombre} & Ver usuario \\ \hline
\textbf{Descripci√≥n} & El administrador visualiza informaci√≥n detallada de un usuario espec√≠fico incluyendo dispositivos y cultivos asociados. \\ \hline
\textbf{Actor principal} & Administrador \\ \hline
\textbf{Actor secundario} & ‚Äì \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El usuario debe tener rol de administrador.
  \item Debe existir el usuario a consultar.
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El sistema carga datos completos del usuario.
\end{enumerate} \\ \hline
\textbf{Postcondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Se muestra informaci√≥n completa del usuario.
\end{enumerate} \\ \hline
\textbf{Flujo alternativo} &
\begin{itemize}[leftmargin=*]
  \item Si hay datos faltantes, se muestran campos vac√≠os.
\end{itemize} \\ \hline
\end{tabularx}%
}
\caption{Especificaci√≥n del Caso de Uso: Ver usuario}
\label{tab:cu_ver_usuario}
\end{table}

\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-24 \\ \hline
\textbf{Nombre} & Editar usuario \\ \hline
\textbf{Descripci√≥n} & El administrador modifica informaci√≥n de un usuario existente. \\ \hline
\textbf{Actor principal} & Administrador \\ \hline
\textbf{Actor secundario} & ‚Äì \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El usuario debe tener rol de administrador.
  \item Debe existir el usuario a editar.
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El administrador accede a edici√≥n del usuario.
  \item El sistema carga datos actuales en formulario.
  \item El administrador modifica campos necesarios.
  \item El sistema valida cambios antes de guardar.
  \item El sistema actualiza informaci√≥n en base de datos.
\end{enumerate} \\ \hline
\textbf{Postcondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Los datos del usuario est√°n actualizados.
\end{enumerate} \\ \hline
\textbf{Flujo alternativo} &
\begin{itemize}[leftmargin=*]
  \item Si el email se cambia a uno existente, se rechaza.
\end{itemize} \\ \hline
\end{tabularx}%
}
\caption{Especificaci√≥n del Caso de Uso: Editar usuario}
\label{tab:cu_editar_usuario}
\end{table}

\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-25 \\ \hline
\textbf{Nombre} & Eliminar usuario \\ \hline
\textbf{Descripci√≥n} & El usuario elimina su propia cuenta (Usuario) o el administrador elimina cualquier cuenta (Admin) permanentemente. \\ \hline
\textbf{Actor principal} & Usuario Verificado, Administrador \\ \hline
\textbf{Actor secundario} & ‚Äì \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Debe existir el usuario a eliminar.
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Si es usuario: accede a su perfil y selecciona eliminar cuenta.
  \item Si es admin: selecciona usuario a eliminar en el listado.
  \item El sistema muestra advertencia sobre eliminaci√≥n permanente.
  \item El sistema solicita confirmaci√≥n expl√≠cita.
  \item El sistema elimina dispositivos y cultivos asociados.
  \item El sistema elimina cuenta y todos los registros.
\end{enumerate} \\ \hline
\textbf{Postcondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El usuario y todos sus datos est√°n eliminados.
\end{enumerate} \\ \hline
\textbf{Flujo alternativo} &
\begin{itemize}[leftmargin=*]
  \item Si se cancela confirmaci√≥n, se aborta eliminaci√≥n.
  \item Si hay error en eliminaci√≥n, se revierten cambios.
\end{itemize} \\ \hline
\end{tabularx}%
}
\caption{Especificaci√≥n del Caso de Uso: Eliminar usuario}
\label{tab:cu_eliminar_usuario}
\end{table}

\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-26 \\ \hline
\textbf{Nombre} & Cerrar sesi√≥n \\ \hline
\textbf{Descripci√≥n} & El usuario termina su sesi√≥n activa en el sistema y retorna a la p√°gina de inicio. \\ \hline
\textbf{Actor principal} & Usuario Verificado, Administrador \\ \hline
\textbf{Actor secundario} & ‚Äì \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Debe tener sesi√≥n activa.
  \item No debe haber operaciones cr√≠ticas en progreso.
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El usuario selecciona opci√≥n "Cerrar sesi√≥n".
  \item El sistema invalida token JWT actual.
  \item El sistema elimina el token del usuario de localStorage.
  \item Se confirma cierre exitoso.
\end{enumerate} \\ \hline
\textbf{Postcondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item La sesi√≥n est√° completamente cerrada
  \item No hay tokens v√°lidos en el cliente
\end{enumerate} \\ \hline
\textbf{Flujo alternativo} &
- \\ \hline
\end{tabularx}%
}
\caption{Especificaci√≥n del Caso de Uso: Cerrar sesi√≥n}
\label{tab:cu_cerrar_sesion}
\end{table}

\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-27 \\ \hline
\textbf{Nombre} & Listar cultivos \\ \hline
\textbf{Descripci√≥n} & El usuario visualiza cultivos (Usuario: solo los suyos, Admin: todos los del sistema). \\ \hline
\textbf{Actor principal} & Usuario Verificado, Administrador \\ \hline
\textbf{Actor secundario} & ‚Äì \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Debe haber cultivos registrados en el sistema.
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El usuario accede a gesti√≥n de cultivos.
  \item Se cargan cultivos seg√∫n rol (propios/todos).
  \item Se muestra informaci√≥n de cada cultivo.
  \item Se proporcionan acciones seg√∫n permisos.
\end{enumerate} \\ \hline
\textbf{Postcondiciones} &
- \\ \hline
\textbf{Flujo alternativo} &
\begin{itemize}[leftmargin=*]
  \item Si no hay cultivos, se muestra mensaje informativo.
\end{itemize} \\ \hline
\end{tabularx}%
}
\caption{Especificaci√≥n del Caso de Uso: Listar cultivos}
\label{tab:cu_listar_cultivos}
\end{table}

\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-28 \\ \hline
\textbf{Nombre} & Crear cultivo \\ \hline
\textbf{Descripci√≥n} & El usuario crea un nuevo cultivo con par√°metros espec√≠ficos. \\ \hline
\textbf{Actor principal} & Usuario Verificado, Administrador \\ \hline
\textbf{Actor secundario} & ‚Äì \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Los datos proporcionados deben ser v√°lidos.
  \item El usuario puede tener m√∫ltiples cultivos, pero solo uno seleccionado.
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El usuario accede a gesti√≥n de cultivos.
  \item El usuario selecciona "Crear cultivo".
  \item El usuario completa informaci√≥n: nombre, descripci√≥n, categor√≠a, etc.
  \item El sistema almacena el cultivo en almacenamiento.
\end{enumerate} \\ \hline
\textbf{Postcondiciones} &
- \\ \hline
\textbf{Flujo alternativo} &
\begin{itemize}[leftmargin=*]
  \item Si faltan datos obligatorios, se solicita completar
\end{itemize} \\ \hline
\end{tabularx}%
}
\caption{Especificaci√≥n del Caso de Uso: Crear cultivo}
\label{tab:cu_crear_cultivo}
\end{table}

\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-29 \\ \hline
\textbf{Nombre} & Editar cultivo \\ \hline
\textbf{Descripci√≥n} & El usuario modifica informaci√≥n y par√°metros de un cultivo. \\ \hline
\textbf{Actor principal} & Usuario Verificado, Administrador \\ \hline
\textbf{Actor secundario} & ‚Äì \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Debe existir el cultivo a editar.
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El usuario selecciona cultivo a editar.
  \item El sistema carga datos actuales en formulario.
  \item El usuario modifica informaci√≥n necesaria.
  \item Guarda modificaciones.
\end{enumerate} \\ \hline
\textbf{Postcondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El cultivo tiene informaci√≥n actualizada
\end{enumerate} \\ \hline
\textbf{Flujo alternativo} &
- \\ \hline
\end{tabularx}%
}
\caption{Especificaci√≥n del Caso de Uso: Editar cultivo}
\label{tab:cu_editar_cultivo}
\end{table}

\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-30 \\ \hline
\textbf{Nombre} & Eliminar cultivo \\ \hline
\textbf{Descripci√≥n} & El usuario elimina permanentemente un cultivo y todas sus configuraciones asociadas. \\ \hline
\textbf{Actor principal} & Usuario Verificado, Administrador \\ \hline
\textbf{Actor secundario} & ‚Äì \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Debe existir el cultivo a eliminar
  \item No debe haber riego activo en el cultivo
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El usuario selecciona cultivo a eliminar
  \item El sistema verifica que no hay riego activo
  \item El sistema solicita confirmaci√≥n de eliminaci√≥n
  \item El sistema elimina configuraciones de riego asociadas
  \item El sistema elimina registro del cultivo
  \item El sistema notifica eliminaci√≥n exitosa
\end{enumerate} \\ \hline
\textbf{Postcondiciones} &
- \\ \hline
\textbf{Flujo alternativo} &
\begin{itemize}[leftmargin=*]
  \item Si se cancela confirmaci√≥n, se aborta proceso
\end{itemize} \\ \hline
\end{tabularx}%
}
\caption{Especificaci√≥n del Caso de Uso: Eliminar cultivo}
\label{tab:cu_eliminar_cultivo}
\end{table}

\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-31 \\ \hline
\textbf{Nombre} & Seleccionar/Deseleccionar cultivo \\ \hline
\textbf{Descripci√≥n} & El usuario activa o desactiva un cultivo espec√≠fico como su cultivo activo. \\ \hline
\textbf{Actor principal} & Usuario Verificado, Administrador \\ \hline
\textbf{Actor secundario} & ‚Äì \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Debe existir el cultivo objetivo
  \item El cultivo debe pertenecer al usuario
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El usuario accede a gesti√≥n de cultivos
  \item El usuario selecciona cultivo espec√≠fico
  \item El usuario cambia estado de selecci√≥n del cultivo
  \item El sistema actualiza configuraci√≥n del usuario
  \item El sistema confirma actualizaci√≥n
\end{enumerate} \\ \hline
\textbf{Postcondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Solo un cultivo puede estar activo
\end{enumerate} \\ \hline
\textbf{Flujo alternativo} &
\begin{itemize}[leftmargin=*]
  \item Si hay riego activo, se solicita confirmaci√≥n
\end{itemize} \\ \hline
\end{tabularx}%
}
\caption{Especificaci√≥n del Caso de Uso: Seleccionar/Deseleccionar cultivo}
\label{tab:cu_seleccionar_deseleccionar_cultivo}
\end{table}

\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-32 \\ \hline
\textbf{Nombre} & Crear dispositivo \\ \hline
\textbf{Descripci√≥n} & El usuario registra un nuevo dispositivo IoT con credenciales TTN v√°lidas. \\ \hline
\textbf{Actor principal} & Usuario Verificado, Administrador \\ \hline
\textbf{Actor secundario} & ‚Äì \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Las credenciales TTN deben ser v√°lidas
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El usuario accede a gesti√≥n de dispositivos
  \item El usuario selecciona ''Crear dispositivo''
  \item El usuario introduce credenciales TTN (DevEUI, AppEUI, etc.)
  \item Registra dispositivo en el sistema
\end{enumerate} \\ \hline
\textbf{Postcondiciones} &
- \\ \hline
\textbf{Flujo alternativo} &
- \\ \hline
\end{tabularx}%
}
\caption{Especificaci√≥n del Caso de Uso: Crear dispositivo}
\label{tab:cu_crear_dispositivo}
\end{table}

\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-33 \\ \hline
\textbf{Nombre} & Editar dispositivo \\ \hline
\textbf{Descripci√≥n} & El usuario modifica configuraci√≥n y credenciales de su dispositivo IoT. \\ \hline
\textbf{Actor principal} & Usuario Verificado, Administrador \\ \hline
\textbf{Actor secundario} & ‚Äì \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Debe existir el dispositivo a editar
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El usuario selecciona dispositivo a editar
  \item El sistema carga los datos actuales
  \item El usuario modifica datos necesarios
  \item Actualiza registro del dispositivo
\end{enumerate} \\ \hline
\textbf{Postcondiciones} &
- \\ \hline
\textbf{Flujo alternativo} &
\begin{itemize}[leftmargin=*]
  \item Si las nuevas credenciales fallan, se revierten
  \item Si hay dispositivo activo, se valida impacto
  \item Si hay error, se mantiene configuraci√≥n anterior
\end{itemize} \\ \hline
\end{tabularx}%
}
\caption{Especificaci√≥n del Caso de Uso: Editar dispositivo}
\label{tab:cu_editar_dispositivo}
\end{table}

\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-34 \\ \hline
\textbf{Nombre} & Eliminar dispositivo \\ \hline
\textbf{Descripci√≥n} & El usuario elimina permanentemente su dispositivo IoT y todos sus datos asociados. \\ \hline
\textbf{Actor principal} & Usuario Verificado, Administrador \\ \hline
\textbf{Actor secundario} & ‚Äì \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Debe existir el dispositivo a eliminar
  \item No debe haber riego activo con el dispositivo
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El usuario selecciona dispositivo a eliminar
  \item El sistema solicita confirmaci√≥n de eliminaci√≥n
  \item Se elimina registro del sistema
\end{enumerate} \\ \hline
\textbf{Postcondiciones} &
- \\ \hline
\textbf{Flujo alternativo} &
- \\ \hline
\end{tabularx}%
}
\caption{Especificaci√≥n del Caso de Uso: Eliminar dispositivo}
\label{tab:cu_eliminar_dispositivo}
\end{table}

\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-35 \\ \hline
\textbf{Nombre} & Activar/Desactivar comunicaci√≥n \\ \hline
\textbf{Descripci√≥n} & El usuario habilita o deshabilita la comunicaci√≥n de su dispositivo IoT con la base de datos. \\ \hline
\textbf{Actor principal} & Usuario Verificado, Administrador \\ \hline
\textbf{Actor secundario} & ‚Äì \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El usuario debe estar autenticado
  \item Debe existir el dispositivo objetivo
  \item El dispositivo debe estar registrado
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El usuario accede a listado de dispositivos.
  \item Selecciona dispositivo espec√≠fico.
  \item Cambia estado de comunicaci√≥n (activo/inactivo).
  \item Se actualiza configuraci√≥n del dispositivo en la base de datos.
  \item El sistema comprueba que el dispositivo desde donde preceden los datos los sensores existe en la base de datos.
  \item El sistema comprueba que el dispositivo tenga la comunicaci√≥n activa.
  \item El sistema guarda los datos de los sensores en la base de datos
  \item Se notifica nuevo estado
\end{enumerate} \\ \hline
\textbf{Postcondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Los datos se procesan seg√∫n nuevo estado
\end{enumerate} \\ \hline
\textbf{Flujo alternativo} &
\begin{itemize}[leftmargin=*]
  \item Si hay el dispositivo no est√° registrado en la base de datos, la informaci√≥n de los sensores no se almacena.
  \item Si la comunicaci√≥n no est√° activa, la informaci√≥n en la base de datos no se almacena 
\end{itemize} \\ \hline
\end{tabularx}%
}
\caption{Especificaci√≥n del Caso de Uso: Activar/Desactivar comunicaci√≥n}
\label{tab:cu_activar_desactivar_comunicacion}
\end{table}

\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-36 \\ \hline
\textbf{Nombre} & Listar dispositivos \\ \hline
\textbf{Descripci√≥n} & El usuario visualiza sus dispositivos IoT (Usuario: solo los suyos, Admin: todos los del sistema). \\ \hline
\textbf{Actor principal} & Usuario Verificado, Administrador \\ \hline
\textbf{Actor secundario} & ‚Äì \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Debe haber dispositivos registrados
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El usuario accede a gesti√≥n de dispositivos
  \item Se cargan dispositivos seg√∫n rol (propios/todos)
  \item Se muestra informaci√≥n de cada dispositivo
  \item Se proporcionan acciones seg√∫n permisos

\end{enumerate} \\ \hline
\textbf{Postcondiciones} &
- \\ \hline
\textbf{Flujo alternativo} &
\begin{itemize}[leftmargin=*]
  \item Si no hay dispositivos, se muestra mensaje informativo
\end{itemize} \\ \hline
\end{tabularx}%
}
\caption{Especificaci√≥n del Caso de Uso: Listar dispositivos}
\label{tab:cu_listar_dispositivos}
\end{table}

\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-37 \\ \hline
\textbf{Nombre} & Marcar alerta resuelta \\ \hline
\textbf{Descripci√≥n} & El usuario marca una alerta espec√≠fica como resuelta para indicar que ha tomado las acciones necesarias. \\ \hline
\textbf{Actor principal} & Usuario Verificado \\ \hline
\textbf{Actor secundario} & ‚Äì \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Debe existir al menos una alerta activa
  \item La alerta debe pertenecer al usuario
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El usuario accede a la lista de alertas
  \item El usuario identifica la alerta a resolver
  \item Hace clic en bot√≥n "Marcar como resuelta"
  \item El sistema actualiza estado de la alerta
\end{enumerate} \\ \hline
\textbf{Postcondiciones} &
- \\ \hline
\textbf{Flujo alternativo} &
- \\ \hline
\end{tabularx}%
}
\caption{Especificaci√≥n del Caso de Uso: Marcar alerta resuelta}
\label{tab:cu_marcar_alerta_resuelta}
\end{table}

\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-38 \\ \hline
\textbf{Nombre} & Ver historial completo de alertas \\ \hline
\textbf{Descripci√≥n} & El usuario visualiza el historial completo de todas las alertas generadas, tanto resueltas como pendientes. \\ \hline
\textbf{Actor principal} & Usuario Verificado \\ \hline
\textbf{Actor secundario} & ‚Äì \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Debe haber alertas registradas en el sistema
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El usuario selecciona vista "Historial completo"
  \item El sistema carga todas las alertas del usuario
  \item Se muestran ordenadas por fecha descendente
\end{enumerate}

\textbf{Extension Point: Marcar alerta resuelta}

\\ \hline
\textbf{Postcondiciones} &
- \\ \hline
\textbf{Flujo alternativo} &
\begin{itemize}[leftmargin=*]
  \item Si no hay alertas, se muestra mensaje informativo
\end{itemize} \\ \hline
\end{tabularx}%
}
\caption{Especificaci√≥n del Caso de Uso: Historial completo de alertas}
\label{tab:cu_historial_completo_alertas}
\end{table}

\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-39 \\ \hline
\textbf{Nombre} & Ver perfil \\ \hline
\textbf{Descripci√≥n} & El usuario visualiza y gestiona su informaci√≥n personal incluyendo opciones para editar datos y eliminar cuenta. \\ \hline
\textbf{Actor principal} & Usuario Verificado \\ \hline
\textbf{Actor secundario} & ‚Äì \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El usuario debe estar autenticado
  \item Debe tener una cuenta verificada
  \item Debe tener acceso a la secci√≥n de perfil
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El usuario accede a su perfil desde el men√∫
  \item Se cargan datos personales actuales
  \item Se muestra informaci√≥n de cuenta y configuraciones
  \item Se proporcionan opciones para editar nombre
  \item Se incluye opci√≥n para cambiar contrase√±a
  \item Se ofrece opci√≥n para eliminar cuenta
\end{enumerate}

\textbf{Extension Point: Cerrar Sesi√≥n} \par
\textbf{Extension Point: Restablecer contrase√±a}

\\ \hline
\textbf{Postcondiciones} &
- \\ \hline
\textbf{Flujo alternativo} &
- \\ \hline
\end{tabularx}%
}
\caption{Especificaci√≥n del Caso de Uso: Ver perfil}
\label{tab:cu_ver_perfil}
\end{table}
\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-40 \\ \hline
\textbf{Nombre} & Seleccionar modo de riego \\ \hline
\textbf{Descripci√≥n} & El usuario elige entre los tres modos disponibles de riego: manual, programado o autom√°tico. \\ \hline
\textbf{Actor principal} & Usuario Verificado \\ \hline
\textbf{Actor secundario} & ‚Äì \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Debe tener dispositivo y cultivo configurados.
  \item No debe haber riego activo.
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El usuario accede a configuraci√≥n de riego.
  \item El sistema muestra los tres modos disponibles.
  \item El usuario selecciona el modo deseado.
  \item Se activa la interfaz espec√≠fica del modo.
\end{enumerate}

\textbf{Extension Point: Configurar Modo Manual}\par
\textbf{Extension Point: Configurar Modo Programado}\par
\textbf{Extension Point: Configurar Modo Autom√°tico}

\\ \hline
\textbf{Postcondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El sistema queda listo para la configuraci√≥n detallada del modo elegido.
\end{enumerate} \\ \hline
\textbf{Flujo alternativo} &
\begin{itemize}[leftmargin=*]
  \item Si hay riego activo, se debe cancelar primero (CU-17).
\end{itemize} \\ \hline
\end{tabularx}%
}
\caption{Especificaci√≥n del Caso de Uso: Seleccionar modo de riego}
\label{tab:cu_seleccionar_modo_riego}
\end{table}

\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-41 \\ \hline
\textbf{Nombre} & Configurar modo manual \\ \hline
\textbf{Descripci√≥n} & El usuario configura riego manual especificando duraci√≥n y confirma el inicio inmediato del riego. \\ \hline
\textbf{Actor principal} & Usuario Verificado \\ \hline
\textbf{Actor secundario} & ‚Äì \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El usuario debe haber seleccionado modo manual (CU-42).
  \item El dispositivo debe estar disponible.
  \item No debe haber otro riego activo.
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Se muestra la interfaz de configuraci√≥n manual.
  \item El usuario especifica la duraci√≥n del riego en minutos.
  \item El usuario confirma el inicio inmediato.
  \item \textbf{Include (CU-16 Iniciar riego).}
  \item Se inicia el riego con la duraci√≥n especificada.
\end{enumerate} \\ \hline
\textbf{Postcondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El riego manual est√° activo.
  \item Se registra la configuraci√≥n utilizada.
  \item El sistema bloquea el acceso al resto de modos mientras dure el riego.
\end{enumerate} \\ \hline
\textbf{Flujo alternativo} &
\begin{itemize}[leftmargin=*]
  \item Si la duraci√≥n es inv√°lida, se solicita correcci√≥n.
  \item Si el dispositivo falla, se muestra error.
  \item Si el usuario cancela antes de iniciar, se regresa a la selecci√≥n de modo (CU-42).
\end{itemize} \\ \hline
\end{tabularx}%
}
\caption{Especificaci√≥n del Caso de Uso: Configurar modo manual}
\label{tab:cu_configurar_modo_manual}
\end{table}

\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-42 \\ \hline
\textbf{Nombre} & Configurar modo programado \\ \hline
\textbf{Descripci√≥n} & El usuario programa riegos autom√°ticos definiendo horarios y duraci√≥n para ejecuci√≥n posterior. \\ \hline
\textbf{Actor principal} & Usuario Verificado \\ \hline
\textbf{Actor secundario} & ‚Äì \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El usuario debe haber seleccionado modo programado (CU-42).
  \item El sistema debe permitir programaci√≥n.
  \item Debe tener dispositivo configurado.
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Se muestra la interfaz de programaci√≥n.
  \item \textbf{Include (CU-46 Definir programaci√≥n).}
  \item Se guarda y activa la programaci√≥n.
\end{enumerate} \\ \hline
\textbf{Postcondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item La programaci√≥n est√° almacenada y activa.
  \item El sistema ejecutar√° riegos autom√°ticamente en los horarios definidos.
\end{enumerate} \\ \hline
\textbf{Flujo alternativo} &
\begin{itemize}[leftmargin=*]
  \item Si hay conflictos horarios, se notifica para correcci√≥n.
  \item Al llegar la fecha/hora de un evento programado, \textbf{se dispara CU-16 Iniciar riego} (relaci√≥n \texttt{<<extend>>} desde CU-16 sobre CU-46).
  \item El usuario puede \textbf{Cancelar programaci√≥n completa (CU-49)} posteriormente desde la configuraci√≥n de programaci√≥n.
\end{itemize} \\ \hline
\end{tabularx}%
}
\caption{Especificaci√≥n del Caso de Uso: Configurar modo programado}
\label{tab:cu_configurar_modo_programado}
\end{table}

\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-43 \\ \hline
\textbf{Nombre} & Configurar modo autom√°tico \\ \hline
\textbf{Descripci√≥n} & El usuario define umbrales de humedad/temperatura para que el sistema active riego autom√°ticamente seg√∫n condiciones. \\ \hline
\textbf{Actor principal} & Usuario Verificado \\ \hline
\textbf{Actor secundario} & ‚Äì \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El usuario debe haber seleccionado modo autom√°tico (CU-42).
  \item Debe tener cultivo con par√°metros definidos.
  \item Los sensores deben estar operativos.
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Se cargan par√°metros del cultivo seleccionado como base.
  \item \textbf{Include (CU-47 Definir umbrales).}
  \item El usuario define la duraci√≥n del riego autom√°tico.
  \item El sistema guarda la configuraci√≥n del modo autom√°tico.
\end{enumerate} \\ \hline
\textbf{Postcondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El modo autom√°tico queda configurado y activo.
  \item El sistema evaluar√° continuamente los umbrales para decidir el inicio de riego.
\end{enumerate} \\ \hline
\textbf{Flujo alternativo} &
\begin{itemize}[leftmargin=*]
  \item Cuando se cumplan los umbrales, \textbf{se dispara CU-16 Iniciar riego} (relaci√≥n \texttt{<<extend>>} desde CU-16 sobre CU-47).
  \item El usuario puede \textbf{Cancelar programaci√≥n completa (CU-49)} posteriormente desde la configuraci√≥n de umbrales.
\end{itemize} \\ \hline
\end{tabularx}%
}
\caption{Especificaci√≥n del Caso de Uso: Configurar modo autom√°tico}
\label{tab:cu_configurar_modo_automatico}
\end{table}

\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-44 \\ \hline
\textbf{Nombre} & Definir programaci√≥n \\ \hline
\textbf{Descripci√≥n} & El usuario establece horarios, d√≠as y duraciones para el modo programado. \\ \hline
\textbf{Actor principal} & Usuario Verificado \\ \hline
\textbf{Actor secundario} & ‚Äì \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Estar en configuraci√≥n de modo programado (CU-44).
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El usuario selecciona fecha y hora de inicio de riego.
  \item Especifica la duraci√≥n del riego.
  \item Selecciona la frecuencia de riego.
  \item Se valida y almacena la programaci√≥n completa.
\end{enumerate}

\textbf{Extension Point: Cancelar programaci√≥n completa (CU-49)}

\\ \hline
\textbf{Postcondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Programaci√≥n guardada y activa.
  \item Quedan programados uno o m√°s eventos futuros de riego.
\end{enumerate} \\ \hline
\textbf{Flujo alternativo} &
\begin{itemize}[leftmargin=*]
  \item Si se cancela durante la edici√≥n, no se guarda la programaci√≥n.
\end{itemize} \\ \hline
\end{tabularx}%
}
\caption{Especificaci√≥n del Caso de Uso: Definir programaci√≥n}
\label{tab:cu_definir_programacion}
\end{table}

\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-45 \\ \hline
\textbf{Nombre} & Definir umbrales (Auto) \\ \hline
\textbf{Descripci√≥n} & El usuario establece los valores l√≠mite (humedad del suelo, humedad relativa y temperatura) que activar√°n el riego en modo autom√°tico. \\ \hline
\textbf{Actor principal} & Usuario Verificado \\ \hline
\textbf{Actor secundario} & ‚Äì \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Estar en configuraci√≥n de modo autom√°tico (CU-45).
  \item Existir un cultivo seleccionado con par√°metros base.
  \item Sensores operativos.
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Se muestran los umbrales actuales del cultivo.
  \item El usuario ajusta umbral m√≠nimo y m√°ximo de humedad del suelo.
  \item El usuario ajusta umbral m√≠nimo y m√°ximo de humedad relativa.
  \item El usuario ajusta el umbral de temperatura m√°xima.
  \item Se valida y guardan los umbrales personalizados.
\end{enumerate}

\textbf{Extension Point: Cancelar programaci√≥n completa (CU-49)}

\\ \hline
\textbf{Postcondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Umbrales personalizados almacenados.
  \item El sistema usar√° estos valores para decidir el inicio de riego.
\end{enumerate} \\ \hline
\textbf{Flujo alternativo} &
\begin{itemize}[leftmargin=*]
  \item Si no se especifica duraci√≥n en CU-45, se aplica un valor por defecto definido por el sistema.
  \item Si hay error de validaci√≥n, se mantienen los umbrales previos.
\end{itemize} \\ \hline
\end{tabularx}%
}
\caption{Especificaci√≥n del Caso de Uso: Definir umbrales (Auto)}
\label{tab:cu_definir_umbrales_auto}
\end{table}

\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-46 \\ \hline
\textbf{Nombre} & Pausar/Reanudar riego \\ \hline
\textbf{Descripci√≥n} & El usuario pausa temporalmente un riego activo y puede reanudarlo posteriormente sin perder la configuraci√≥n. \\ \hline
\textbf{Actor principal} & Usuario Verificado \\ \hline
\textbf{Actor secundario} & ‚Äì \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Debe haber un riego activo en progreso (CU-16).
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El usuario accede a los controles del riego activo.
  \item El usuario selecciona ``Pausar'' riego.
  \item Se env√≠a un downlink de pausa al dispositivo.
  \item Se registra el timestamp de pausa.
  \item El usuario selecciona ``Reanudar'' riego.
  \item Se env√≠a un downlink de reanudaci√≥n y se contin√∫a el riego.
\end{enumerate} \\ \hline
\textbf{Postcondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El riego queda pausado o reanudado seg√∫n la acci√≥n.
  \item Se mantiene la configuraci√≥n original.
  \item Se registra el hist√≥rico de pausas/reanudaciones.
\end{enumerate} \\ \hline
\textbf{Flujo alternativo} &
\begin{itemize}[leftmargin=*]
  \item Si falla el env√≠o del downlink, se notifica el error y se permite reintentar.
\end{itemize} \\ \hline
\end{tabularx}%
}
\caption{Especificaci√≥n del Caso de Uso: Pausar/Reanudar riego}
\label{tab:cu_pausar_reanudar_riego}
\end{table}

\begin{table}[H]
\centering
\resizebox{0.8\textwidth}{!}{%
\renewcommand{\arraystretch}{1.2}%
\setlength{\tabcolsep}{6pt}%
\begin{tabularx}{\textwidth}{|L{3.6cm}|Y|}
\hline
\textbf{Identificador} & CU-47 \\ \hline
\textbf{Nombre} & Cancelar programaci√≥n completa \\ \hline
\textbf{Descripci√≥n} & El usuario anula la programaci√≥n activa del modo programado y/o desactiva la l√≥gica de arranque del modo autom√°tico (umbrales), eliminando eventos futuros y deshabilitando disparos autom√°ticos. \\ \hline
\textbf{Actor principal} & Usuario Verificado \\ \hline
\textbf{Actor secundario} & ‚Äì \\ \hline
\textbf{Precondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item Existir programaci√≥n guardada (CU-46) y/o umbrales activos (CU-47).
  \item No es necesario que haya riego activo (si lo hay y desea detenerlo, usar CU-17).
\end{enumerate} \\ \hline
\textbf{Flujo principal} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item El usuario accede a la gesti√≥n de programaci√≥n/umbrales.
  \item El usuario selecciona el √°mbito a cancelar: Programado, Autom√°tico o ambos.
  \item El sistema elimina eventos programados y/o desactiva el disparo por umbrales.
  \item Se registra la cancelaci√≥n y se actualiza el estado en la base de datos.
\end{enumerate} \\ \hline
\textbf{Postcondiciones} &
\begin{enumerate}[leftmargin=*,label=\arabic*. ,nosep]
  \item No quedan eventos futuros programados ni disparos autom√°ticos por umbral.
  \item El usuario puede seleccionar y configurar de nuevo cualquier modo (CU-42).
  \item Si hubiera un riego corriendo, permanece activo hasta su fin o hasta que se ejecute CU-17.
\end{enumerate} \\ \hline
\textbf{Flujo alternativo} &
\begin{itemize}[leftmargin=*]
  \item Si no hay nada que cancelar, el sistema informa que no existen elementos activos.
\end{itemize} \\ \hline
\end{tabularx}%
}
\caption{Especificaci√≥n del Caso de Uso: Cancelar programaci√≥n completa}
\label{tab:cu_cancelar_programacion_completa}
\end{table}